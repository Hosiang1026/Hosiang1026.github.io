<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="Access-Control-Allow-Origin" content="*"><script type="text/javascript">var start_time=(new Date).getTime()</script><meta http-equiv="Cache-Control" content="no-cache"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="google-site-verification" content="9Wt3lmnrT2bfjaHla5s16adhvcQcBHO7PtNf97n5Od0"><meta name="baidu-site-verification" content="RYlYHsgO7Y"><meta name="sogou_site_verification" content="MSmrTj7lHV"><meta name="shenma-site-verification" content="e4428ccce0f22fad61c3716193bf4bd7_1571416388"><meta name="baidu_union_verify" content="584bb6b4bd24108df082b6d20c7aa9be"><title>推荐系列-和产品争论MySQL底层如何实现order by的,惨败- | 狂欢马克思</title><meta name="keywords" content="分享技术经验与交流"><meta name="description" content="&amp;emsp;&amp;emsp;点击上方“JavaEdge”，关注公众号 设为“星标”，好文章不错过！ 这天风和日丽，小a正���工位上苦练摸鱼技术， 突然接到产品的☎️，又来需求？ 只听到产品又开始口若黄河：我需要要查询到c…"><meta property="og:type" content="article"><meta property="og:title" content="推荐系列-和产品争论MySQL底层如何实现order by的,惨败-"><meta property="og:url" content="https://www.hosiang.cn/582c0207/index.html"><meta property="og:site_name" content="狂欢马克思"><meta property="og:description" content="&amp;emsp;&amp;emsp;点击上方“JavaEdge”，关注公众号 设为“星标”，好文章不错过！ 这天风和日丽，小a正���工位上苦练摸鱼技术， 突然接到产品的☎️，又来需求？ 只听到产品又开始口若黄河：我需要要查询到c…"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://oscimg.oschina.net/oscnet/1f987529-2c29-41f5-b72f-4e3857250cce.png"><meta property="og:image" content="https://oscimg.oschina.net/oscnet/1f987529-2c29-41f5-b72f-4e3857250cce.png"><meta property="og:image" content="https://oscimg.oschina.net/oscnet/1f987529-2c29-41f5-b72f-4e3857250cce.png"><meta property="og:image" content="https://oscimg.oschina.net/oscnet/1f987529-2c29-41f5-b72f-4e3857250cce.png"><meta property="article:published_time" content="2021-04-15T01:48:03.000Z"><meta property="article:modified_time" content="2022-05-11T09:08:10.089Z"><meta property="article:author" content="Howe Hsiang"><meta property="article:tag" content="Popular"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://oscimg.oschina.net/oscnet/1f987529-2c29-41f5-b72f-4e3857250cce.png"><link rel="icon" href="/images/favicon.ico"><link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"><link href="https://cdn.bootcss.com/font-awesome-animation/0.1.0/font-awesome-animation.min.css" rel="stylesheet"><link rel="stylesheet" href="/css/style.css"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?3cd8fa109426bf3f10bd5c362175bace";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script></script><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><meta name="generator" content="Hexo 6.2.0"></head><script src="/js/jquery.min.js"></script><script src="/js/pace.min.js"></script><script src="/js/crypto-js.js"></script><script src="/js/cookie.js"></script><script src="/js/calendar.js"></script><script src="/js/festival.js"></script><script>getFestival()</script><body><script>window.onload=function(){document.getElementById("TimeShow").innerHTML="本站耗时 "+((new Date).getTime()-start_time)/1e3+" 秒 "}</script><div id="container"><header id="header"><div id="banner"></div><div id="header-outer"><div id="header-menu" class="header-menu-pos animated"><div class="header-menu-container"><a href="/" class="left"><span class="site-title">狂欢马克思</span></a><nav id="header-menu-nav" class="right"><a href="/" rel="external nofollow"><i class="fa fa-home"></i> <span>主页</span> </a><a href="/archives" rel="external nofollow"><i class="fa fa-archive"></i> <span>归档</span> </a><a href="/gitbook" rel="external nofollow"><i class="fa fa-columns"></i> <span>笔记</span> </a><a href="/music" rel="external nofollow"><i class="fa fa-music"></i> <span>音乐</span> </a><a href="/photo" rel="external nofollow"><i class="fa fa-picture-o"></i> <span>相册</span> </a><a href="/collection" rel="external nofollow"><i class="fa fa-envira"></i> <span>收藏</span> </a><a href="/about" rel="external nofollow"><i class="fa fa-user"></i> <span>关于</span></a></nav><a class="mobile-header-menu-button"><i class="fa fa-bars"></i></a></div></div><div id="header-row"><div id="logo"><a href="/"><img src="/../images/logo.png" alt="logo"></a></div><div class="header-info"><div id="header-title"><h2>狂欢马克思</h2></div><div id="header-description"><h3>专注Web开发</h3></div></div><nav class="header-nav"><div class="social"><a title="Github" target="_blank" href="//github.com/Hosiang1026" rel="external nofollow"><i class="fa fa-github fa-2x"></i></a> <a title="QQ" target="_blank" href="//wpa.qq.com/msgrd?v=3&uin=641904695&site=qq&menu=yes" rel="external nofollow"><i class="fa fa-qq fa-2x"></i></a> <a title="Weibo" target="_blank" href="//www.weibo.com/haoxiang969" rel="external nofollow"><i class="fa fa-weibo fa-2x"></i></a></div></nav></div><div id="noticeId" class="show" style="background:rgb(244,247,247,.3)"><marquee id="noticeMar" behavior="scoll" class="notice" direction="left" onmouseover="this.stop()" onmouseout="this.start()"></marquee></div><script type="text/javascript">function browserRedirect(){var i=navigator.userAgent.toLowerCase(),n="ipad"==i.match(/ipad/i),o="iphone os"==i.match(/iphone os/i),a="midp"==i.match(/midp/i),t="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),e="ucweb"==i.match(/ucweb/i),s="android"==i.match(/android/i),d="windows ce"==i.match(/windows ce/i),p="windows mobile"==i.match(/windows mobile/i),r="",c=randomColor(),r=n||o||a||t||e||s||d||p?($("#noticeId").css({"line-height":"1.6em"}),"<font style='color:"+c+"' face='新华宋体'  size='2'>官宣：<span id='weekend'></span><span id='msg'></span><span id='timer'></span><span id='hitokoto'></span></span></span><span id='YQData'></font> "):($("#noticeId").css({"line-height":"3.6em","margin-top":"20px"}),"<font style='color:"+c+"' face='新华宋体'  size='6'>官宣：<span id='weekend'></span><span id='msg'></span><span id='timer'></span><span id='hitokoto'></span></span><span id='YQData'></span></font> ");$("#noticeMar").html(r)}function randomColor(){for(var i="0,1,2,3,4,5,6,7,8,9,a,b,c,d,e,f".split(","),n="#",o=0;o<6;o++)n+=i[Math.floor(16*Math.random())];return n}$(function(){browserRedirect(),0<$("#hitokoto").length&&getHitokoto()})</script></div></header><script>console.log=function(){}</script><div class="outer"><section id="main" class="body-wrap"><article id="post-和产品争论MySQL底层如何实现order by的,惨败-" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="post-title" itemprop="name">推荐系列-和产品争论MySQL底层如何实现order by的,惨败-</h1><div class="post-title-bar"><ul><li><i class="fa fa-book"></i> <a href="/categories/热门文章/">热门文章</a></li><li><i class="fa fa-calendar"></i> 2021-04-15</li><li><i class="fa fa-eye"></i> <span id="busuanzi_value_page_pv"></span></li><li><span class="post-count">字数统计: 3.8k字</span></li><li><span class="post-count">阅读时长: 14分钟</span></li></ul></div></header><div class="article-entry post-content" itemprop="articleBody"><p>&amp;emsp;&amp;emsp;点击上方“JavaEdge”，关注公众号 设为“星标”，好文章不错过！ 这天风和日丽，小a正���工位上苦练摸鱼技术， 突然接到产品的☎️，又来需求？ 只听到产品又开始口若黄河：我需要要查询到c…</p><span id="more"></span><p>  点击上方“JavaEdge”，关注公众号</p><p>设为“星标”，好文章不错过！</p><pre><code> 这天风和日丽，小a正在工位上苦练摸鱼技术， 
  ![Test](https://oscimg.oschina.net/oscnet/1f987529-2c29-41f5-b72f-4e3857250cce.png  &#39;和产品争论MySQL底层如何实现order by的,惨败-&#39;) 
 突然接到产品的☎️，又来需求？     ![Test](https://oscimg.oschina.net/oscnet/1f987529-2c29-41f5-b72f-4e3857250cce.png  &#39;和产品争论MySQL底层如何实现order by的,惨败-&#39;)  
 只听到产品又开始口若黄河：我需要要查询到city是“上海”的所有人的name，并且还要按name排序返回前1000人的name、age。 
 小a急忙正襟危坐，从一堆库表中翻出需要的表，抽出其建表语句： ![Test](https://oscimg.oschina.net/oscnet/1f987529-2c29-41f5-b72f-4e3857250cce.png  &#39;和产品争论MySQL底层如何实现order by的,惨败-&#39;) 
 看看表结构，再看看产品的需求 ![Test](https://oscimg.oschina.net/oscnet/1f987529-2c29-41f5-b72f-4e3857250cce.png  &#39;和产品争论MySQL底层如何实现order by的,惨败-&#39;) 
 感觉很容易，随手SQL这么一写： ![Test](https://oscimg.oschina.net/oscnet/1f987529-2c29-41f5-b72f-4e3857250cce.png  &#39;和产品争论MySQL底层如何实现order by的,惨败-&#39;)  
 诶，这语句看着简单而朴实，一个需求好像就完美解决了。但为了显示自己强大的性能优化水平，考虑到要避免全表扫描，于是又给 city 字段加索引。建完索引，自然还需要使用explain验证一下： 
  
   
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select city, name, age from citizen <span class="type">where</span> <span class="variable">city</span> <span class="operator">=</span> <span class="string">&#x27;上海&#x27;</span> order by name limit <span class="number">1000</span>;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-----------------------------+</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">| id | select_type | table   | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra                       |</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-----------------------------+</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">|  <span class="number">1</span> | SIMPLE      | citizen | NULL       | ALL  | city          | NULL | NULL    | NULL |   <span class="number">32</span> |   <span class="number">100.00</span> | Using where; Using filesort |</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-----------------------------+</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> row in set, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><pre><code> Extra字段的 Using filesort 表示需要排序，MySQL会给每个线程分配一块内存用于排序，称为sort_buffer。 
 这时魔鬼产品突然凑过来问：给我看看你代码咋写的，你这么写你真的懂MySQL 底层怎么执行order by的吗？小a突然惊醒，还真没想过这些。 
 产品经理冷笑道：你知道你的 city 索引长啥样吗？我自己建立的，我咋可能不知道！随手直接画出 
  
  city字段的索引示意图 ![Test](https://oscimg.oschina.net/oscnet/1f987529-2c29-41f5-b72f-4e3857250cce.png  &#39;和产品争论MySQL底层如何实现order by的,惨败-&#39;) 
  
 产品，你可好好看了，这里  
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id_x ~ id_(x+n)</span><br></pre></td></tr></table></figure><p> 的数据都满足city&#x3D;’上海’。<br>产品：那你倒是说说这条SQL的执行流程？不知道了吧，我来告诉你吧：</p><pre><code>  初始化sort_buffer，确定放入 
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name、city、age</span><br></pre></td></tr></table></figure><p>三字段<br>从索引<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">city</span><br></pre></td></tr></table></figure><br>找到第一个满足<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">city=<span class="string">&#x27;上海’</span></span><br></pre></td></tr></table></figure><br>条件的主键id， 即<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id_x</span><br></pre></td></tr></table></figure><br>；<br>到id主键索引取出整行，取<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name、city、age</span><br></pre></td></tr></table></figure><br>三个字段的值，存入sort_buffer<br>从索引city取下一个记录的主键id<br>重复3、4，直到city的值不满足查询条件，即主键<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id_y</span><br></pre></td></tr></table></figure><p></p><pre><code>  对sort_buffer中数据按 
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name</span><br></pre></td></tr></table></figure><p>做快排<br>取排序后结果的前1000行返回给客户端</p><pre><code> 这就是全字段排序，执行流程如下：  
 
![Test](https://oscimg.oschina.net/oscnet/1f987529-2c29-41f5-b72f-4e3857250cce.png  &#39;和产品争论MySQL底层如何实现order by的,惨败-&#39;) 
 
  
 按name排序 这一操作可能在内存中完成，也可能需要外部排序，而这就取决于 
  
  排序所需内存 
  参数sort_buffer_size MySQL为排序开辟的内存（sort_buffer）的大小。若要排序的数据量小于sort_buffer_size，排序就在内存中完成。若排序数据量太大，内存放不下，则得利用磁盘临时文件辅助排序。 
  
 产品又开始炫技了，又问到：你知道  
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">一条排序语句何时才会使用临时文件</span><br></pre></td></tr></table></figure><p> 吗？这？这还真又触及到我的知识盲区了！ <br><img src="https://oscimg.oschina.net/oscnet/1f987529-2c29-41f5-b72f-4e3857250cce.png" alt="Test" title="和产品争论MySQL底层如何实现order by的,惨败-"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SET optimizer_trace=<span class="string">&#x27;enabled=on&#x27;</span>;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Query OK, <span class="number">0</span> rows <span class="title function_">affected</span> <span class="params">(<span class="number">0.00</span> sec)</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">  </span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 使用 @a 保存 Innodb_rows_read 的初始值 */</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select VARIABLE_VALUE into <span class="meta">@a</span> from  performance_schema.session_status <span class="type">where</span> <span class="variable">variable_name</span> <span class="operator">=</span> <span class="string">&#x27;Innodb_rows_read&#x27;</span>;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Query OK, <span class="number">1</span> row <span class="title function_">affected</span> <span class="params">(<span class="number">0.00</span> sec)</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">  </span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select city, name,age from citizen where city=<span class="string">&#x27;上海&#x27;</span> order by name limit <span class="number">1000</span>;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+--------+------+-----+</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">| city   | name | age |</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+--------+------+-----+</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">| 上海   | java |  <span class="number">22</span> |</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">...</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">  </span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 查看 OPTIMIZER_TRACE 输出 */</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM `information_schema`.`OPTIMIZER_TRACE`\G</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">  </span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 使用 @b 保存 Innodb_rows_read 的当前值 */</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select VARIABLE_VALUE into <span class="meta">@b</span> from performance_schema.session_status <span class="type">where</span> <span class="variable">variable_name</span> <span class="operator">=</span> <span class="string">&#x27;Innodb_rows_read&#x27;</span>;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Query OK, <span class="number">1</span> row <span class="title function_">affected</span> <span class="params">(<span class="number">0.00</span> sec)</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">  </span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 计算 Innodb_rows_read 的差值 */</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select <span class="meta">@b</span>-<span class="meta">@a</span>;</span><br></pre></td></tr></table></figure><pre><code> 查看 OPTIMIZER_TRACE 结果中的 number_of_tmp_files 字段确认是否使用临时文件。 
  
   
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;filesort_execution&quot;</span>: [</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">],</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;filesort_summary&quot;</span>: &#123;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;rows&quot;</span>: <span class="number">4000</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;examined_rows&quot;</span>: <span class="number">4000</span>,</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;number_of_tmp_files&quot;</span>: <span class="number">12</span>,</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;sort_buffer_size&quot;</span>: <span class="number">32664</span> ,</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;sort_mode&quot;</span>: <span class="string">&quot;&lt;sort_key, packed_additional_fields&gt;&quot;</span></span><br></pre></td></tr></table></figure><pre><code>  number_of_tmp_files 排序过程中使用的临时文件数。为啥需要12个文件？内存放不下时，就需要使用外部排序，外部排序一般使用归并排序。MySQL将需要排序的数据分成12份，每一份单独排序后存在这些临时文件中。然后把这12个有序文件再合并成一个有序的大文件。 
  
 若 sort_buffer_size 超过需排序的数据量大小，则 number_of_tmp_files 就是0，即排序可直接在内存完成。 
 否则就需要放在临时文件中排序。sort_buffer_size越小，需要分成的份数越多，number_of_tmp_files的值就越大。 
  
  examined_rows 参与排序的行数。测试表有4000条满足city=&#39;上海’的记录，所以该参数为4000。 
  sort_mode 的packed_additional_fields 排序过程对字符串做了“紧凑”处理。即使name字段的定义是varchar(16)，在排序过程中还是要按实际长度分配空间。 
  
  
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select <span class="meta">@b</span>-<span class="meta">@a</span></span><br></pre></td></tr></table></figure><p> 的结果4000，即<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">整个执行过程只扫描了</span><br></pre></td></tr></table></figure><br>4000行。<br>注意，为了避免对结论造成干扰，我把internal_tmp_disk_storage_engine设置成MyISAM。否则，<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select <span class="meta">@b</span>-<span class="meta">@a</span></span><br></pre></td></tr></table></figure><br>的结果会显示为4001。因为查询OPTIMIZER_TRACE表时，需要用到临时表，而internal_tmp_disk_storage_engine的默认值是InnoDB。若使用InnoDB，把数据从临时表取出时，会让Innodb_rows_read的值加1。<br>我惊奇地望着产品，像瞻仰伟人一般，不如你继承我的代码吧，让我来做产品？ <img src="https://oscimg.oschina.net/oscnet/1f987529-2c29-41f5-b72f-4e3857250cce.png" alt="Test" title="和产品争论MySQL底层如何实现order by的,惨败-"> <p></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rowid排序</span><br></pre></td></tr></table></figure><p> 上面的算法，只是对原表数据读了一遍，剩下的操作都是在sort_buffer和临时文件中执行。但这就存在问题：若查询要返回的字段很多，那么sort_buffer要放的字段数就会很多，内存里能够同时放下的行数就会变少，就要分成很多临时文件，���序性能就会很差。 所以若单行很大，该方法的效率可不够行哦。<br> <img src="https://oscimg.oschina.net/oscnet/1f987529-2c29-41f5-b72f-4e3857250cce.png" alt="Test" title="和产品争论MySQL底层如何实现order by的,惨败-"> <br>产品大大又开始发难，那么你知道若MySQL认为排序的单行长度太大，它又会干啥吗？<br>现在修改个参数，让MySQL采用另外一种算法。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SET</span> <span class="variable">max_length_for_sort_data</span> <span class="operator">=</span> <span class="number">16</span>;</span><br></pre></td></tr></table></figure><pre><code>  max_length_for_sort_data MySQL用于控制用于排序的行数据的长度。若单行的长度超过该值，MySQL就认为单行太大，要换个算法。 
  
  
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">city、name、age</span><br></pre></td></tr></table></figure><p> 三字段的定义总长度36，那你看我把max_length_for_sort_data设为16会咋样。<br>新的算法放入sort_buffer的字段，只有要排序的列（即name字段）和主键id。但这时，排序的结果就因少了<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">city</span><br></pre></td></tr></table></figure><br>和<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">age</span><br></pre></td></tr></table></figure><br>字段值，不能直接返回了，整个执行流程变成如下：<p></p><pre><code>  初始化sort_buffer，确定放入两个字段，即 
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name</span><br></pre></td></tr></table></figure><p>和<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id</span><br></pre></td></tr></table></figure><p></p><pre><code>  从 
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">city</span><br></pre></td></tr></table></figure><p>找到第一个满足city&#x3D;’上海’条件的主键id，也就是图中的id_x<br>到id取出整行，取name、id这两个字段，存入sort_buffer<br>从<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">city</span><br></pre></td></tr></table></figure><br>取下一个记录的主键id<br>重复步骤3、4直到不满足city&#x3D;’上海’，也就是图中的id_y<br>对sort_buffer中的数据按照字段name进行排序<br>遍历排序结果，取前1000行，并按照id的值回到原表中取出city、name和age三个字段返回给客户端。<p></p><pre><code> ![Test](https://oscimg.oschina.net/oscnet/1f987529-2c29-41f5-b72f-4e3857250cce.png  &#39;和产品争论MySQL底层如何实现order by的,惨败-&#39;)  
 听到这里，感觉明白了一些：产品你别急，你看我画下这个 
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rowid排序</span><br></pre></td></tr></table></figure><p>执行过程的示意图，看看对不对？ </p><pre><code>  你看这个和你之前画的全字段排序示意图，其实就是多访问了一次表citizen的主键索引，即step7。 
  
 这时查看rowid排序的OPTIMIZER_TRACE结果，看看和之前的不同之处在哪里 
  
   
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;filesort_execution&quot;</span>: [</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">],</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;filesort_summary&quot;</span>: &#123;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;rows&quot;</span>: <span class="number">4000</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;examined_rows&quot;</span>: <span class="number">4000</span>,</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;number_of_tmp_files&quot;</span>: <span class="number">10</span>,</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;sort_buffer_size&quot;</span>: <span class="number">32728</span> ,</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;sort_mode&quot;</span>: <span class="string">&quot;&lt;sort_key, rowid&gt;&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select <span class="meta">@b</span>-<span class="meta">@a</span></span><br></pre></td></tr></table></figure><p>结果变成5000 因为这时除了排序过程，在排序完成后，还要根据id去原表取值。由于语句是limit 1000，因此会多读1000行。<br>sort_mode 变成了 &lt;sort_key, rowid&gt; 表示参与排序的只有name和id字段<br>number_of_tmp_files 变成10 因为这时参与排序的行数虽然还是4000，但每行都变小了，因此需排序的总数据量就小了，需要的临时文件也就少咯。</p><pre><code> 产品���后��结到： 
  
  若MySQL认为排序内存太小，会影响排序效率，就会采用rowid排序 这样排序过程中一次可以排序更多行，但最后需要回表取数据 
  若MySQL认为内存够大，会优先选择全字段排序 把需要字段都放到sort_buffer，这样排序后就直接从内存返回查询结果，不用回表。 
  
 所以MySQL就是：若内存够，就多利用内存，尽量减少磁盘访问。 
 对InnoDB，rowid排序会要求回表，多造成了磁盘读，因此不会被优先选择。所以MySQL排序是个高成本操作。 
  
  是不是所有order by都需排序呢？若不排序就能得到正确的结果，那对系统的消耗会小很多，语句的执行时间也会变得更短。 
  
 并非所有order by都需排序操作。MySQL之所以需要生成临时表，并且在临时表上做排序，是因为原来的数据都是无序的。 
  
  如果能保证从city索引上取出来的行，天生就是按name递增排序，是不是就可以不用再排序了？是的。 
  
 所以可以创建一个 
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">city,name</span><br></pre></td></tr></table></figure><p>联合索引：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table t add index <span class="title function_">citizen</span><span class="params">(city, name)</span>;</span><br></pre></td></tr></table></figure><pre><code>  该索引的示意图 ![Test](https://oscimg.oschina.net/oscnet/1f987529-2c29-41f5-b72f-4e3857250cce.png  &#39;和产品争论MySQL底层如何实现order by的,惨败-&#39;) 依然可以用树搜索定位到第一个满足city=&#39;上海’的记录，并且能确保接下来按顺序取“下一条记录”的遍历过程，只要city是上海，name值一定有序。这样整个查询过程的流程就变成： 
  
  
  从索引(city,name)找到第一个满足city=&#39;上海’条件的主键id 
  到主键id索引取出整行，取name、city、age三个字段的值，作为结果集的一部分直接返回 
  从索引(city,name)取下一个记录主键id 
  重复步骤2、3，直到查到第1000条记录，或者是不满足city=&#39;上海’条件时循环结束 
  
  
  引入(city,name)联合索引后，查询语句的执行计划 ![Test](https://oscimg.oschina.net/oscnet/1f987529-2c29-41f5-b72f-4e3857250cce.png  &#39;和产品争论MySQL底层如何实现order by的,惨败-&#39;) 
  
 可见，该查询过程无需临时表，也无需排序。 
  
  使用 explain 查看(city,name)联合索引，查询语句的执行计划 
  
  
   
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select city, name, age from citizen <span class="type">where</span> <span class="variable">city</span> <span class="operator">=</span> <span class="string">&#x27;上海&#x27;</span> order by name limit <span class="number">1000</span>;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-----------------------------+</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">| id | select_type | table   | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra                       |</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-----------------------------+</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">|  <span class="number">1</span> | SIMPLE      | citizen | NULL       | ref  | city,name       | name | <span class="number">51</span>    | const |   <span class="number">4000</span> |   <span class="number">100.00</span> | Using index condition |</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-----------------------------+</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> row in set, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><pre><code> 可见Extra字段中没有Using filesort了，也就是不需要排序了。而且由于(city,name)这个联合索引本身有序，所以该查询也不用把4000行全都读一遍，只要找到满足条件的前1000条记录即可退出。在这个例子里，只需扫描1000次。 
 该语句的执行流程有没有可能进一步简化呢？ 
  
  覆盖索引 索引上的信息足够满足查询请求，不需要再回到主键索引上去取数据。 
  
 按覆盖索引，可以再优化一下这个查询语句的执行流程。针对这个查询，我们可以创建一个city、name和age的联合索引，对应的SQL语句就是： 
  
   
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table t add index <span class="title function_">city_user_age</span><span class="params">(city, name, age)</span>;</span><br></pre></td></tr></table></figure><pre><code> 这时，对于city字段的值相同的行来说，还是按照name字段的值递增排序的，此时的查询语句也就不再需要排序了。这样整个查询语句的执行流程就变成了： 
  
  从索引(city,name,age)找到第一个满足city=&#39;上海’条件的记录，取出其中的city、name和age这三个字段的值，作为结果集的一部分直接返回 
  从索引(city,name,age)取下一个记录，同样取出这三个字段的值，作为结果集的一部分直接返回 
  重复2，直到查到第1000条记录或不满足city=&#39;上海&#39; 
  
 引入  
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(city,name,age)</span><br></pre></td></tr></table></figure><p> 联合索引，查询语句的执行流程 <img src="https://oscimg.oschina.net/oscnet/1f987529-2c29-41f5-b72f-4e3857250cce.png" alt="Test" title="和产品争论MySQL底层如何实现order by的,惨败-"></p><pre><code>  explain查看 
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(city,name,age)</span><br></pre></td></tr></table></figure><p>联合索引查询语句的执行计划</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select city, name, age from citizen <span class="type">where</span> <span class="variable">city</span> <span class="operator">=</span> <span class="string">&#x27;上海&#x27;</span> order by name limit <span class="number">1000</span>;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-----------------------------+</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">| id | select_type | table   | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra                       |</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-----------------------------+</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">|  <span class="number">1</span> | SIMPLE      | citizen | NULL       | ref  | city,name,age        | age | <span class="number">51</span>    | const |   <span class="number">4000</span> |   <span class="number">100.00</span> | Using where; Using index |</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-----------------------------+</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> row in set, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><pre><code> Extra字段里面多了“Using index”，说明使用了覆盖索引，性能上会快很多。但这并非说要为了每个查询能用上覆盖索引，就要把语句中涉及的字段都建上联合索引，毕竟索引也很占空间，而且修改新增都会导致索引改变，还是具体业务场景具体分析。 
  
  
   
  
 






 
  
  往期推荐 
  
 
 
  
 


 
  
   
    
    由于不知线程池的bug,某Java程序员叕被祭天 
    
  
  
   
    
    程序员因重复记录日志撑爆ELK被辞退! 
    
  
  
   
    
    拥抱Kubernetes,再见了Spring Cloud 
    
  
  
   
    
    JDK为何自己先破坏双亲委派模型? 
    
  
 







 
  
   
  
 ![Test](https://oscimg.oschina.net/oscnet/1f987529-2c29-41f5-b72f-4e3857250cce.png  &#39;和产品争论MySQL底层如何实现order by的,惨败-&#39;) 
  
   
  
 
</code></pre><p>目前交流群已有 800+人，旨在促进技术交流，可关注公众号添加笔者微信邀请进群</p><p>喜欢文章，点个“在看、点赞、分享”素质三连支持一下~</p><p>本文分享自微信公众号 - JavaEdge（Java-Edge）。如有侵权，请联系 <a href="mailto:&#x73;&#x75;&#x70;&#112;&#111;&#114;&#x74;&#x40;&#111;&#115;&#99;&#x68;&#x69;&#x6e;&#97;&#46;&#x63;&#110;">&#x73;&#x75;&#x70;&#112;&#111;&#114;&#x74;&#x40;&#111;&#115;&#99;&#x68;&#x69;&#x6e;&#97;&#46;&#x63;&#110;</a> 删除。本文参与“OSC源创计划”，欢迎正在阅读的你也加入，一起分享。</p><div class="post-copyright"><div class="content"><p>本文标题： 推荐系列-和产品争论MySQL底层如何实现order by的,惨败-</p><p>本文作者： OSChina</p><p>发布时间： 2021年04月15日 09:48</p><p>最后更新： 2022年05月11日 17:08</p><p>原始链接： <a class="post-url" href="/582c0207/" title="推荐系列-和产品争论MySQL底层如何实现order by的,惨败-">https://www.hosiang.cn/582c0207/</a></p><p>版权声明： 本文著作权归作者所有，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener noreferrer" target="_blank">CC BY-NC-SA 4.0</a>许可协议，转载请注明出处！</p><footer><a href="https://www.hosiang.cn"><img src="/../images/logo.png" alt="Howe Hsiang"> Howe Hsiang</a></footer></div></div><div class="page-reward"><a id="rewardBtn" href="javascript:;">赏</a></div><div id="reward" class="post-modal reward-lay"><a class="close" href="javascript:;" id="reward-close">×</a> <span class="reward-title"><i class="icon icon-quote-left"></i> 喜欢就赞赏一下呗！ <i class="icon icon-quote-right"></i></span><div class="reward-content"><div class="reward-code"><img id="rewardCode" src="/images/threepay_code.jpg" alt="打赏二维码"></div><div class="reward-select"></div></div></div></div><footer class="article-footer"><div class="post-share"><a href="javascript:" id="share-sub" class="post-share-fab"><i class="fa fa-share-alt" style="padding-top:11px!important"></i></a><div class="post-share-list" id="share-list"><ul class="share-icons"><li><a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://www.hosiang.cn/582c0207/" data-title="Facebook" rel="external nofollow noopener noreferrer"><i class="fa fa-facebook" style="padding-top:9px!important"></i></a></li><li><a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《推荐系列-和产品争论MySQL底层如何实现order by的,惨败-》 — 狂欢马克思&url=https://www.hosiang.cn/582c0207/&via=https://www.hosiang.cn" data-title="Twitter" rel="external nofollow noopener noreferrer"><i class="fa fa-twitter" style="padding-top:9px!important"></i></a></li><li><a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://www.hosiang.cn/582c0207/" data-title="Google+" rel="external nofollow noopener noreferrer"><i class="fa fa-google-plus" style="padding-top:9px!important"></i></a></li><li><a class="qq share-sns" target="_blank" href="https://connect.qq.com/widget/shareqq/index.html?url=https://www.hosiang.cn/582c0207/&title=《推荐系列-和产品争论MySQL底层如何实现order by的,惨败-》 — 狂欢马克思&source=&amp;emsp;&amp;emsp;点击上方“JavaEdge”，关注公众号 设为“星标”，好文章不错过！ 这天风和日丽，小a正���工位上苦练摸鱼技..." data-title="QQ" rel="external nofollow noopener noreferrer"><i class="fa fa-qq" style="padding-top:9px!important"></i></a></li><li><a class="weixin share-sns" id="wxFab" href="javascript:" data-title="微信"><i class="fa fa-weixin" style="padding-top:9px!important"></i></a></li><li><a class="weibo share-sns" target="_blank" href="https://service.weibo.com/share/share.php?url=https://www.hosiang.cn/582c0207/&title=《推荐系列-和产品争论MySQL底层如何实现order by的,惨败-》 — 狂欢马克思&pic=https://oscimg.oschina.net/oscnet/1f987529-2c29-41f5-b72f-4e3857250cce.png" data-title="微博" rel="external nofollow noopener noreferrer"><i class="fa fa-weibo" style="padding-top:9px!important"></i></a></li></ul></div></div><div class="post-modal wx-share" id="wxShare"><a class="close" href="javascript:" id="wxShare-close">×</a><p>扫一扫，分享到微信</p><img src="//api.qrserver.com/v1/create-qr-code/?data=https://www.hosiang.cn/582c0207/" alt="微信分享二维码"></div><div class="mask"></div><ul class="article-footer-menu"><li class="article-footer-tags"><i class="fa fa-tags"></i> <a href="/tags/Popular/" class="color3">Popular</a></li></ul></footer></div></article><nav id="article-nav"><a href="/d8c30f85/" id="article-nav-newer" class="article-nav-link-wrap"><span class="article-nav-title"><i class="fa fa-hand-o-left" aria-hidden="true"></i> 推荐系列-别再面向 for 循环编程了，Spring 自带的观察者模式就很香！ </span></a><a href="/addfafe7/" id="article-nav-older" class="article-nav-link-wrap"><span class="article-nav-title">推荐系列-如何从 0 到 1 构建埋点体系</span> <i class="fa fa-hand-o-right" aria-hidden="true"></i></a></nav><div id="gitalk"></div><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script>var gitalk=new Gitalk({repo:"bolg-comment",owner:"Hosiang1026",admin:"Hosiang1026",clientID:"37a2dd4473e8970cecc2",clientSecret:"e30efa17d86d9de4f4ab810872dc62a7b2e7e634",pagerDirection:"last",distractionFreeMode:!0,createIssueManually:!1});gitalk.render("gitalk")</script></section></div><footer id="footer"><div class="outer"><div id="footer-info" class="inner"><script id="_wau78w">var _wau=_wau||[];_wau.push(["small","5dnguv4c2n","78w"])</script><script async src="//waust.at/s.js"></script><p><span id="busuanzi_container_site_uv" style="display:none"><span class="post-count">总字数：<span>1531.2k</span> </span>总访客数：<span id="busuanzi_value_site_uv"></span> </span><span id="busuanzi_container_site_pv" style="display:none">总访问量：<span id="busuanzi_value_site_pv"></span></span><br><span id="TimeShow">本站</span><span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span><br>Copyright&copy; 2018 - 2022 狂欢马克思 <a href="https://beian.miit.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">京ICP备17060439号</a></p></div></div><script>var now=new Date;function createtime(){var n=new Date("2017/09/18");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="安全运行 "+dnum+" 天 ",document.getElementById("times").innerHTML=hnum+" 小时 "+mnum+" 分 "+snum+" 秒"}setInterval("createtime()",800)</script></footer><script>var mihoConfig={root:"https://www.hosiang.cn",animate:"true",isHome:"false",share:"true",reward:" 1"}</script><div class="sidebar"><div id="sidebar-search" title="Search"><i class="fa fa-search"></i></div><div id="sidebar-category" title="Categories"><i class="fa fa-book"></i></div><div id="sidebar-tag" title="Tags"><i class="fa fa-tags"></i></div><div id="sidebar-top"><span class="sidebar-top-icon"><i class="fa fa-angle-up"></i></span></div></div><div class="sidebar-menu-box" id="sidebar-menu-box"><div class="sidebar-menu-box-container"><div id="sidebar-menu-box-categories"><a class="category-link" href="/categories/%E5%85%B4%E8%B6%A3%E7%88%B1%E5%A5%BD/">兴趣爱好</a><a class="category-link" href="/categories/%E5%85%B6%E4%BB%96%E5%BC%80%E5%8F%91/">其他开发</a><a class="category-link" href="/categories/%E5%89%8D%E6%B2%BF%E5%BC%80%E5%8F%91/">前沿开发</a><a class="category-link" href="/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">前端开发</a><a class="category-link" href="/categories/%E5%8D%87%E7%BA%A7%E7%89%88%E6%9C%AC/">升级版本</a><a class="category-link" href="/categories/%E5%8D%9A%E5%AE%A2%E6%95%99%E7%A8%8B/">博客教程</a><a class="category-link" href="/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/">后端开发</a><a class="category-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a><a class="category-link" href="/categories/%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/">日常记录</a><a class="category-link" href="/categories/%E7%83%AD%E9%97%A8%E6%96%87%E7%AB%A0/">热门文章</a></div><div id="sidebar-menu-box-tags"><a href="/tags/Ajax/" style="font-size:10px">Ajax</a> <a href="/tags/AliGenie/" style="font-size:10px">AliGenie</a> <a href="/tags/Alipay/" style="font-size:10px">Alipay</a> <a href="/tags/Android/" style="font-size:10px">Android</a> <a href="/tags/Blockchain/" style="font-size:17.5px">Blockchain</a> <a href="/tags/CQRS/" style="font-size:10px">CQRS</a> <a href="/tags/Database/" style="font-size:15px">Database</a> <a href="/tags/Docker/" style="font-size:10px">Docker</a> <a href="/tags/EasyUI/" style="font-size:10px">EasyUI</a> <a href="/tags/Guitar/" style="font-size:10px">Guitar</a> <a href="/tags/Hackintosh/" style="font-size:12.5px">Hackintosh</a> <a href="/tags/Hexo/" style="font-size:15px">Hexo</a> <a href="/tags/IntelliJ-IDEA/" style="font-size:10px">IntelliJ IDEA</a> <a href="/tags/Java/" style="font-size:12.5px">Java</a> <a href="/tags/Kali-Linux/" style="font-size:10px">Kali Linux</a> <a href="/tags/Life/" style="font-size:17.5px">Life</a> <a href="/tags/Mac-OS/" style="font-size:12.5px">Mac OS</a> <a href="/tags/MultiThread/" style="font-size:10px">MultiThread</a> <a href="/tags/NodeJS/" style="font-size:10px">NodeJS</a> <a href="/tags/Popular/" style="font-size:20px">Popular</a> <a href="/tags/Python/" style="font-size:10px">Python</a> <a href="/tags/SaaS/" style="font-size:10px">SaaS</a> <a href="/tags/Servlet/" style="font-size:10px">Servlet</a> <a href="/tags/Spring/" style="font-size:17.5px">Spring</a> <a href="/tags/Upgrade/" style="font-size:10px">Upgrade</a> <a href="/tags/Web/" style="font-size:10px">Web</a> <a href="/tags/Windows/" style="font-size:10px">Windows</a> <a href="/tags/Work/" style="font-size:10px">Work</a> <a href="/tags/iOS/" style="font-size:10px">iOS</a></div></div><a href="javascript:" class="sidebar-menu-box-close">&times;</a></div><div class="mobile-header-menu-nav" id="mobile-header-menu-nav"><div class="mobile-header-menu-container"><span class="title">导航</span><ul class="mobile-header-menu-navbar"><li><a href="/"><i class="fa fa-home"></i><span>主页</span></a></li><li><a href="/archives"><i class="fa fa-archive"></i><span>归档</span></a></li><li><a href="/gitbook"><i class="fa fa-columns"></i><span>笔记</span></a></li><li><a href="/music"><i class="fa fa-music"></i><span>音乐</span></a></li><li><a href="/photo"><i class="fa fa-picture-o"></i><span>相册</span></a></li><li><a href="/collection"><i class="fa fa-envira"></i><span>收藏</span></a></li><li><a href="/about"><i class="fa fa-user"></i><span>关于</span></a></li></ul></div><div class="mobile-header-tag-container"><span class="title">标签</span><div id="mobile-header-container-tags"><a href="/tags/Ajax/" style="font-size:10px">Ajax</a> <a href="/tags/AliGenie/" style="font-size:10px">AliGenie</a> <a href="/tags/Alipay/" style="font-size:10px">Alipay</a> <a href="/tags/Android/" style="font-size:10px">Android</a> <a href="/tags/Blockchain/" style="font-size:17.5px">Blockchain</a> <a href="/tags/CQRS/" style="font-size:10px">CQRS</a> <a href="/tags/Database/" style="font-size:15px">Database</a> <a href="/tags/Docker/" style="font-size:10px">Docker</a> <a href="/tags/EasyUI/" style="font-size:10px">EasyUI</a> <a href="/tags/Guitar/" style="font-size:10px">Guitar</a> <a href="/tags/Hackintosh/" style="font-size:12.5px">Hackintosh</a> <a href="/tags/Hexo/" style="font-size:15px">Hexo</a> <a href="/tags/IntelliJ-IDEA/" style="font-size:10px">IntelliJ IDEA</a> <a href="/tags/Java/" style="font-size:12.5px">Java</a> <a href="/tags/Kali-Linux/" style="font-size:10px">Kali Linux</a> <a href="/tags/Life/" style="font-size:17.5px">Life</a> <a href="/tags/Mac-OS/" style="font-size:12.5px">Mac OS</a> <a href="/tags/MultiThread/" style="font-size:10px">MultiThread</a> <a href="/tags/NodeJS/" style="font-size:10px">NodeJS</a> <a href="/tags/Popular/" style="font-size:20px">Popular</a> <a href="/tags/Python/" style="font-size:10px">Python</a> <a href="/tags/SaaS/" style="font-size:10px">SaaS</a> <a href="/tags/Servlet/" style="font-size:10px">Servlet</a> <a href="/tags/Spring/" style="font-size:17.5px">Spring</a> <a href="/tags/Upgrade/" style="font-size:10px">Upgrade</a> <a href="/tags/Web/" style="font-size:10px">Web</a> <a href="/tags/Windows/" style="font-size:10px">Windows</a> <a href="/tags/Work/" style="font-size:10px">Work</a> <a href="/tags/iOS/" style="font-size:10px">iOS</a></div></div></div><div class="search-wrap"><span class="search-close">&times;</span> <a href="javascript:" class="header-icon waves-effect waves-circle waves-light" id="back"><i class="icon icon-lg icon-chevron-left"></i> </a><input class="search-field" placeholder="Search..." id="keywords"> <a id="search-submit" href="javascript:"><i class="fa fa-search"></i></a><div class="search-container" id="search-container"><ul class="search-result" id="search-result"></ul></div></div><div id="search-tpl"><li class="search-result-item"><a href="{url}" class="search-item-li"><span class="search-item-li-title" title="{title}">{title}</span></a></li></div><script src="/js/search.js"></script><script src="/js/main.js"></script><script src="//cdn.bootcss.com/particles.js/2.0.0/particles.min.js"></script><div id="particles"></div><script src="/js/particles.js"></script><link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css"><script src="//cdn.bootcss.com/scrollReveal.js/3.0.5/scrollreveal.js"></script><script src="/js/animate.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/hijiki.model.json"},display:{position:"right",width:150,height:300},mobile:{show:!0,scale:.5},log:!1})</script></body></html>