<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="Access-Control-Allow-Origin" content="*"><script type="text/javascript">var start_time=(new Date).getTime()</script><meta http-equiv="Cache-Control" content="no-cache"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="google-site-verification" content="9Wt3lmnrT2bfjaHla5s16adhvcQcBHO7PtNf97n5Od0"><meta name="baidu-site-verification" content="RYlYHsgO7Y"><meta name="sogou_site_verification" content="MSmrTj7lHV"><meta name="shenma-site-verification" content="e4428ccce0f22fad61c3716193bf4bd7_1571416388"><meta name="baidu_union_verify" content="584bb6b4bd24108df082b6d20c7aa9be"><title>推荐系列-数据结构与算法的实际应用——根据表关系构建SQL语句 | 狂欢马克思</title><meta name="keywords" content="分享技术经验与交流"><meta name="description" content="&amp;emsp;&amp;emsp;背景需求 最近在项目中有一个场景，根据前端可视化模式传入的参数构建一组SQL语句，应用在Spark Streaming应用的数据同步中。这其实是一个已有的功能，但是发现原先的代码实现发现有较严重的…"><meta property="og:type" content="article"><meta property="og:title" content="推荐系列-数据结构与算法的实际应用——根据表关系构建SQL语句"><meta property="og:url" content="https://www.hosiang.cn/9c2d89b8/index.html"><meta property="og:site_name" content="狂欢马克思"><meta property="og:description" content="&amp;emsp;&amp;emsp;背景需求 最近在项目中有一个场景，根据前端可视化模式传入的参数构建一组SQL语句，应用在Spark Streaming应用的数据同步中。这其实是一个已有的功能，但是发现原先的代码实现发现有较严重的…"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-ad374c7f0532171add44d6e2141ace62855.png"><meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-ad374c7f0532171add44d6e2141ace62855.png"><meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-ad374c7f0532171add44d6e2141ace62855.png"><meta property="article:published_time" content="2021-04-15T01:46:45.000Z"><meta property="article:modified_time" content="2022-06-23T01:37:39.801Z"><meta property="article:author" content="Howe Hsiang"><meta property="article:tag" content="Popular"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://oscimg.oschina.net/oscnet/up-ad374c7f0532171add44d6e2141ace62855.png"><link rel="icon" href="/images/favicon.ico"><link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"><link href="https://cdn.bootcss.com/font-awesome-animation/0.1.0/font-awesome-animation.min.css" rel="stylesheet"><link rel="stylesheet" href="/css/style.css"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?3cd8fa109426bf3f10bd5c362175bace";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script></script><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><meta name="generator" content="Hexo 6.2.0"></head><script src="/js/jquery.min.js"></script><script src="/js/pace.min.js"></script><script src="/js/crypto-js.js"></script><script src="/js/cookie.js"></script><script src="/js/calendar.js"></script><script src="/js/festival.js"></script><script>getFestival()</script><body><script>window.onload=function(){document.getElementById("TimeShow").innerHTML="本站耗时 "+((new Date).getTime()-start_time)/1e3+" 秒 "}</script><div id="container"><header id="header"><div id="banner"></div><div id="header-outer"><div id="header-menu" class="header-menu-pos animated"><div class="header-menu-container"><a href="/" class="left"><span class="site-title">狂欢马克思</span></a><nav id="header-menu-nav" class="right"><a href="/" rel="external nofollow"><i class="fa fa-home"></i> <span>主页</span> </a><a href="/archives" rel="external nofollow"><i class="fa fa-archive"></i> <span>归档</span> </a><a href="/gitbook" rel="external nofollow"><i class="fa fa-columns"></i> <span>笔记</span> </a><a href="/music" rel="external nofollow"><i class="fa fa-music"></i> <span>音乐</span> </a><a href="/photo" rel="external nofollow"><i class="fa fa-picture-o"></i> <span>相册</span> </a><a href="/love" rel="external nofollow"><i class="fa fa-heart"></i> <span>恋爱</span> </a><a href="/collection" rel="external nofollow"><i class="fa fa-envira"></i> <span>收藏</span> </a><a href="/about" rel="external nofollow"><i class="fa fa-user"></i> <span>关于</span></a></nav><a class="mobile-header-menu-button"><i class="fa fa-bars"></i></a></div></div><div id="header-row"><div id="logo"><a href="/"><img src="/../images/logo.png" alt="logo"></a></div><div class="header-info"><div id="header-title"><h2>狂欢马克思</h2></div><div id="header-description"><h3>专注Web开发</h3></div></div><nav class="header-nav"><div class="social"><a title="Github" target="_blank" href="//github.com/Hosiang1026" rel="external nofollow"><i class="fa fa-github fa-2x"></i></a> <a title="QQ" target="_blank" href="//wpa.qq.com/msgrd?v=3&uin=641904695&site=qq&menu=yes" rel="external nofollow"><i class="fa fa-qq fa-2x"></i></a> <a title="Weibo" target="_blank" href="//www.weibo.com/haoxiang969" rel="external nofollow"><i class="fa fa-weibo fa-2x"></i></a></div></nav></div><script type="text/javascript" src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script><div id="noticeId" class="show" style="background:rgb(244,247,247,.3)"><marquee id="noticeMar" behavior="scoll" class="notice" direction="left" onmouseover="this.stop()" onmouseout="this.start()"></marquee></div><script type="text/javascript">function browserRedirect(){var i=navigator.userAgent.toLowerCase(),n="ipad"==i.match(/ipad/i),e="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),a="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),s="ucweb"==i.match(/ucweb/i),t="android"==i.match(/android/i),r="windows ce"==i.match(/windows ce/i),c="windows mobile"==i.match(/windows mobile/i),d="",m=randomColor(),d=n||e||o||a||s||t||r||c?($("#noticeId").css({"line-height":"1.6em"}),"<font style='color:"+m+"' face='新华宋体'  size='2'>官宣：<span id='msg'></span><span id='timer'></span><span id='jinrishici-sentence'></span></font> "):($("#noticeId").css({"line-height":"3.6em","margin-top":"20px"}),"<font style='color:"+m+"' face='新华宋体'  size='6'>官宣：<span id='weekend'></span><span id='msg'></span><span id='timer'></span><span id='jinrishici-sentence'></span></font> ");$("#noticeMar").html(d)}function randomColor(){for(var i="0,1,2,3,4,5,6,7,8,9,a,b,c,d,e,f".split(","),n="#",e=0;e<6;e++)n+=i[Math.floor(16*Math.random())];return n}$(function(){browserRedirect()})</script></div></header><script>console.log=function(){}</script><div class="outer"><section id="main" class="body-wrap"><article id="post-数据结构与算法的实际应用——根据表关系构建SQL语句" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="post-title" itemprop="name">推荐系列-数据结构与算法的实际应用——根据表关系构建SQL语句</h1><div class="post-title-bar"><ul><li><i class="fa fa-book"></i> <a href="/categories/热门文章/">热门文章</a></li><li><i class="fa fa-calendar"></i> 2021-04-15</li><li><i class="fa fa-eye"></i> <span id="busuanzi_value_page_pv"></span></li><li><span class="post-count">字数统计: 2.9k字</span></li><li><span class="post-count">阅读时长: 13分钟</span></li></ul></div></header><div class="article-entry post-content" itemprop="articleBody"><p>&amp;emsp;&amp;emsp;背景需求 最近在项目中有一个场景，根据前端可视化模式传入的参数构建一组SQL语句，应用在Spark Streaming应用的数据同步中。这其实是一个已有的功能，但是发现原先的代码实现发现有较严重的…</p><span id="more"></span><pre><code>                                                                                                                                                                                    #### 背景需求 
</code></pre><p>最近在项目中有一个场景，根据前端可视化模式传入的参数构建一组SQL语句，应用在Spark Streaming应用的数据同步中。这其实是一个已有的功能，但是发现原先的代码实现发现有较严重的问题，导致该功能在有关联查询时不可用，我经过调研之后决定重新实现。<br>这些SQL由普通的Lookup SQL和Spark SQL组成，Lookup SQL用于查询关联数据，SparkSQL则用于输出结果，核心问题在于如何合理组织这些表的关联关系。<br>PS：实现代码为Scala语言。</p><h4 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h4><p>其中前端传入的参数为</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="keyword">class</span> <span class="title class_">UpdateTask</span>(</span><br><span class="line">                    <span class="meta">@BeanProperty</span> id: Option[Long],</span><br><span class="line">                    <span class="meta">@BeanProperty</span> taskName: Option[String],</span><br><span class="line">                    <span class="meta">@BeanProperty</span> taskDesc: Option[String],</span><br><span class="line">                    <span class="meta">@BeanProperty</span> sourceInstance: Option[String],</span><br><span class="line">                    <span class="meta">@BeanProperty</span> targetInstance: Option[Long],</span><br><span class="line">                    <span class="meta">@BeanProperty</span> eventInstance: Option[Long],</span><br><span class="line">                    <span class="meta">@BeanProperty</span> sourceTree: Option[Seq[Long]],</span><br><span class="line">                    <span class="meta">@BeanProperty</span> selectSourceTree: Option[Seq[Long]],</span><br><span class="line">                    <span class="meta">@BeanProperty</span> targetTree: Option[Long],</span><br><span class="line">                    <span class="meta">@BeanProperty</span> eventTable: Option[Long],</span><br><span class="line">                    <span class="meta">@BeanProperty</span> tableRelation: Option[Seq[TableRelation]],</span><br><span class="line">                    <span class="meta">@BeanProperty</span> filterCondition: Option[String],</span><br><span class="line">                    <span class="meta">@BeanProperty</span> targetCalculateTableName: Option[String],</span><br><span class="line">                    <span class="meta">@BeanProperty</span> targetCalculate: Option[Seq[TargetCalculate]],</span><br><span class="line">                    <span class="meta">@BeanProperty</span> sourceTableField: Option[Seq[TableColumnInfo]],</span><br><span class="line">                    <span class="meta">@BeanProperty</span> sqlType: Option[Int],</span><br><span class="line">                    <span class="meta">@BeanProperty</span> classicSql: Option[String],</span><br><span class="line">                    <span class="meta">@BeanProperty</span> sinkConfig: Option[String],</span><br><span class="line">                    <span class="meta">@BeanProperty</span> targetPrimaryKey: Option[Seq[String]]</span><br><span class="line">                   ) <span class="keyword">extends</span> <span class="title class_">SimpleBaseEntity</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>所需要用的参数为</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eventTable</span><br></pre></td></tr></table></figure><p>: 触发表</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tableRelation</span><br></pre></td></tr></table></figure><p>: 表关联关系列表，其中<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TableRelation</span><br></pre></td></tr></table></figure><br>的结��为<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="keyword">class</span> <span class="title class_">TableRelation</span>(<span class="meta">@BeanProperty</span> leftTableSelect: Long,</span><br><span class="line">                       <span class="meta">@BeanProperty</span> rightTableSelect: Long,</span><br><span class="line">                       <span class="meta">@BeanProperty</span> leftColumnSelect: String,</span><br><span class="line">                       <span class="meta">@BeanProperty</span> rightColumnSelect: String)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">targetCalculate</span><br></pre></td></tr></table></figure><p>: 输出结果的计算表达式，其中<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TargetCalculate</span><br></pre></td></tr></table></figure><br>的结构为<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="keyword">class</span> <span class="title class_">TargetCalculate</span>(<span class="meta">@BeanProperty</span> columnName: String,</span><br><span class="line">                         <span class="meta">@BeanProperty</span> config: String)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selectSourceTree</span><br></pre></td></tr></table></figure><p>: 所用到的源表</p><h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h4><p>当没有关联关系的时候，比较简单，不在此讨论。当有多个关联关系时，应该先查询出被关联的表数据，再查询下一级的表，以此类推，实际场景下可能一般只有一两个表关联，但是毕竟还是需要考虑极端情况，原先的实现只考虑了简单的关联，复杂一点的关联则无法处理，经过一段时间思考后，决定基于树这种数据结构去实现此功能。<br>假设传入了如下一些表关系，并且A表为源表（触发表）：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">  A &lt;-&gt; B</span><br><span class="line">A &lt;-&gt; C</span><br><span class="line">A &lt;-&gt; D</span><br><span class="line">B &lt;-&gt; E</span><br><span class="line">B &lt;-&gt; F</span><br><span class="line">E &lt;-&gt; G</span><br><span class="line">C &lt;-&gt; H</span><br><span class="line">C &lt;-&gt; I</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>则经过处理后，可以生成如下一个树</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">               --&gt; E &lt;--&gt; G</span><br><span class="line">    --&gt; B &lt;--|</span><br><span class="line">    |        --&gt; F</span><br><span class="line">    |</span><br><span class="line">A &lt;----&gt; D</span><br><span class="line">    |</span><br><span class="line">    |        --&gt; H</span><br><span class="line">    --&gt; C &lt;--|</span><br><span class="line">             --&gt; I</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在此需要说明，不需要考虑左右顺序问题，例如 A &lt;-&gt; B 等价于 B &lt;-&gt; A，在后面对此问题会有说明。<br>当传入了多个相同的表关联关系时，需要做一个聚合，因为前端的参数中，每一个关联关系只包含一组关联字段，所以当有多个关联字段时，就传入了多个相同的关联关系，但是关联字段不同。<br>得到这个树形关系后，也同时得到了表之间的依赖关系，但是还有一个前提， 每个表只能依赖一个表，假设如下关系：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">               --&gt; E &lt;--&gt; G</span><br><span class="line">    --&gt; B &lt;--|</span><br><span class="line">    |        --&gt; F</span><br><span class="line">    |</span><br><span class="line">A &lt;----&gt; D</span><br><span class="line">    |</span><br><span class="line">    |        --&gt; H</span><br><span class="line">    --&gt; G &lt;--|</span><br><span class="line">             --&gt; I</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>此时，G表既可以由A得到，又可以由E得到，假设从A表得到G表，那么从G表又可以得到E表……产生了歧义，并由此产生一个了有环图。但是我们需求中目前没有这种关联关系（因为前端配置页面中，没有标识关联的方向性，即目前可视化模式传入的关联关系都是双向，对于一组关系，既可以从A得到B，也可以从B得到A，也就是前面的：A &lt;-&gt; B 等价于 B &lt;-&gt; A），所以不考虑这种情况，出现时给予报错，提示依赖关系产生了环。如果有方向性的话，我们生成树的算法会更简单一些，直接DFS即可，但是对于重复出现的表，需要做额外处理，例如给重复表起别名，保证结果集不会出现重名字段，否则Spark在处理过程中会产生异常。<br>在得到这个依赖关系后，后面的事情就好办了，我们从根节点开始层序遍历（也即为BFS广度优先遍历），逐层构建SQL语句，也可以采用树的先序遍历（DFS深度优先），只要保证子节点在父节点后面遍历即可，保证后面的SQL语句用到的关联参数在前面的SQL中已经查询到。<br>在生成SQL的过程中，为了避免不同库表有相同的表名或字段名，除了最后一句输出结果的Spark SQL，前面的SQL查询字段均需要起一个别名，在此沿用之前旧代码的方案：使用<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;字段名&#125; AS &#123;库名&#125;__&#123;表名&#125;__&#123;字段名&#125;</span><br></pre></td></tr></table></figure><br>的形式保证字段名不会重复<p></p><h4 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h4><h5 id="数据结构类定义"><a href="#数据结构类定义" class="headerlink" title="数据结构类定义"></a>数据结构类定义</h5><p>有了思路之后，便开始着手实现此功能，首先��义一个树节点的case类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="keyword">class</span> <span class="title class_">TableRelationTreeNode</span>(value: Long, <span class="comment">// 当前节点的表id</span></span><br><span class="line">                               parentRelation: LinkRelation, <span class="comment">// 和父节点的关联关系</span></span><br><span class="line">                               childs: ListBuffer[TableRelationTreeNode]  <span class="comment">// 子节点</span></span><br><span class="line">                               )</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LinkRelation</span><br></pre></td></tr></table></figure><p>描述了两个表之间的关联关系，是对前端传入的<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TableRelation</span><br></pre></td></tr></table></figure><br>聚合后的结果：<p></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="keyword">class</span> <span class="title class_">LinkRelation</span>(leftTable: Long, <span class="comment">// 左表id</span></span><br><span class="line">                      rightTable: Long, <span class="comment">// 右表id</span></span><br><span class="line">                      linkFields: Seq[(String, String)] <span class="comment">// 关联字段, 元组的两个参数分别为左表字段、右表字段</span></span><br><span class="line">                      )</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="关联关系树的构建"><a href="#关联关系树的构建" class="headerlink" title="关联关系树的构建"></a>关联关系树的构建</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> parentNode      父节点</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> remainRelations 剩余关联关系</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">def <span class="title function_">buildRelationTree</span><span class="params">(parentNode: TableRelationTreeNode, remainRelations: ListBuffer[LinkRelation])</span>: Any = &#123;</span><br><span class="line">  <span class="keyword">if</span> (remainRelations.isEmpty) <span class="keyword">return</span></span><br><span class="line">  <span class="type">val</span> <span class="variable">parentTableId</span> <span class="operator">=</span> parentNode.value;</span><br><span class="line">  <span class="comment">// 找出关联关系中包含父节点的表id</span></span><br><span class="line">  <span class="type">val</span> <span class="variable">childRelation</span> <span class="operator">=</span> remainRelations.filter(e =&gt; e.leftTable == parentTableId || e.rightTable == parentTableId)</span><br><span class="line">  <span class="keyword">if</span> (childRelation.isEmpty) <span class="keyword">return</span></span><br><span class="line">  <span class="comment">// 将关联关系中父节点的关联信息置于左侧，方便后续操作</span></span><br><span class="line">  childRelation</span><br><span class="line">    .map(e =&gt; <span class="keyword">if</span> (e.leftTable == parentTableId) e <span class="keyword">else</span> LinkRelation(e.rightTable, e.leftTable, e.linkFields.map(e =&gt; (e._2, e._1))))</span><br><span class="line">    .foreach&#123;e =&gt; parentNode.childs += TableRelationTreeNode(e.rightTable, e, <span class="keyword">new</span> <span class="title class_">ListBuffer</span>())&#125;</span><br><span class="line">	<span class="comment">// 移除已经使用过的关联关系</span></span><br><span class="line">  remainRelations --= childRelation</span><br><span class="line">  parentNode.childs foreach &#123;buildRelationTree(_, remainRelations)&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="SQL语句生成的核心代码"><a href="#SQL语句生成的核心代码" class="headerlink" title="SQL语句生成的核心代码"></a>SQL语句生成的核心代码</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">def <span class="title function_">buildTransSQL</span><span class="params">(task: UpdateTask)</span>: Seq[String] = &#123;</span><br><span class="line"><span class="comment">// 存储所有用到的表（namespace为表的信息）</span></span><br><span class="line">  <span class="type">val</span> <span class="variable">namespacesRef</span> <span class="operator">=</span> mutable.HashMap[Long, Namespace]()</span><br><span class="line">  task.selectSourceTree.get.foreach(i =&gt; namespacesRef += (kv = (i, Await.result(namespaceDal.findById(i), minTimeOut).get)))</span><br><span class="line">  <span class="type">val</span> <span class="variable">targetTableId</span> <span class="operator">=</span> task.targetTree.get</span><br><span class="line"><span class="comment">// 目标表</span></span><br><span class="line">  <span class="type">val</span> <span class="variable">targetNamespace</span> <span class="operator">=</span> Await.result(namespaceDal.findById(targetTableId), minTimeOut).head</span><br><span class="line">  namespacesRef.put(targetTableId, targetNamespace)</span><br><span class="line">  <span class="type">val</span> <span class="variable">eventTableId</span> <span class="operator">=</span> task.eventTable.get</span><br><span class="line"><span class="comment">// 事件表（源/触发表）</span></span><br><span class="line">  <span class="type">val</span> <span class="variable">eventNamespace</span> <span class="operator">=</span> namespacesRef(eventTableId)</span><br><span class="line"><span class="comment">// 没有计算逻辑，当做镜像同步，直接SELECT * ...</span></span><br><span class="line">  <span class="keyword">if</span> (task.targetCalculate.isEmpty)</span><br><span class="line">    <span class="keyword">return</span> Seq.newBuilder.+=(s<span class="string">&quot;spark_sql= select * from $&#123;eventNamespace.nsTable&#125;;&quot;</span>).result()</span><br><span class="line"></span><br><span class="line">  <span class="type">val</span> <span class="variable">transSqlList</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListBuffer</span>[String]</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 先将触发表的所有字段查询出来</span></span><br><span class="line">  transSqlList += s<span class="string">&quot;spark_sql= select $&#123;</span></span><br><span class="line"><span class="string">    sourceDataDal.getSourceDataTableField(eventTableId).filter(_ != &quot;</span>ums_active_<span class="string">&quot;).map(e =&gt; &#123;</span></span><br><span class="line"><span class="string">      s&quot;</span>$e AS $&#123;eventNamespace.nsDatabase&#125;__$&#123;eventNamespace.nsTable&#125;__$e<span class="string">&quot;</span></span><br><span class="line"><span class="string">    &#125;).mkString(&quot;</span>, <span class="string">&quot;)</span></span><br><span class="line"><span class="string">  &#125; from $&#123;eventNamespace.nsTable&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (task.getTableRelation.nonEmpty) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">val</span> <span class="variable">remainLinks</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListBuffer</span>[LinkRelation]()</span><br><span class="line">    <span class="comment">// 聚合重复的表关联关系</span></span><br><span class="line">    task.getTableRelation.getOrElse(Seq.empty)</span><br><span class="line">      .map(e =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (e.leftTableSelect &gt; e.rightTableSelect) &#123;</span><br><span class="line">          TableRelation(</span><br><span class="line">            leftTableSelect = e.rightTableSelect,</span><br><span class="line">            rightTableSelect = e.leftTableSelect,</span><br><span class="line">            leftColumnSelect = e.rightColumnSelect,</span><br><span class="line">            rightColumnSelect = e.leftColumnSelect</span><br><span class="line">          )</span><br><span class="line">        &#125; <span class="keyword">else</span> e</span><br><span class="line">      &#125;)</span><br><span class="line">      .groupBy(e =&gt; s<span class="string">&quot;$&#123;e.leftTableSelect&#125;-$&#123;e.rightTableSelect&#125;&quot;</span>)</span><br><span class="line">      .map(e =&gt; &#123;</span><br><span class="line">        LinkRelation(</span><br><span class="line">          leftTable = e._2.head.leftTableSelect,</span><br><span class="line">          rightTable = e._2.head.rightTableSelect,</span><br><span class="line">          linkFields = e._2.map(e =&gt; (e.leftColumnSelect, e.rightColumnSelect))</span><br><span class="line">        )</span><br><span class="line">      &#125;) foreach &#123;</span><br><span class="line">      remainLinks += _</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 根结点</span></span><br><span class="line">    <span class="type">val</span> <span class="variable">rootTreeNode</span> <span class="operator">=</span> TableRelationTreeNode(</span><br><span class="line">      eventTableId,</span><br><span class="line">      <span class="literal">null</span>,</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">ListBuffer</span>[TableRelationTreeNode]</span><br><span class="line">    )</span><br><span class="line">    <span class="comment">// 构建关系树</span></span><br><span class="line">    buildRelationTree(rootTreeNode, remainLinks)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果有剩余的关系未被使用，则说明有无法连接到根节点的关系，抛出异常</span></span><br><span class="line">    <span class="keyword">if</span> (remainLinks.nonEmpty) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(s<span class="string">&quot;游离的关联关系：$&#123;</span></span><br><span class="line"><span class="string">        remainLinks.map(e =&gt; &#123;</span></span><br><span class="line"><span class="string">          val leftNs = namespacesRef(e.leftTable)</span></span><br><span class="line"><span class="string">          val rightNs = namespacesRef(e.rightTable)</span></span><br><span class="line"><span class="string">          s&quot;</span>$&#123;leftNs.nsDatabase&#125;.$&#123;leftNs.nsTable&#125; &lt;-&gt; $&#123;rightNs.nsDatabase&#125;.$&#123;rightNs.nsTable&#125;<span class="string">&quot;</span></span><br><span class="line"><span class="string">        &#125;).toString</span></span><br><span class="line"><span class="string">      &#125;\n无法与根节点($&#123;eventNamespace.nsDatabase&#125;.$&#123;eventNamespace.nsTable&#125;)建立关系&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">val</span> <span class="variable">queue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">mutable</span>.Queue[TableRelationTreeNode]</span><br><span class="line">    queue.enqueue(rootTreeNode)</span><br><span class="line">    <span class="comment">// 广度优先遍历，逐层构建SQL语句，保证依赖顺序</span></span><br><span class="line">    <span class="keyword">while</span> (queue.nonEmpty) &#123;</span><br><span class="line">      <span class="type">val</span> <span class="variable">len</span> <span class="operator">=</span> queue.size</span><br><span class="line">      <span class="title function_">for</span> <span class="params">(i &lt;- <span class="number">0</span> until len)</span> &#123;</span><br><span class="line">        <span class="type">val</span> <span class="variable">node</span> <span class="operator">=</span> queue.dequeue</span><br><span class="line">        <span class="title function_">if</span> <span class="params">(node.value != eventTableId)</span> &#123;</span><br><span class="line">          <span class="type">val</span> <span class="variable">relation</span> <span class="operator">=</span> node.parentRelation</span><br><span class="line">          <span class="comment">// 当前节点表</span></span><br><span class="line">          <span class="type">val</span> <span class="variable">curNs</span> <span class="operator">=</span> namespacesRef(node.value)</span><br><span class="line">          <span class="comment">// 父节点表</span></span><br><span class="line">          <span class="type">val</span> <span class="variable">parNs</span> <span class="operator">=</span> namespacesRef(relation.leftTable)</span><br><span class="line">          <span class="type">val</span> <span class="variable">curTableName</span> <span class="operator">=</span> s<span class="string">&quot;$&#123;curNs.nsDatabase&#125;.$&#123;curNs.nsTable&#125;&quot;</span></span><br><span class="line">          <span class="type">val</span> <span class="variable">fields</span> <span class="operator">=</span> sourceDataDal.getSourceDataTableField(node.value)</span><br><span class="line">          <span class="type">val</span> <span class="variable">fieldAliasPrefix</span> <span class="operator">=</span> s<span class="string">&quot;$&#123;curNs.nsDatabase&#125;__$&#123;curNs.nsTable&#125;__&quot;</span></span><br><span class="line">          <span class="comment">// 构建lookup SQL</span></span><br><span class="line">          transSqlList += s<span class="string">&quot;pushdown_sql left join with $&#123;curNs.nsSys&#125;.$&#123;curNs.nsInstance&#125;.$&#123;curNs.nsDatabase&#125;=select $&#123;</span></span><br><span class="line"><span class="string">            fields.map(f =&gt; s&quot;</span>$f as $fieldAliasPrefix$f<span class="string">&quot;).mkString(&quot;</span>, <span class="string">&quot;)</span></span><br><span class="line"><span class="string">          &#125; from $curTableName where ($&#123;</span></span><br><span class="line"><span class="string">            relation.linkFields.map(_._2.replaceAll(&quot;</span>.*\\.<span class="string">&quot;, &quot;</span><span class="string">&quot;)).mkString(&quot;</span>,<span class="string">&quot;)</span></span><br><span class="line"><span class="string">          &#125;) in ($&#123;relation.linkFields.map(_._1.replace(&quot;</span>.<span class="string">&quot;,&quot;</span>__<span class="string">&quot;)).map(e =&gt; &quot;</span>$&#123;<span class="string">&quot; + e + &quot;</span>&#125;<span class="string">&quot;).mkString(&quot;</span>,<span class="string">&quot;)&#125;)&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        node.childs foreach &#123; queue.enqueue(_) &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 输出最终结果集的SparkSQL</span></span><br><span class="line">  transSqlList += s<span class="string">&quot;spark_sql= select $&#123;</span></span><br><span class="line"><span class="string">    task.targetCalculate.get.map &#123; e =&gt;</span></span><br><span class="line"><span class="string">      s&quot;</span>$&#123;e.config.replaceAll(<span class="string">&quot;(\\w+)\\.(\\w+)\\.(\\w+)&quot;</span>, <span class="string">&quot;$1__$2__$3&quot;</span>)&#125; as $&#123;e.columnName&#125;<span class="string">&quot;</span></span><br><span class="line"><span class="string">    &#125;.mkString(&quot;</span>, <span class="string">&quot;)</span></span><br><span class="line"><span class="string">  &#125; from $&#123;eventNamespace.nsTable&#125; where $&#123;if (task.filterCondition.getOrElse(&quot;</span><span class="string">&quot;) == &quot;</span><span class="string">&quot;) &quot;</span><span class="number">1</span>=<span class="number">1</span><span class="string">&quot; else task.filterCondition.get&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">  transSqlList.toSeq</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><p>我新建了几张测试表，并使用小程序向库中随机生成了一些数据，然后又新建了一个目标表，以此来测试该功能，过程如下</p><h5 id="前端配置"><a href="#前端配置" class="headerlink" title="前端配置"></a>前端配置</h5><p>关联关系<br><img src="https://oscimg.oschina.net/oscnet/up-ad374c7f0532171add44d6e2141ace62855.png" alt="Test" title="数据结构与算法的实际应用——根据表关系构建SQL语句"><br>计算逻辑<br><img src="https://oscimg.oschina.net/oscnet/up-ad374c7f0532171add44d6e2141ace62855.png" alt="Test" title="数据结构与算法的实际应用——根据表关系构建SQL语句"><br>抽象出的关联关系应为：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">                                           ------&gt; customer_transaction</span><br><span class="line">                                         |</span><br><span class="line">customer &lt;---&gt; customer_account_info &lt;----</span><br><span class="line">                                         |</span><br><span class="line">                                         ------&gt; customer_seller_relation  &lt;-----&gt; seller_info</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="后台生成的SQL："><a href="#后台生成的SQL：" class="headerlink" title="后台生成的SQL："></a>后台生成的SQL：</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line">  spark_sql =</span><br><span class="line">select</span><br><span class="line">  address AS adp_mock_spr_mirror__customer__address,</span><br><span class="line">  company AS adp_mock_spr_mirror__customer__company,</span><br><span class="line">  gender AS adp_mock_spr_mirror__customer__gender,</span><br><span class="line">  id AS adp_mock_spr_mirror__customer__id,</span><br><span class="line">  id_card AS adp_mock_spr_mirror__customer__id_card,</span><br><span class="line">  mobile AS adp_mock_spr_mirror__customer__mobile,</span><br><span class="line">  real_name AS adp_mock_spr_mirror__customer__real_name,</span><br><span class="line">  ums_id_ AS adp_mock_spr_mirror__customer__ums_id_,</span><br><span class="line">  ums_op_ AS adp_mock_spr_mirror__customer__ums_op_,</span><br><span class="line">  ums_ts_ AS adp_mock_spr_mirror__customer__ums_ts_</span><br><span class="line">from</span><br><span class="line">  customer;</span><br><span class="line"></span><br><span class="line">pushdown_sql</span><br><span class="line">  left join with tidb.spr_ods_department.adp_mock_spr_mirror =</span><br><span class="line">select</span><br><span class="line">  account_bank as adp_mock_spr_mirror__customer_account_info__account_bank,</span><br><span class="line">  account_level as adp_mock_spr_mirror__customer_account_info__account_level,</span><br><span class="line">  account_no as adp_mock_spr_mirror__customer_account_info__account_no,</span><br><span class="line">  customer_id as adp_mock_spr_mirror__customer_account_info__customer_id,</span><br><span class="line">  entry_time as adp_mock_spr_mirror__customer_account_info__entry_time,</span><br><span class="line">  id as adp_mock_spr_mirror__customer_account_info__id,</span><br><span class="line">  loc_seller as adp_mock_spr_mirror__customer_account_info__loc_seller,</span><br><span class="line">  risk_level as adp_mock_spr_mirror__customer_account_info__risk_level,</span><br><span class="line">  risk_test_date as adp_mock_spr_mirror__customer_account_info__risk_test_date,</span><br><span class="line">  ums_active_ as adp_mock_spr_mirror__customer_account_info__ums_active_,</span><br><span class="line">  ums_id_ as adp_mock_spr_mirror__customer_account_info__ums_id_,</span><br><span class="line">  ums_op_ as adp_mock_spr_mirror__customer_account_info__ums_op_,</span><br><span class="line">  ums_ts_ as adp_mock_spr_mirror__customer_account_info__ums_ts_</span><br><span class="line">from</span><br><span class="line">  adp_mock_spr_mirror.customer_account_info</span><br><span class="line"><span class="title function_">where</span></span><br><span class="line">  <span class="params">(id)</span> in ($ &#123; adp_mock_spr_mirror__customer__id &#125;);</span><br><span class="line"></span><br><span class="line">pushdown_sql</span><br><span class="line">  left join with tidb.spr_ods_department.adp_mock_spr_mirror =</span><br><span class="line">select</span><br><span class="line">  customer_id as adp_mock_spr_mirror__customer_seller_relation__customer_id,</span><br><span class="line">  id as adp_mock_spr_mirror__customer_seller_relation__id,</span><br><span class="line">  relation_type as adp_mock_spr_mirror__customer_seller_relation__relation_type,</span><br><span class="line">  seller_id as adp_mock_spr_mirror__customer_seller_relation__seller_id,</span><br><span class="line">  ums_active_ as adp_mock_spr_mirror__customer_seller_relation__ums_active_,</span><br><span class="line">  ums_id_ as adp_mock_spr_mirror__customer_seller_relation__ums_id_,</span><br><span class="line">  ums_op_ as adp_mock_spr_mirror__customer_seller_relation__ums_op_,</span><br><span class="line">  ums_ts_ as adp_mock_spr_mirror__customer_seller_relation__ums_ts_,</span><br><span class="line">  wechat_relation as adp_mock_spr_mirror__customer_seller_relation__wechat_relation</span><br><span class="line">from</span><br><span class="line">  adp_mock_spr_mirror.customer_seller_relation</span><br><span class="line"><span class="title function_">where</span></span><br><span class="line">  <span class="params">(customer_id)</span> in (</span><br><span class="line">    $ &#123; adp_mock_spr_mirror__customer_account_info__id &#125;</span><br><span class="line">  );</span><br><span class="line">  </span><br><span class="line">pushdown_sql</span><br><span class="line">  left join with tidb.spr_ods_department.adp_mock_spr_mirror =</span><br><span class="line">select</span><br><span class="line">  balance as adp_mock_spr_mirror__customer_transaction__balance,</span><br><span class="line">  borrow_loan as adp_mock_spr_mirror__customer_transaction__borrow_loan,</span><br><span class="line">  comment as adp_mock_spr_mirror__customer_transaction__comment,</span><br><span class="line">  customer_account_id as adp_mock_spr_mirror__customer_transaction__customer_account_id,</span><br><span class="line">  customer_id as adp_mock_spr_mirror__customer_transaction__customer_id,</span><br><span class="line">  deal_abstract_code as adp_mock_spr_mirror__customer_transaction__deal_abstract_code,</span><br><span class="line">  deal_account_type_code as adp_mock_spr_mirror__customer_transaction__deal_account_type_code,</span><br><span class="line">  deal_code as adp_mock_spr_mirror__customer_transaction__deal_code,</span><br><span class="line">  deal_partner_account as adp_mock_spr_mirror__customer_transaction__deal_partner_account,</span><br><span class="line">  deal_partner_name as adp_mock_spr_mirror__customer_transaction__deal_partner_name,</span><br><span class="line">  deal_partner_ogr_name as adp_mock_spr_mirror__customer_transaction__deal_partner_ogr_name,</span><br><span class="line">  deal_partner_org_num as adp_mock_spr_mirror__customer_transaction__deal_partner_org_num,</span><br><span class="line">  id as adp_mock_spr_mirror__customer_transaction__id,</span><br><span class="line">  subject as adp_mock_spr_mirror__customer_transaction__subject,</span><br><span class="line">  transaction_amount as adp_mock_spr_mirror__customer_transaction__transaction_amount,</span><br><span class="line">  transaction_time as adp_mock_spr_mirror__customer_transaction__transaction_time,</span><br><span class="line">  ums_active_ as adp_mock_spr_mirror__customer_transaction__ums_active_,</span><br><span class="line">  ums_id_ as adp_mock_spr_mirror__customer_transaction__ums_id_,</span><br><span class="line">  ums_op_ as adp_mock_spr_mirror__customer_transaction__ums_op_,</span><br><span class="line">  ums_ts_ as adp_mock_spr_mirror__customer_transaction__ums_ts_</span><br><span class="line">from</span><br><span class="line">  adp_mock_spr_mirror.customer_transaction</span><br><span class="line"><span class="title function_">where</span></span><br><span class="line">  <span class="params">(customer_id, customer_account_id)</span> in (</span><br><span class="line">    $ &#123; adp_mock_spr_mirror__customer_account_info__id &#125;,</span><br><span class="line">    $ &#123; adp_mock_spr_mirror__customer_account_info__account_no &#125;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">pushdown_sql</span><br><span class="line">  left join with tidb.spr_ods_department.adp_mock_spr_mirror =</span><br><span class="line">select</span><br><span class="line">  current_bank as adp_mock_spr_mirror__seller_info__current_bank,</span><br><span class="line">  department_id as adp_mock_spr_mirror__seller_info__department_id,</span><br><span class="line">  email as adp_mock_spr_mirror__seller_info__email,</span><br><span class="line">  entry_time as adp_mock_spr_mirror__seller_info__entry_time,</span><br><span class="line">  id as adp_mock_spr_mirror__seller_info__id,</span><br><span class="line">  id_card as adp_mock_spr_mirror__seller_info__id_card,</span><br><span class="line">  leader_id as adp_mock_spr_mirror__seller_info__leader_id,</span><br><span class="line">  mobile as adp_mock_spr_mirror__seller_info__mobile,</span><br><span class="line">  name as adp_mock_spr_mirror__seller_info__name,</span><br><span class="line">  position as adp_mock_spr_mirror__seller_info__position,</span><br><span class="line">  tenant_id as adp_mock_spr_mirror__seller_info__tenant_id,</span><br><span class="line">  ums_active_ as adp_mock_spr_mirror__seller_info__ums_active_,</span><br><span class="line">  ums_id_ as adp_mock_spr_mirror__seller_info__ums_id_,</span><br><span class="line">  ums_op_ as adp_mock_spr_mirror__seller_info__ums_op_,</span><br><span class="line">  ums_ts_ as adp_mock_spr_mirror__seller_info__ums_ts_</span><br><span class="line">from</span><br><span class="line">  adp_mock_spr_mirror.seller_info</span><br><span class="line"><span class="title function_">where</span></span><br><span class="line">  <span class="params">(id)</span> in (</span><br><span class="line">    $ &#123; adp_mock_spr_mirror__customer_seller_relation__seller_id &#125;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">spark_sql =</span><br><span class="line">select</span><br><span class="line">  adp_mock_spr_mirror__customer_account_info__id as id,</span><br><span class="line">  adp_mock_spr_mirror__customer__real_name as name,</span><br><span class="line">  IF(adp_mock_spr_mirror__customer__gender = <span class="number">0</span>, <span class="string">&quot;0&quot;</span>, <span class="string">&quot;1&quot;</span>) as sex,</span><br><span class="line">  adp_mock_spr_mirror__seller_info__department_id as age,</span><br><span class="line">  adp_mock_spr_mirror__customer__mobile as phone,</span><br><span class="line">  adp_mock_spr_mirror__seller_info__entry_time as born,</span><br><span class="line">  adp_mock_spr_mirror__customer__address as address,</span><br><span class="line">  IF(</span><br><span class="line">    adp_mock_spr_mirror__customer_transaction__borrow_loan = <span class="number">1</span>,</span><br><span class="line">    <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;0&quot;</span></span><br><span class="line">  ) as married,</span><br><span class="line">  NOW() as create_time,</span><br><span class="line">  NOW() as update_time,</span><br><span class="line">  <span class="string">&#x27;P&#x27;</span> as zodiac</span><br><span class="line">from</span><br><span class="line">  customer</span><br><span class="line">where</span><br><span class="line">  <span class="number">1</span> = <span class="number">1</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="同步结果"><a href="#同步结果" class="headerlink" title="同步结果"></a>同步结果</h5><p><img src="https://oscimg.oschina.net/oscnet/up-ad374c7f0532171add44d6e2141ace62855.png" alt="Test" title="数据结构与算法的实际应用——根据表关系构建SQL语句"><br>从Spark后台日志中可以看到，数据已经正常插入目标表。</p><h4 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h4><p>以上是树和BFS在实际开发场景中的一个应用，代码实现其实较为简单，重点是实现的思路，当然解决问题的方法并不是唯一的，在此问题中，也可以在构建树的过程中直接构建SQL语句，省去后续的BFS过程，但是我考虑到后续可能增加的需求，还是将此处拆成了两步，方便后续在扩展，根据实际场景选择方案即可。另外，计算逻辑中缺少字段强校验，当用户输入错误字段时在运行期间才能察觉到，考虑后期再增加此功能。<br>有不对的地方欢迎指正，希望本文对大家有所帮助。</p><div class="post-copyright"><div class="content"><p>本文标题： 推荐系列-数据结构与算法的实际应用——根据表关系构建SQL语句</p><p>本文作者： OSChina</p><p>发布时间： 2021年04月15日 09:46</p><p>最后更新： 2022年06月23日 09:37</p><p>原始链接： <a class="post-url" href="/9c2d89b8/" title="推荐系列-数据结构与算法的实际应用——根据表关系构建SQL语句">https://www.hosiang.cn/9c2d89b8/</a></p><p>版权声明： 本文著作权归作者所有，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener noreferrer" target="_blank">CC BY-NC-SA 4.0</a>许可协议，转载请注明出处！</p><footer><a href="https://www.hosiang.cn"><img src="/../images/logo.png" alt="Howe Hsiang"> Howe Hsiang</a></footer></div></div><div class="page-reward"><a id="rewardBtn" href="javascript:;">赏</a></div><div id="reward" class="post-modal reward-lay"><a class="close" href="javascript:;" id="reward-close">×</a> <span class="reward-title"><i class="icon icon-quote-left"></i> 喜欢就赞赏一下呗！ <i class="icon icon-quote-right"></i></span><div class="reward-content"><div class="reward-code"><img id="rewardCode" src="/images/threepay_code.jpg" alt="打赏二维码"></div><div class="reward-select"></div></div></div></div><footer class="article-footer"><div class="post-share"><a href="javascript:" id="share-sub" class="post-share-fab"><i class="fa fa-share-alt" style="padding-top:11px!important"></i></a><div class="post-share-list" id="share-list"><ul class="share-icons"><li><a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://www.hosiang.cn/9c2d89b8/" data-title="Facebook" rel="external nofollow noopener noreferrer"><i class="fa fa-facebook" style="padding-top:9px!important"></i></a></li><li><a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《推荐系列-数据结构与算法的实际应用——根据表关系构建SQL语句》 — 狂欢马克思&url=https://www.hosiang.cn/9c2d89b8/&via=https://www.hosiang.cn" data-title="Twitter" rel="external nofollow noopener noreferrer"><i class="fa fa-twitter" style="padding-top:9px!important"></i></a></li><li><a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://www.hosiang.cn/9c2d89b8/" data-title="Google+" rel="external nofollow noopener noreferrer"><i class="fa fa-google-plus" style="padding-top:9px!important"></i></a></li><li><a class="qq share-sns" target="_blank" href="https://connect.qq.com/widget/shareqq/index.html?url=https://www.hosiang.cn/9c2d89b8/&title=《推荐系列-数据结构与算法的实际应用——根据表关系构建SQL语句》 — 狂欢马克思&source=&amp;emsp;&amp;emsp;背景需求 最近在项目中有一个场景，根据前端可视化模式传入的参数构建一组SQL语句，应用在Spark Streami..." data-title="QQ" rel="external nofollow noopener noreferrer"><i class="fa fa-qq" style="padding-top:9px!important"></i></a></li><li><a class="weixin share-sns" id="wxFab" href="javascript:" data-title="微信"><i class="fa fa-weixin" style="padding-top:9px!important"></i></a></li><li><a class="weibo share-sns" target="_blank" href="https://service.weibo.com/share/share.php?url=https://www.hosiang.cn/9c2d89b8/&title=《推荐系列-数据结构与算法的实际应用——根据表关系构建SQL语句》 — 狂欢马克思&pic=https://oscimg.oschina.net/oscnet/up-ad374c7f0532171add44d6e2141ace62855.png" data-title="微博" rel="external nofollow noopener noreferrer"><i class="fa fa-weibo" style="padding-top:9px!important"></i></a></li></ul></div></div><div class="post-modal wx-share" id="wxShare"><a class="close" href="javascript:" id="wxShare-close">×</a><p>扫一扫，分享到微信</p><img src="//api.qrserver.com/v1/create-qr-code/?data=https://www.hosiang.cn/9c2d89b8/" alt="微信分享二维码"></div><div class="mask"></div><ul class="article-footer-menu"><li class="article-footer-tags"><i class="fa fa-tags"></i> <a href="/tags/Popular/" class="color3">Popular</a></li></ul></footer></div></article><aside class="post-toc-pos post-toc-top" id="post-toc"><nav class="post-toc-wrap"><ol class="post-toc"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%8F%82%E6%95%B0"><span class="post-toc-text">参数</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="post-toc-text">解决方案</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="post-toc-text">代码实现</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%B1%BB%E5%AE%9A%E4%B9%89"><span class="post-toc-text">数据结构类定义</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E5%85%B3%E8%81%94%E5%85%B3%E7%B3%BB%E6%A0%91%E7%9A%84%E6%9E%84%E5%BB%BA"><span class="post-toc-text">关联关系树的构建</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#SQL%E8%AF%AD%E5%8F%A5%E7%94%9F%E6%88%90%E7%9A%84%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81"><span class="post-toc-text">SQL语句生成的核心代码</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="post-toc-text">测试</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E5%89%8D%E7%AB%AF%E9%85%8D%E7%BD%AE"><span class="post-toc-text">前端配置</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E5%90%8E%E5%8F%B0%E7%94%9F%E6%88%90%E7%9A%84SQL%EF%BC%9A"><span class="post-toc-text">后台生成的SQL：</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E5%90%8C%E6%AD%A5%E7%BB%93%E6%9E%9C"><span class="post-toc-text">同步结果</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E7%BB%93%E8%AF%AD"><span class="post-toc-text">结语</span></a></li></ol></nav></aside><nav id="article-nav"><a href="/628ad5bd/" id="article-nav-newer" class="article-nav-link-wrap"><span class="article-nav-title"><i class="fa fa-hand-o-left" aria-hidden="true"></i> 推荐系列-数据加密-你应该知道的数仓安全 </span></a><a href="/4fe84162/" id="article-nav-older" class="article-nav-link-wrap"><span class="article-nav-title">推荐系列-文字识别-关键信息提取的3种探索方法</span> <i class="fa fa-hand-o-right" aria-hidden="true"></i></a></nav><div id="gitalk"></div><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script>var gitalk=new Gitalk({repo:"bolg-comment",owner:"Hosiang1026",admin:"Hosiang1026",clientID:"37a2dd4473e8970cecc2",clientSecret:"e30efa17d86d9de4f4ab810872dc62a7b2e7e634",pagerDirection:"last",distractionFreeMode:!0,createIssueManually:!1});gitalk.render("gitalk")</script></section></div><footer id="footer"><div class="outer"><div id="footer-info" class="inner"><script id="_wau78w">var _wau=_wau||[];_wau.push(["small","5dnguv4c2n","78w"])</script><script async src="//waust.at/s.js"></script><p><span id="busuanzi_container_site_uv" style="display:none"><span class="post-count">总字数：<span>1777.3k</span> </span>总访客数：<span id="busuanzi_value_site_uv"></span> </span><span id="busuanzi_container_site_pv" style="display:none">总访问量：<span id="busuanzi_value_site_pv"></span></span><br><span id="TimeShow">本站</span><span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span><br>Copyright&copy; 2018 - 2022 狂欢马克思 <a href="https://beian.miit.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">京ICP备17060439号</a></p></div></div><script>var now=new Date;function createtime(){var n=new Date("2017/09/18");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="安全运行 "+dnum+" 天 ",document.getElementById("times").innerHTML=hnum+" 小时 "+mnum+" 分 "+snum+" 秒"}setInterval("createtime()",800)</script></footer><script>var mihoConfig={root:"https://www.hosiang.cn",animate:"true",isHome:"false",share:"true",reward:" 1"}</script><div class="sidebar"><div id="sidebar-search" title="Search"><i class="fa fa-search"></i></div><div id="sidebar-category" title="Categories"><i class="fa fa-book"></i></div><div id="sidebar-tag" title="Tags"><i class="fa fa-tags"></i></div><div id="sidebar-top"><span class="sidebar-top-icon"><i class="fa fa-angle-up"></i></span></div></div><div class="sidebar-menu-box" id="sidebar-menu-box"><div class="sidebar-menu-box-container"><div id="sidebar-menu-box-categories"><a class="category-link" href="/categories/%E5%85%B4%E8%B6%A3%E7%88%B1%E5%A5%BD/">兴趣爱好</a><a class="category-link" href="/categories/%E5%85%B6%E4%BB%96%E5%BC%80%E5%8F%91/">其他开发</a><a class="category-link" href="/categories/%E5%89%8D%E6%B2%BF%E5%BC%80%E5%8F%91/">前沿开发</a><a class="category-link" href="/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">前端开发</a><a class="category-link" href="/categories/%E5%8D%87%E7%BA%A7%E7%89%88%E6%9C%AC/">升级版本</a><a class="category-link" href="/categories/%E5%8D%9A%E5%AE%A2%E6%95%99%E7%A8%8B/">博客教程</a><a class="category-link" href="/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/">后端开发</a><a class="category-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a><a class="category-link" href="/categories/%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/">日常记录</a><a class="category-link" href="/categories/%E7%83%AD%E9%97%A8%E6%96%87%E7%AB%A0/">热门文章</a></div><div id="sidebar-menu-box-tags"><a href="/tags/Ajax/" style="font-size:10px">Ajax</a> <a href="/tags/AliGenie/" style="font-size:10px">AliGenie</a> <a href="/tags/Alipay/" style="font-size:10px">Alipay</a> <a href="/tags/Android/" style="font-size:10px">Android</a> <a href="/tags/Blockchain/" style="font-size:17.5px">Blockchain</a> <a href="/tags/CQRS/" style="font-size:10px">CQRS</a> <a href="/tags/Database/" style="font-size:15px">Database</a> <a href="/tags/Docker/" style="font-size:10px">Docker</a> <a href="/tags/EasyUI/" style="font-size:10px">EasyUI</a> <a href="/tags/Guitar/" style="font-size:10px">Guitar</a> <a href="/tags/Hackintosh/" style="font-size:12.5px">Hackintosh</a> <a href="/tags/Hexo/" style="font-size:15px">Hexo</a> <a href="/tags/IntelliJ-IDEA/" style="font-size:10px">IntelliJ IDEA</a> <a href="/tags/Java/" style="font-size:12.5px">Java</a> <a href="/tags/Kali-Linux/" style="font-size:10px">Kali Linux</a> <a href="/tags/Life/" style="font-size:17.5px">Life</a> <a href="/tags/Mac-OS/" style="font-size:12.5px">Mac OS</a> <a href="/tags/MultiThread/" style="font-size:10px">MultiThread</a> <a href="/tags/NodeJS/" style="font-size:10px">NodeJS</a> <a href="/tags/Popular/" style="font-size:20px">Popular</a> <a href="/tags/Python/" style="font-size:10px">Python</a> <a href="/tags/SaaS/" style="font-size:10px">SaaS</a> <a href="/tags/Servlet/" style="font-size:10px">Servlet</a> <a href="/tags/Spring/" style="font-size:17.5px">Spring</a> <a href="/tags/Upgrade/" style="font-size:10px">Upgrade</a> <a href="/tags/Web/" style="font-size:10px">Web</a> <a href="/tags/Windows/" style="font-size:10px">Windows</a> <a href="/tags/Work/" style="font-size:10px">Work</a> <a href="/tags/iOS/" style="font-size:10px">iOS</a></div></div><a href="javascript:" class="sidebar-menu-box-close">&times;</a></div><div class="mobile-header-menu-nav" id="mobile-header-menu-nav"><div class="mobile-header-menu-container"><span class="title">导航</span><ul class="mobile-header-menu-navbar"><li><a href="/"><i class="fa fa-home"></i><span>主页</span></a></li><li><a href="/archives"><i class="fa fa-archive"></i><span>归档</span></a></li><li><a href="/gitbook"><i class="fa fa-columns"></i><span>笔记</span></a></li><li><a href="/music"><i class="fa fa-music"></i><span>音乐</span></a></li><li><a href="/photo"><i class="fa fa-picture-o"></i><span>相册</span></a></li><li><a href="/love"><i class="fa fa-heart"></i><span>恋爱</span></a></li><li><a href="/collection"><i class="fa fa-envira"></i><span>收藏</span></a></li><li><a href="/about"><i class="fa fa-user"></i><span>关于</span></a></li></ul></div><div class="mobile-header-tag-container"><span class="title">标签</span><div id="mobile-header-container-tags"><a href="/tags/Ajax/" style="font-size:10px">Ajax</a> <a href="/tags/AliGenie/" style="font-size:10px">AliGenie</a> <a href="/tags/Alipay/" style="font-size:10px">Alipay</a> <a href="/tags/Android/" style="font-size:10px">Android</a> <a href="/tags/Blockchain/" style="font-size:17.5px">Blockchain</a> <a href="/tags/CQRS/" style="font-size:10px">CQRS</a> <a href="/tags/Database/" style="font-size:15px">Database</a> <a href="/tags/Docker/" style="font-size:10px">Docker</a> <a href="/tags/EasyUI/" style="font-size:10px">EasyUI</a> <a href="/tags/Guitar/" style="font-size:10px">Guitar</a> <a href="/tags/Hackintosh/" style="font-size:12.5px">Hackintosh</a> <a href="/tags/Hexo/" style="font-size:15px">Hexo</a> <a href="/tags/IntelliJ-IDEA/" style="font-size:10px">IntelliJ IDEA</a> <a href="/tags/Java/" style="font-size:12.5px">Java</a> <a href="/tags/Kali-Linux/" style="font-size:10px">Kali Linux</a> <a href="/tags/Life/" style="font-size:17.5px">Life</a> <a href="/tags/Mac-OS/" style="font-size:12.5px">Mac OS</a> <a href="/tags/MultiThread/" style="font-size:10px">MultiThread</a> <a href="/tags/NodeJS/" style="font-size:10px">NodeJS</a> <a href="/tags/Popular/" style="font-size:20px">Popular</a> <a href="/tags/Python/" style="font-size:10px">Python</a> <a href="/tags/SaaS/" style="font-size:10px">SaaS</a> <a href="/tags/Servlet/" style="font-size:10px">Servlet</a> <a href="/tags/Spring/" style="font-size:17.5px">Spring</a> <a href="/tags/Upgrade/" style="font-size:10px">Upgrade</a> <a href="/tags/Web/" style="font-size:10px">Web</a> <a href="/tags/Windows/" style="font-size:10px">Windows</a> <a href="/tags/Work/" style="font-size:10px">Work</a> <a href="/tags/iOS/" style="font-size:10px">iOS</a></div></div></div><div class="search-wrap"><span class="search-close">&times;</span> <a href="javascript:" class="header-icon waves-effect waves-circle waves-light" id="back"><i class="icon icon-lg icon-chevron-left"></i> </a><input class="search-field" placeholder="Search..." id="keywords"> <a id="search-submit" href="javascript:"><i class="fa fa-search"></i></a><div class="search-container" id="search-container"><ul class="search-result" id="search-result"></ul></div></div><div id="search-tpl"><li class="search-result-item"><a href="{url}" class="search-item-li"><span class="search-item-li-title" title="{title}">{title}</span></a></li></div><script src="/js/search.js"></script><script src="/js/main.js"></script><script src="//cdn.bootcss.com/particles.js/2.0.0/particles.min.js"></script><div id="particles"></div><script src="/js/particles.js"></script><link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css"><script src="//cdn.bootcss.com/scrollReveal.js/3.0.5/scrollreveal.js"></script><script src="/js/animate.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/hijiki.model.json"},display:{position:"right",width:150,height:300},mobile:{show:!0,scale:.5},log:!1})</script></body></html>