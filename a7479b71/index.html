<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="Access-Control-Allow-Origin" content="*"><script type="text/javascript">var start_time=(new Date).getTime()</script><meta http-equiv="Cache-Control" content="no-cache"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="google-site-verification" content="9Wt3lmnrT2bfjaHla5s16adhvcQcBHO7PtNf97n5Od0"><meta name="baidu-site-verification" content="RYlYHsgO7Y"><meta name="sogou_site_verification" content="MSmrTj7lHV"><meta name="shenma-site-verification" content="e4428ccce0f22fad61c3716193bf4bd7_1571416388"><meta name="baidu_union_verify" content="584bb6b4bd24108df082b6d20c7aa9be"><title>推荐系列--项目实战- Webpack to Vite， 为开发提速！ | 狂欢马克思</title><meta name="keywords" content="分享技术经验与交流"><meta name="description" content="&amp;emsp;&amp;emsp;背景 最近，就 前端开发过程中的痛点及可优化项 做了一次收集。 其中，构建耗时、项目编译速度慢 的字眼出现了好几次。 随着业务的快速发展，我们很多项目的体积也快速膨胀。 随之而来的， …"><meta property="og:type" content="article"><meta property="og:title" content="推荐系列--项目实战- Webpack to Vite， 为开发提速！"><meta property="og:url" content="https://www.hosiang.cn/a7479b71/index.html"><meta property="og:site_name" content="狂欢马克思"><meta property="og:description" content="&amp;emsp;&amp;emsp;背景 最近，就 前端开发过程中的痛点及可优化项 做了一次收集。 其中，构建耗时、项目编译速度慢 的字眼出现了好几次。 随着业务的快速发展，我们很多项目的体积也快速膨胀。 随之而来的， …"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png"><meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png"><meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png"><meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png"><meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png"><meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png"><meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png"><meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png"><meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png"><meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png"><meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png"><meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png"><meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png"><meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png"><meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png"><meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png"><meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png"><meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png"><meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png"><meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png"><meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png"><meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png"><meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png"><meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png"><meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png"><meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png"><meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png"><meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png"><meta property="article:published_time" content="2021-04-15T01:46:45.000Z"><meta property="article:modified_time" content="2022-05-20T01:38:38.311Z"><meta property="article:author" content="Howe Hsiang"><meta property="article:tag" content="Popular"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png"><link rel="icon" href="/images/favicon.ico"><link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"><link href="https://cdn.bootcss.com/font-awesome-animation/0.1.0/font-awesome-animation.min.css" rel="stylesheet"><link rel="stylesheet" href="/css/style.css"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?3cd8fa109426bf3f10bd5c362175bace";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script></script><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><meta name="generator" content="Hexo 6.2.0"></head><script src="/js/jquery.min.js"></script><script src="/js/pace.min.js"></script><script src="/js/crypto-js.js"></script><script src="/js/cookie.js"></script><script src="/js/calendar.js"></script><script src="/js/festival.js"></script><script>getFestival()</script><body><script>window.onload=function(){document.getElementById("TimeShow").innerHTML="本站耗时 "+((new Date).getTime()-start_time)/1e3+" 秒 "}</script><div id="container"><header id="header"><div id="banner"></div><div id="header-outer"><div id="header-menu" class="header-menu-pos animated"><div class="header-menu-container"><a href="/" class="left"><span class="site-title">狂欢马克思</span></a><nav id="header-menu-nav" class="right"><a href="/" rel="external nofollow"><i class="fa fa-home"></i> <span>主页</span> </a><a href="/archives" rel="external nofollow"><i class="fa fa-archive"></i> <span>归档</span> </a><a href="/gitbook" rel="external nofollow"><i class="fa fa-columns"></i> <span>笔记</span> </a><a href="/music" rel="external nofollow"><i class="fa fa-music"></i> <span>音乐</span> </a><a href="/photo" rel="external nofollow"><i class="fa fa-picture-o"></i> <span>相册</span> </a><a href="/love" rel="external nofollow"><i class="fa fa-heart"></i> <span>恋爱</span> </a><a href="/collection" rel="external nofollow"><i class="fa fa-envira"></i> <span>收藏</span> </a><a href="/about" rel="external nofollow"><i class="fa fa-user"></i> <span>关于</span></a></nav><a class="mobile-header-menu-button"><i class="fa fa-bars"></i></a></div></div><div id="header-row"><div id="logo"><a href="/"><img src="/../images/logo.png" alt="logo"></a></div><div class="header-info"><div id="header-title"><h2>狂欢马克思</h2></div><div id="header-description"><h3>专注Web开发</h3></div></div><nav class="header-nav"><div class="social"><a title="Github" target="_blank" href="//github.com/Hosiang1026" rel="external nofollow"><i class="fa fa-github fa-2x"></i></a> <a title="QQ" target="_blank" href="//wpa.qq.com/msgrd?v=3&uin=641904695&site=qq&menu=yes" rel="external nofollow"><i class="fa fa-qq fa-2x"></i></a> <a title="Weibo" target="_blank" href="//www.weibo.com/haoxiang969" rel="external nofollow"><i class="fa fa-weibo fa-2x"></i></a></div></nav></div><script type="text/javascript" src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script><div id="noticeId" class="show" style="background:rgb(244,247,247,.3)"><marquee id="noticeMar" behavior="scoll" class="notice" direction="left" onmouseover="this.stop()" onmouseout="this.start()"></marquee></div><script type="text/javascript">function browserRedirect(){var i=navigator.userAgent.toLowerCase(),n="ipad"==i.match(/ipad/i),e="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),a="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),s="ucweb"==i.match(/ucweb/i),t="android"==i.match(/android/i),r="windows ce"==i.match(/windows ce/i),c="windows mobile"==i.match(/windows mobile/i),d="",m=randomColor(),d=n||e||o||a||s||t||r||c?($("#noticeId").css({"line-height":"1.6em"}),"<font style='color:"+m+"' face='新华宋体'  size='2'>官宣：<span id='msg'></span><span id='timer'></span><span id='jinrishici-sentence'></span></font> "):($("#noticeId").css({"line-height":"3.6em","margin-top":"20px"}),"<font style='color:"+m+"' face='新华宋体'  size='6'>官宣：<span id='weekend'></span><span id='msg'></span><span id='timer'></span><span id='jinrishici-sentence'></span></font> ");$("#noticeMar").html(d)}function randomColor(){for(var i="0,1,2,3,4,5,6,7,8,9,a,b,c,d,e,f".split(","),n="#",e=0;e<6;e++)n+=i[Math.floor(16*Math.random())];return n}$(function(){browserRedirect()})</script></div></header><script>console.log=function(){}</script><div class="outer"><section id="main" class="body-wrap"><article id="post--项目实战- Webpack to Vite， 为开发提速！" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="post-title" itemprop="name">推荐系列--项目实战- Webpack to Vite， 为开发提速！</h1><div class="post-title-bar"><ul><li><i class="fa fa-book"></i> <a href="/categories/热门文章/">热门文章</a></li><li><i class="fa fa-calendar"></i> 2021-04-15</li><li><i class="fa fa-eye"></i> <span id="busuanzi_value_page_pv"></span></li><li><span class="post-count">字数统计: 2.5k字</span></li><li><span class="post-count">阅读时长: 10分钟</span></li></ul></div></header><div class="article-entry post-content" itemprop="articleBody"><p>&amp;emsp;&amp;emsp;背景 最近，就 前端开发过程中的痛点及可优化项 做了一次收集。 其中，构建耗时、项目编译速度慢 的字眼出现了好几次。 随着业务的快速发展，我们很多项目的体积也快速膨胀。 随之而来的， …</p><span id="more"></span><pre><code>                                                                                                                                                                                    ![Test](https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png  &#39;-项目实战- Webpack to Vite， 为开发提速！&#39;) 
</code></pre><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>最近，就<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">前端开发过程中的痛点及可优化项</span><br></pre></td></tr></table></figure><br>做了一次收集。 其中，<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">构建耗时、项目编译速度慢</span><br></pre></td></tr></table></figure><br>的字眼出现了好几次。<br>随着业务的快速发展，我们很多项目的体积也快速膨胀。 随之而来的， 就是打包变慢等问题。<p></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">提升研发效率</span><br></pre></td></tr></table></figure><p>，是技术人永恒的追求。<br>我们项目也有启动慢的问题，同事也提到过几次。 刚好我之前也做过类似的探索和优化， 于是就借这个机会，改造一下项目，<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">解决启动耗时的问题</span><br></pre></td></tr></table></figure><br>。<br>于昨天下午(2021.4.7 23:00)， 成功嵌入 Vite, 项目启动时间由约<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">190s =&gt; 20s</span><br></pre></td></tr></table></figure><br>, 热更新时间缩短为<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2s</span><br></pre></td></tr></table></figure><br>。<br>中间踩了一些坑， 好在最后爬出来了， 相关技术要点都会在下文中呈现。<p></p><p>今天的主要内容：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">为什么 Vite 启动这么快</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">我的项目如何植入 Vite</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">我在改造过程中遇到的问题</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">关于 Vite 开发、打包上线的一些思考</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">相关代码和结论</span><br></pre></td></tr></table></figure><h3 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h3><h4 id="为什么-Vite-启动这么快"><a href="#为什么-Vite-启动这么快" class="headerlink" title="为什么 Vite 启动这么快"></a>为什么 Vite 启动这么快</h4><p>底层实现上， Vite 是基于 esbuild 预构建依赖的。<br>esbuild 使用 go 编写，并且比以 js 编写的打包器预构建依赖, 快 10 - 100 倍。<br>因为 js 跟 go 相比实在是太慢了，js 的一般操作都是毫秒计，go 则是纳秒。<br>另外， 两者的<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">启动方式</span><br></pre></td></tr></table></figure><br>也有所差异。<p></p><h5 id="webpack-启动方式"><a href="#webpack-启动方式" class="headerlink" title="webpack 启动方式"></a>webpack 启动方式</h5><p><img src="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png" alt="Test" title="-项目实战- Webpack to Vite， 为开发提速！"></p><h5 id="Vite-启动方式"><a href="#Vite-启动方式" class="headerlink" title="Vite 启动方式"></a>Vite 启动方式</h5><p><img src="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png" alt="Test" title="-项目实战- Webpack to Vite， 为开发提速！"><br>Webpack 会<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">先打包</span><br></pre></td></tr></table></figure><br>，然后启动开发服务器，请求服务器时直接给予打包结果。<br>而 Vite 是<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">直接启动</span><br></pre></td></tr></table></figure><br>开发服务器，请求哪个模块再对该模块进行<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">实时编译</span><br></pre></td></tr></table></figure><br>。<br>由于现代浏览器本身就支持 ES Module，会自动向依赖的 Module 发出请求。<br>Vite 充分利用了这一点，将开发环境下的模块文件，就作为浏览器要执行的文件，而不是像 W ebpack 那样进行<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">打包合并</span><br></pre></td></tr></table></figure><br>。<br>由于 Vite 在启动的时候<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">不需要打包</span><br></pre></td></tr></table></figure><br>，也就意味着<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">不需要分析模块的依赖</span><br></pre></td></tr></table></figure><br>、<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">不需要编译</span><br></pre></td></tr></table></figure><br>。因此启动速度非常快。当浏览器请求某个模块时，再根据需要对模块内容进行编译。<br>这种按需动态编译的方式，极大的缩减了编译时间，项目越复杂、模块越多，vite 的优势越明显。<br>在 HMR（热更新）方面，当改动了一个模块后，仅需让浏览器重新请求该模块即可，不像webpack那样需要把该模块的相关依赖模块全部编译一次，效率更高。<br>从实际的开发体验来看， 在 Vite 模式下， 开发环境可以瞬间启动， 但是等到页面出来， 要等一段时间。<p></p><h4 id="我的项目如何植入-Vite"><a href="#我的项目如何植入-Vite" class="headerlink" title="我的项目如何植入 Vite"></a>我的项目如何植入 Vite</h4><h5 id="新项目"><a href="#新项目" class="headerlink" title="新项目"></a>新项目</h5><p>创建一个 Vite 新项目就比较简单：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn create <span class="meta">@vitejs</span>/app</span><br></pre></td></tr></table></figure><p><img src="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png" alt="Test" title="-项目实战- Webpack to Vite， 为开发提速！"><br><img src="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png" alt="Test" title="-项目实战- Webpack to Vite， 为开发提速！"><br>生成好之后， 直接启动就可以了：<br><img src="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png" alt="Test" title="-项目实战- Webpack to Vite， 为开发提速！"></p><h5 id="已有项目"><a href="#已有项目" class="headerlink" title="已有项目"></a>已有项目</h5><p>已有项目的迁移， 稍微繁琐一些。<br>首先， 加入 Vite 的相关配置。 这里我使用了一个 cli 工具：<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wp2vite</span><br></pre></td></tr></table></figure><br>.<br>安装好之后， 直接执行：<br><img src="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png" alt="Test" title="-项目实战- Webpack to Vite， 为开发提速！"><br>这一步， 会自动生成 Vite 的配置文件，并引入相关的依赖。<br>把依赖安装一下， 启动就可以了。<br>如果没有意外的话， 你会<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">收获一堆报错</span><br></pre></td></tr></table></figure><br>。<br>恭喜你，进入开心愉快的踩坑环节。<p></p><h4 id="我在改造过程中遇到的问题"><a href="#我在改造过程中遇到的问题" class="headerlink" title="我在改造过程中遇到的问题"></a>我在改造过程中遇到的问题</h4><h5 id="1-alias-错误"><a href="#1-alias-错误" class="headerlink" title="1. alias 错误"></a>1. alias 错误</h5><p><img src="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png" alt="Test" title="-项目实战- Webpack to Vite， 为开发提速！"><br>项目代码里配置了一些别名，vite 无法识别，所以需要在vite 里面也配置 alias：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  resolve: &#123;</span><br><span class="line">  alias: &#123;</span><br><span class="line">    <span class="string">&#x27;@&#x27;</span>: resolve(__dirname, <span class="string">&#x27;src&#x27;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h5 id="2-无法识别-less-全局变量"><a href="#2-无法识别-less-全局变量" class="headerlink" title="2. 无法识别 less 全局变量"></a>2. 无法识别 less 全局变量</h5><p><img src="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png" alt="Test" title="-项目实战- Webpack to Vite， 为开发提速！"><br>解决办法：<br>把自定义的全局变量从外部注入即可， 直接在<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vite.config.js</span><br></pre></td></tr></table></figure><br>的 css 选项中加入：<p></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">  css: &#123;</span><br><span class="line">  preprocessorOptions: &#123;</span><br><span class="line">    less: &#123;</span><br><span class="line">      modifyVars: &#123;</span><br><span class="line">        hack: `<span class="literal">true</span>;<span class="meta">@import</span> <span class="string">&#x27;$&#123;resolve(&#x27;</span>./src/vars.less<span class="string">&#x27;)&#125;&#x27;</span>;`,</span><br><span class="line">        ...themeVariables,</span><br><span class="line">      &#125;,</span><br><span class="line">      javascriptEnabled: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h5 id="3-Uncaught-Error-Target-container-is-not-a-DOM-element"><a href="#3-Uncaught-Error-Target-container-is-not-a-DOM-element" class="headerlink" title="3. Uncaught Error: Target container is not a DOM element."></a>3. Uncaught Error: Target container is not a DOM element.</h5><p><img src="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png" alt="Test" title="-项目实战- Webpack to Vite， 为开发提速！"><br>根元素未找到。<br>原因是： 默认生成的 index.html 中：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">&quot;root&quot;</span>&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>id 是 root, 而逻辑中的是<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#app</span><br></pre></td></tr></table></figure><br>, 这里直接改成<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=app</span><br></pre></td></tr></table></figure><br>即可。<p></p><h5 id="4-typings-文件找不到"><a href="#4-typings-文件找不到" class="headerlink" title="4. typings 文件找不到"></a>4. typings 文件找不到</h5><p><img src="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png" alt="Test" title="-项目实战- Webpack to Vite， 为开发提速！"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typings 文件未找到</span><br></pre></td></tr></table></figure><p>。<br>这个错误， 乍一看， 一头雾水。<br>进去看一下源代码和编译后的代码：<br>源代码：<br><img src="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png" alt="Test" title="-项目实战- Webpack to Vite， 为开发提速！"><br>编译后：<br><img src="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png" alt="Test" title="-项目实战- Webpack to Vite， 为开发提速！"><br><img src="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png" alt="Test" title="-项目实战- Webpack to Vite， 为开发提速！"><br>typings 文件这不是好好的在这吗， ��么就找不到？<br>想了一下： Vite 不知道 typeings 文件是不需要被编译的，需要告诉编译器不编译这个文件。<br>最后在 TS 官方文档里找到了答案：<br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.typescriptlang.or/">https://www.typescriptlang.or</a>…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">import</span> type &#123; SomeThing &#125; from <span class="string">&quot;./some-module.js&quot;</span>;</span><br><span class="line">export type &#123; SomeThing &#125;;</span><br></pre></td></tr></table></figure><p>需要单独引入types, 于是把代码改为：<br><img src="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png" alt="Test" title="-项目实战- Webpack to Vite， 为开发提速！"><br>同时要注意， 如果一个文件有有多个导出， 也要分开引入：<br><img src="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png" alt="Test" title="-项目实战- Webpack to Vite， 为开发提速！"><br>唯一痛苦的是: 全局都需要改一遍， 体力活。<br>至此，typeings 问题完美解决。</p><h5 id="5-无法识别-svg"><a href="#5-无法识别-svg" class="headerlink" title="5. 无法识别 svg"></a>5. 无法识别 svg</h5><p>我们在使用 svg 作为图标组件的时候， 一般是：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">import</span> Icon from <span class="string">&#x27;@ant-design/icons&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> ErrorSvg from <span class="string">&#x27;@/assets/ico_error.svg&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="variable">ErrorIcon</span> <span class="operator">=</span> (props: any) =&gt; &lt;Icon component=&#123;ErrorSvg&#125; /&gt;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&lt;ErrorIcon /&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>浏览器报错：<br><img src="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png" alt="Test" title="-项目实战- Webpack to Vite， 为开发提速！"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error occurred in the &lt;/src/assets/ico_error.svg&gt; component</span><br></pre></td></tr></table></figure><p>很明显的看到， 这里是把<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">文件路径</span><br></pre></td></tr></table></figure><br>作为组件了。<br>现在要做的是：把这个文件路径， 换成可以识别的组件。<br>搜索一番， 找到了个插件：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vite-plugin-react-svg</span><br></pre></td></tr></table></figure><p></p><p>加入配置：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  <span class="type">const</span> <span class="variable">reactSvgPlugin</span> <span class="operator">=</span> require(<span class="string">&#x27;vite-plugin-react-svg&#x27;</span>);</span><br><span class="line"></span><br><span class="line">plugins: [</span><br><span class="line">  reactSvgPlugin(),</span><br><span class="line">],</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">import</span> MyIcon from <span class="string">&#x27;./svgs/my-icon.svg?component&#x27;</span>;</span><br><span class="line"></span><br><span class="line">function <span class="title function_">App</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;MyIcon /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>需要注意的是： 引入的 svg 文件需要加<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?component</span><br></pre></td></tr></table></figure><br>作为后缀。<br>看了一下源码， 这个后缀是用来作为标识符的，<br><img src="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png" alt="Test" title="-项目实战- Webpack to Vite， 为开发提速！"><br>如果后缀匹配上是<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">component</span><br></pre></td></tr></table></figure><br>, 就解析文件， 并缓存， 最后返回结果：<br><img src="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png" alt="Test" title="-项目实战- Webpack to Vite， 为开发提速！"><br>知道原理之后， 就需要把全部的<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.svg</span><br></pre></td></tr></table></figure><br>&#x3D;&gt;<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.svg?component</span><br></pre></td></tr></table></figure><br>。<br>vscode 一键替换就可以， 不过注意别把 node_module 里面的也替换了。<p></p><h5 id="6-global-未定义"><a href="#6-global-未定义" class="headerlink" title="6. global 未定义"></a>6. global 未定义</h5><p><img src="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png" alt="Test" title="-项目实战- Webpack to Vite， 为开发提速！"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">global</span><br></pre></td></tr></table></figure><p>是 Node里面的变��， 会在客户端报错 ？<br>一层层看下去， 原来是引入的第三方包使用了global。<br>看 vite 文档里提到了 Client Types:<br><img src="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png" alt="Test" title="-项目实战- Webpack to Vite， 为开发提速！"><br>追加到<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tsconfig</span><br></pre></td></tr></table></figure><br>里面：<p></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  <span class="string">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">   <span class="string">&quot;types&quot;</span>: [<span class="string">&quot;node&quot;</span>, <span class="string">&quot;jest&quot;</span>, <span class="string">&quot;vite/client&quot;</span>],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后， 并没有什么乱用。。。<br><img src="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png" alt="Test" title="-项目实战- Webpack to Vite， 为开发提速！"><br>没办法， 只得祭出<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">window</span><br></pre></td></tr></table></figure><br>大法。<br>在入口index.tsx 里面加上：<p></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(window as any).global = window;</span><br></pre></td></tr></table></figure><p>刷新， 好了。<br><img src="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png" alt="Test" title="-项目实战- Webpack to Vite， 为开发提速！"></p><h5 id="7-未解决-替代HtmlWebpackPlugin"><a href="#7-未解决-替代HtmlWebpackPlugin" class="headerlink" title="7. [未解决] 替代HtmlWebpackPlugin"></a>7. [未解决] 替代HtmlWebpackPlugin</h5><p>还需要注入一些外部变量， 修改入口html, favicon, title 之类。<br>找到一个插件：<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vite-plugin-singlefile</span><br></pre></td></tr></table></figure><p></p><p>不过并没有什么用。<br>有了解的同学请留言赐教。<br>至此， 整个app 已经能在本地跑起来了， build 也没问题。</p><h5 id="7-线上打包构建时，-内存溢出"><a href="#7-线上打包构建时，-内存溢出" class="headerlink" title="7. 线上打包构建时， 内存溢出"></a>7. 线上打包构建时， 内存溢出</h5><p>本地能跑起来， 打包也没问题， 后面当然是放到线上跑一跑啦。<br>立刻安排！<br><img src="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png" alt="Test" title="-项目实战- Webpack to Vite， 为开发提速！"><br>内存不足， 我就给你加点：<br><img src="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png" alt="Test" title="-项目实战- Webpack to Vite， 为开发提速！"><br><img src="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png" alt="Test" title="-项目实战- Webpack to Vite， 为开发提速！"><br>搞定！<br><img src="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png" alt="Test" title="-项目实战- Webpack to Vite， 为开发提速！"></p><h4 id="关于-Vite-开发、打包上线的一些思考"><a href="#关于-Vite-开发、打包上线的一些思考" class="headerlink" title="关于 Vite 开发、打包上线的一些思考"></a>关于 Vite 开发、打包上线的一些思考</h4><p>从实际使用来看， vite 在一些功能上还是无法完全替代 webpack。<br>毕竟是后起之秀， 相关的生态还需要持续完善。<br>个人认为，目前一种比较稳妥的方式是：</p><p>保留 webpack dev &amp; build 的能力，<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vite 仅作为开发的辅助</span><br></pre></td></tr></table></figure><p></p><p>等相关工具再完善一些， 再考虑完全迁移过来。</p><h4 id="相关代码和结论"><a href="#相关代码和结论" class="headerlink" title="相关代码和结论"></a>相关代码和结论</h4><h5 id="一个完整的-Vite-demo"><a href="#一个完整的-Vite-demo" class="headerlink" title="一个完整的 Vite demo"></a>一个完整的 Vite demo</h5><p>仓库地址： <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/beMySun/re">https://github.com/beMySun/re</a>…<br><img src="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png" alt="Test" title="-项目实战- Webpack to Vite， 为开发提速！"></p><h5 id="业务项目的-vite-config-js-完整配置"><a href="#业务项目的-vite-config-js-完整配置" class="headerlink" title="业务项目的 vite.config.js 完整配置"></a>业务项目的 vite.config.js 完整配置</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">import</span> &#123; defineConfig &#125; from <span class="string">&#x27;vite&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> reactRefresh from <span class="string">&#x27;@vitejs/plugin-react-refresh&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> legacyPlugin from <span class="string">&#x27;@vitejs/plugin-legacy&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; resolve &#125; from <span class="string">&#x27;path&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="variable">fs</span> <span class="operator">=</span> require(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="type">const</span> <span class="variable">lessToJS</span> <span class="operator">=</span> require(<span class="string">&#x27;less-vars-to-js&#x27;</span>);</span><br><span class="line"><span class="type">const</span> <span class="variable">themeVariables</span> <span class="operator">=</span> lessToJS(fs.readFileSync(resolve(__dirname, <span class="string">&#x27;./src/antd-custom.less&#x27;</span>), <span class="string">&#x27;utf8&#x27;</span>));</span><br><span class="line"><span class="type">const</span> <span class="variable">reactSvgPlugin</span> <span class="operator">=</span> require(<span class="string">&#x27;vite-plugin-react-svg&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// https://cn.vitejs.dev/config/</span></span><br><span class="line">export <span class="keyword">default</span> <span class="title function_">defineConfig</span><span class="params">(&#123;</span></span><br><span class="line"><span class="params">  base: <span class="string">&#x27;./&#x27;</span>,</span></span><br><span class="line"><span class="params">  root: <span class="string">&#x27;./&#x27;</span>,</span></span><br><span class="line"><span class="params">  resolve: &#123;</span></span><br><span class="line"><span class="params">    alias: &#123;</span></span><br><span class="line"><span class="params">      <span class="string">&#x27;react-native&#x27;</span>: <span class="string">&#x27;react-native-web&#x27;</span>,</span></span><br><span class="line"><span class="params">      <span class="string">&#x27;@&#x27;</span>: resolve(__dirname, <span class="string">&#x27;src&#x27;</span>)</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  define: &#123;</span><br><span class="line">    <span class="string">&#x27;process.env.REACT_APP_IS_LOCAL&#x27;</span>: <span class="string">&#x27;\&#x27;true\&#x27;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;window.__CID__&#x27;</span>: JSON.stringify(process.env.cid || <span class="string">&#x27;id&#x27;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">  server: &#123;</span><br><span class="line">    port: <span class="number">8080</span>,</span><br><span class="line">    proxy: &#123;</span><br><span class="line">      <span class="string">&#x27;/api&#x27;</span>: &#123;</span><br><span class="line">        target: <span class="string">&#x27;https://stoku.test.shopee.co.id/&#x27;</span>,</span><br><span class="line">        changeOrigin: <span class="literal">true</span>,</span><br><span class="line">        cookieDomainRewrite: &#123;</span><br><span class="line">          <span class="string">&#x27;stoku.test.shopee.co.id&#x27;</span>: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  build: &#123;</span><br><span class="line">    target: <span class="string">&#x27;es2015&#x27;</span>,</span><br><span class="line">    minify: <span class="string">&#x27;terser&#x27;</span>,</span><br><span class="line">    manifest: <span class="literal">false</span>,</span><br><span class="line">    sourcemap: <span class="literal">false</span>,</span><br><span class="line">    outDir: <span class="string">&#x27;build&#x27;</span>,</span><br><span class="line">    rollupOptions: &#123;&#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  esbuild: &#123;&#125;,</span><br><span class="line">  optimizeDeps: &#123;&#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="comment">// viteSingleFile(&#123;</span></span><br><span class="line">    <span class="comment">//   title: &#x27;dynamic title&#x27;, // doesn&#x27;t work</span></span><br><span class="line">    <span class="comment">// &#125;),</span></span><br><span class="line">    reactSvgPlugin(),</span><br><span class="line">    reactRefresh(),</span><br><span class="line">    legacyPlugin(&#123;</span><br><span class="line">      targets: [</span><br><span class="line">        <span class="string">&#x27;Android &gt; 39&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Chrome &gt;= 60&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Safari &gt;= 10.1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;iOS &gt;= 10.3&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Firefox &gt;= 54&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Edge &gt;= 15&#x27;</span>,</span><br><span class="line">      ],</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// vitePluginImp(&#123;</span></span><br><span class="line">    <span class="comment">//   libList: [</span></span><br><span class="line">    <span class="comment">//     &#123;</span></span><br><span class="line">    <span class="comment">//       libName: &#x27;antd&#x27;,</span></span><br><span class="line">    <span class="comment">//       style: (name) =&gt; `antd/es/$&#123;name&#125;/style`,</span></span><br><span class="line">    <span class="comment">//     &#125;,</span></span><br><span class="line">    <span class="comment">//   ],</span></span><br><span class="line">    <span class="comment">// &#125;),</span></span><br><span class="line">  ],</span><br><span class="line">  css: &#123;</span><br><span class="line">    preprocessorOptions: &#123;</span><br><span class="line">      less: &#123;</span><br><span class="line">        modifyVars: &#123;</span><br><span class="line">          hack: `<span class="literal">true</span>;<span class="meta">@import</span> <span class="string">&#x27;$&#123;resolve(&#x27;</span>./src/vars.less<span class="string">&#x27;)&#125;&#x27;</span>;`,</span><br><span class="line">          ...themeVariables,</span><br><span class="line">        &#125;,</span><br><span class="line">        javascriptEnabled: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h3><p>使用 Vite 能大幅缩短项目构建时间，提升开发效率。<br>不过也要结合项目的实际情况，合理取舍。<br>对于我的这个项目而言，把 Vite 作为辅助开发的一种方式，还是挺有用的。<br>期待 Vite 能继续完善，为研发提效。<br>好了， 内容大概就这么多， 希望对大家有所帮助。<br>才疏学浅，如有错误， 欢迎指正。<br>谢谢。<br>最后，如果觉得内容有帮助， 可以关注下我的公众号，掌握最新动态，一起学习！<br><img src="https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png" alt="Test" title="-项目实战- Webpack to Vite， 为开发提速！"><br>本文同步分享在 博客“皮小蛋”（SegmentFault）。如有侵权，请联系 <a href="mailto:&#x73;&#x75;&#x70;&#x70;&#111;&#x72;&#x74;&#x40;&#x6f;&#115;&#x63;&#104;&#x69;&#110;&#97;&#46;&#x63;&#x6e;">&#x73;&#x75;&#x70;&#x70;&#111;&#x72;&#x74;&#x40;&#x6f;&#115;&#x63;&#104;&#x69;&#110;&#97;&#46;&#x63;&#x6e;</a> 删除。本文参与“OSC源创计划”，欢迎正在阅读的你也加入，一起分享。</p><div class="post-copyright"><div class="content"><p>本文标题： 推荐系列--项目实战- Webpack to Vite， 为开发提速！</p><p>本文作者： OSChina</p><p>发布时间： 2021年04月15日 09:46</p><p>最后更新： 2022年05月20日 09:38</p><p>原始链接： <a class="post-url" href="/a7479b71/" title="推荐系列--项目实战- Webpack to Vite， 为开发提速！">https://www.hosiang.cn/a7479b71/</a></p><p>版权声明： 本文著作权归作者所有，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener noreferrer" target="_blank">CC BY-NC-SA 4.0</a>许可协议，转载请注明出处！</p><footer><a href="https://www.hosiang.cn"><img src="/../images/logo.png" alt="Howe Hsiang"> Howe Hsiang</a></footer></div></div><div class="page-reward"><a id="rewardBtn" href="javascript:;">赏</a></div><div id="reward" class="post-modal reward-lay"><a class="close" href="javascript:;" id="reward-close">×</a> <span class="reward-title"><i class="icon icon-quote-left"></i> 喜欢就赞赏一下呗！ <i class="icon icon-quote-right"></i></span><div class="reward-content"><div class="reward-code"><img id="rewardCode" src="/images/threepay_code.jpg" alt="打赏二维码"></div><div class="reward-select"></div></div></div></div><footer class="article-footer"><div class="post-share"><a href="javascript:" id="share-sub" class="post-share-fab"><i class="fa fa-share-alt" style="padding-top:11px!important"></i></a><div class="post-share-list" id="share-list"><ul class="share-icons"><li><a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://www.hosiang.cn/a7479b71/" data-title="Facebook" rel="external nofollow noopener noreferrer"><i class="fa fa-facebook" style="padding-top:9px!important"></i></a></li><li><a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《推荐系列--项目实战- Webpack to Vite， 为开发提速！》 — 狂欢马克思&url=https://www.hosiang.cn/a7479b71/&via=https://www.hosiang.cn" data-title="Twitter" rel="external nofollow noopener noreferrer"><i class="fa fa-twitter" style="padding-top:9px!important"></i></a></li><li><a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://www.hosiang.cn/a7479b71/" data-title="Google+" rel="external nofollow noopener noreferrer"><i class="fa fa-google-plus" style="padding-top:9px!important"></i></a></li><li><a class="qq share-sns" target="_blank" href="https://connect.qq.com/widget/shareqq/index.html?url=https://www.hosiang.cn/a7479b71/&title=《推荐系列--项目实战- Webpack to Vite， 为开发提速！》 — 狂欢马克思&source=&amp;emsp;&amp;emsp;背景 最近，就 前端开发过程中的痛点及可优化项 做了一次收集。 其中，构建耗时、项目编译速度慢 的字眼出现了好几次..." data-title="QQ" rel="external nofollow noopener noreferrer"><i class="fa fa-qq" style="padding-top:9px!important"></i></a></li><li><a class="weixin share-sns" id="wxFab" href="javascript:" data-title="微信"><i class="fa fa-weixin" style="padding-top:9px!important"></i></a></li><li><a class="weibo share-sns" target="_blank" href="https://service.weibo.com/share/share.php?url=https://www.hosiang.cn/a7479b71/&title=《推荐系列--项目实战- Webpack to Vite， 为开发提速！》 — 狂欢马克思&pic=https://oscimg.oschina.net/oscnet/up-de1450f6c8da91102bc534fdfd2fabce.png" data-title="微博" rel="external nofollow noopener noreferrer"><i class="fa fa-weibo" style="padding-top:9px!important"></i></a></li></ul></div></div><div class="post-modal wx-share" id="wxShare"><a class="close" href="javascript:" id="wxShare-close">×</a><p>扫一扫，分享到微信</p><img src="//api.qrserver.com/v1/create-qr-code/?data=https://www.hosiang.cn/a7479b71/" alt="微信分享二维码"></div><div class="mask"></div><ul class="article-footer-menu"><li class="article-footer-tags"><i class="fa fa-tags"></i> <a href="/tags/Popular/" class="color3">Popular</a></li></ul></footer></div></article><aside class="post-toc-pos post-toc-top" id="post-toc"><nav class="post-toc-wrap"><ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E8%83%8C%E6%99%AF"><span class="post-toc-text">背景</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%AD%A3%E6%96%87"><span class="post-toc-text">正文</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88-Vite-%E5%90%AF%E5%8A%A8%E8%BF%99%E4%B9%88%E5%BF%AB"><span class="post-toc-text">为什么 Vite 启动这么快</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#webpack-%E5%90%AF%E5%8A%A8%E6%96%B9%E5%BC%8F"><span class="post-toc-text">webpack 启动方式</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#Vite-%E5%90%AF%E5%8A%A8%E6%96%B9%E5%BC%8F"><span class="post-toc-text">Vite 启动方式</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E6%88%91%E7%9A%84%E9%A1%B9%E7%9B%AE%E5%A6%82%E4%BD%95%E6%A4%8D%E5%85%A5-Vite"><span class="post-toc-text">我的项目如何植入 Vite</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E6%96%B0%E9%A1%B9%E7%9B%AE"><span class="post-toc-text">新项目</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E5%B7%B2%E6%9C%89%E9%A1%B9%E7%9B%AE"><span class="post-toc-text">已有项目</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E6%88%91%E5%9C%A8%E6%94%B9%E9%80%A0%E8%BF%87%E7%A8%8B%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98"><span class="post-toc-text">我在改造过程中遇到的问题</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#1-alias-%E9%94%99%E8%AF%AF"><span class="post-toc-text">1. alias 错误</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#2-%E6%97%A0%E6%B3%95%E8%AF%86%E5%88%AB-less-%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F"><span class="post-toc-text">2. 无法识别 less 全局变量</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#3-Uncaught-Error-Target-container-is-not-a-DOM-element"><span class="post-toc-text">3. Uncaught Error: Target container is not a DOM element.</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#4-typings-%E6%96%87%E4%BB%B6%E6%89%BE%E4%B8%8D%E5%88%B0"><span class="post-toc-text">4. typings 文件找不到</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#5-%E6%97%A0%E6%B3%95%E8%AF%86%E5%88%AB-svg"><span class="post-toc-text">5. 无法识别 svg</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#6-global-%E6%9C%AA%E5%AE%9A%E4%B9%89"><span class="post-toc-text">6. global 未定义</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#7-%E6%9C%AA%E8%A7%A3%E5%86%B3-%E6%9B%BF%E4%BB%A3HtmlWebpackPlugin"><span class="post-toc-text">7. [未解决] 替代HtmlWebpackPlugin</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#7-%E7%BA%BF%E4%B8%8A%E6%89%93%E5%8C%85%E6%9E%84%E5%BB%BA%E6%97%B6%EF%BC%8C-%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA"><span class="post-toc-text">7. 线上打包构建时， 内存溢出</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%85%B3%E4%BA%8E-Vite-%E5%BC%80%E5%8F%91%E3%80%81%E6%89%93%E5%8C%85%E4%B8%8A%E7%BA%BF%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83"><span class="post-toc-text">关于 Vite 开发、打包上线的一些思考</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E7%9B%B8%E5%85%B3%E4%BB%A3%E7%A0%81%E5%92%8C%E7%BB%93%E8%AE%BA"><span class="post-toc-text">相关代码和结论</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E4%B8%80%E4%B8%AA%E5%AE%8C%E6%95%B4%E7%9A%84-Vite-demo"><span class="post-toc-text">一个完整的 Vite demo</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%A1%B9%E7%9B%AE%E7%9A%84-vite-config-js-%E5%AE%8C%E6%95%B4%E9%85%8D%E7%BD%AE"><span class="post-toc-text">业务项目的 vite.config.js 完整配置</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%9C%80%E5%90%8E"><span class="post-toc-text">最后</span></a></li></ol></nav></aside><nav id="article-nav"><a href="/8ae8f512/" id="article-nav-newer" class="article-nav-link-wrap"><span class="article-nav-title"><i class="fa fa-hand-o-left" aria-hidden="true"></i> 推荐系列--腹有诗书气自华-架构师基础必备，掌握这些，驰骋一线大厂不是梦，抓紧收藏！！！ </span></a><a href="/fb47ddd2/" id="article-nav-older" class="article-nav-link-wrap"><span class="article-nav-title">推荐系列-2021年值得关注的六大云计算趋势</span> <i class="fa fa-hand-o-right" aria-hidden="true"></i></a></nav><div id="gitalk"></div><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script>var gitalk=new Gitalk({repo:"bolg-comment",owner:"Hosiang1026",admin:"Hosiang1026",clientID:"37a2dd4473e8970cecc2",clientSecret:"e30efa17d86d9de4f4ab810872dc62a7b2e7e634",pagerDirection:"last",distractionFreeMode:!0,createIssueManually:!1});gitalk.render("gitalk")</script></section></div><footer id="footer"><div class="outer"><div id="footer-info" class="inner"><script id="_wau78w">var _wau=_wau||[];_wau.push(["small","5dnguv4c2n","78w"])</script><script async src="//waust.at/s.js"></script><p><span id="busuanzi_container_site_uv" style="display:none"><span class="post-count">总字数：<span>1777.3k</span> </span>总访客数：<span id="busuanzi_value_site_uv"></span> </span><span id="busuanzi_container_site_pv" style="display:none">总访问量：<span id="busuanzi_value_site_pv"></span></span><br><span id="TimeShow">本站</span><span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span><br>Copyright&copy; 2018 - 2022 狂欢马克思 <a href="https://beian.miit.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">京ICP备17060439号</a></p></div></div><script>var now=new Date;function createtime(){var n=new Date("2017/09/18");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="安全运行 "+dnum+" 天 ",document.getElementById("times").innerHTML=hnum+" 小时 "+mnum+" 分 "+snum+" 秒"}setInterval("createtime()",800)</script></footer><script>var mihoConfig={root:"https://www.hosiang.cn",animate:"true",isHome:"false",share:"true",reward:" 1"}</script><div class="sidebar"><div id="sidebar-search" title="Search"><i class="fa fa-search"></i></div><div id="sidebar-category" title="Categories"><i class="fa fa-book"></i></div><div id="sidebar-tag" title="Tags"><i class="fa fa-tags"></i></div><div id="sidebar-top"><span class="sidebar-top-icon"><i class="fa fa-angle-up"></i></span></div></div><div class="sidebar-menu-box" id="sidebar-menu-box"><div class="sidebar-menu-box-container"><div id="sidebar-menu-box-categories"><a class="category-link" href="/categories/%E5%85%B4%E8%B6%A3%E7%88%B1%E5%A5%BD/">兴趣爱好</a><a class="category-link" href="/categories/%E5%85%B6%E4%BB%96%E5%BC%80%E5%8F%91/">其他开发</a><a class="category-link" href="/categories/%E5%89%8D%E6%B2%BF%E5%BC%80%E5%8F%91/">前沿开发</a><a class="category-link" href="/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">前端开发</a><a class="category-link" href="/categories/%E5%8D%87%E7%BA%A7%E7%89%88%E6%9C%AC/">升级版本</a><a class="category-link" href="/categories/%E5%8D%9A%E5%AE%A2%E6%95%99%E7%A8%8B/">博客教程</a><a class="category-link" href="/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/">后端开发</a><a class="category-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a><a class="category-link" href="/categories/%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/">日常记录</a><a class="category-link" href="/categories/%E7%83%AD%E9%97%A8%E6%96%87%E7%AB%A0/">热门文章</a></div><div id="sidebar-menu-box-tags"><a href="/tags/Ajax/" style="font-size:10px">Ajax</a> <a href="/tags/AliGenie/" style="font-size:10px">AliGenie</a> <a href="/tags/Alipay/" style="font-size:10px">Alipay</a> <a href="/tags/Android/" style="font-size:10px">Android</a> <a href="/tags/Blockchain/" style="font-size:17.5px">Blockchain</a> <a href="/tags/CQRS/" style="font-size:10px">CQRS</a> <a href="/tags/Database/" style="font-size:15px">Database</a> <a href="/tags/Docker/" style="font-size:10px">Docker</a> <a href="/tags/EasyUI/" style="font-size:10px">EasyUI</a> <a href="/tags/Guitar/" style="font-size:10px">Guitar</a> <a href="/tags/Hackintosh/" style="font-size:12.5px">Hackintosh</a> <a href="/tags/Hexo/" style="font-size:15px">Hexo</a> <a href="/tags/IntelliJ-IDEA/" style="font-size:10px">IntelliJ IDEA</a> <a href="/tags/Java/" style="font-size:12.5px">Java</a> <a href="/tags/Kali-Linux/" style="font-size:10px">Kali Linux</a> <a href="/tags/Life/" style="font-size:17.5px">Life</a> <a href="/tags/Mac-OS/" style="font-size:12.5px">Mac OS</a> <a href="/tags/MultiThread/" style="font-size:10px">MultiThread</a> <a href="/tags/NodeJS/" style="font-size:10px">NodeJS</a> <a href="/tags/Popular/" style="font-size:20px">Popular</a> <a href="/tags/Python/" style="font-size:10px">Python</a> <a href="/tags/SaaS/" style="font-size:10px">SaaS</a> <a href="/tags/Servlet/" style="font-size:10px">Servlet</a> <a href="/tags/Spring/" style="font-size:17.5px">Spring</a> <a href="/tags/Upgrade/" style="font-size:10px">Upgrade</a> <a href="/tags/Web/" style="font-size:10px">Web</a> <a href="/tags/Windows/" style="font-size:10px">Windows</a> <a href="/tags/Work/" style="font-size:10px">Work</a> <a href="/tags/iOS/" style="font-size:10px">iOS</a></div></div><a href="javascript:" class="sidebar-menu-box-close">&times;</a></div><div class="mobile-header-menu-nav" id="mobile-header-menu-nav"><div class="mobile-header-menu-container"><span class="title">导航</span><ul class="mobile-header-menu-navbar"><li><a href="/"><i class="fa fa-home"></i><span>主页</span></a></li><li><a href="/archives"><i class="fa fa-archive"></i><span>归档</span></a></li><li><a href="/gitbook"><i class="fa fa-columns"></i><span>笔记</span></a></li><li><a href="/music"><i class="fa fa-music"></i><span>音乐</span></a></li><li><a href="/photo"><i class="fa fa-picture-o"></i><span>相册</span></a></li><li><a href="/love"><i class="fa fa-heart"></i><span>恋爱</span></a></li><li><a href="/collection"><i class="fa fa-envira"></i><span>收藏</span></a></li><li><a href="/about"><i class="fa fa-user"></i><span>关于</span></a></li></ul></div><div class="mobile-header-tag-container"><span class="title">标签</span><div id="mobile-header-container-tags"><a href="/tags/Ajax/" style="font-size:10px">Ajax</a> <a href="/tags/AliGenie/" style="font-size:10px">AliGenie</a> <a href="/tags/Alipay/" style="font-size:10px">Alipay</a> <a href="/tags/Android/" style="font-size:10px">Android</a> <a href="/tags/Blockchain/" style="font-size:17.5px">Blockchain</a> <a href="/tags/CQRS/" style="font-size:10px">CQRS</a> <a href="/tags/Database/" style="font-size:15px">Database</a> <a href="/tags/Docker/" style="font-size:10px">Docker</a> <a href="/tags/EasyUI/" style="font-size:10px">EasyUI</a> <a href="/tags/Guitar/" style="font-size:10px">Guitar</a> <a href="/tags/Hackintosh/" style="font-size:12.5px">Hackintosh</a> <a href="/tags/Hexo/" style="font-size:15px">Hexo</a> <a href="/tags/IntelliJ-IDEA/" style="font-size:10px">IntelliJ IDEA</a> <a href="/tags/Java/" style="font-size:12.5px">Java</a> <a href="/tags/Kali-Linux/" style="font-size:10px">Kali Linux</a> <a href="/tags/Life/" style="font-size:17.5px">Life</a> <a href="/tags/Mac-OS/" style="font-size:12.5px">Mac OS</a> <a href="/tags/MultiThread/" style="font-size:10px">MultiThread</a> <a href="/tags/NodeJS/" style="font-size:10px">NodeJS</a> <a href="/tags/Popular/" style="font-size:20px">Popular</a> <a href="/tags/Python/" style="font-size:10px">Python</a> <a href="/tags/SaaS/" style="font-size:10px">SaaS</a> <a href="/tags/Servlet/" style="font-size:10px">Servlet</a> <a href="/tags/Spring/" style="font-size:17.5px">Spring</a> <a href="/tags/Upgrade/" style="font-size:10px">Upgrade</a> <a href="/tags/Web/" style="font-size:10px">Web</a> <a href="/tags/Windows/" style="font-size:10px">Windows</a> <a href="/tags/Work/" style="font-size:10px">Work</a> <a href="/tags/iOS/" style="font-size:10px">iOS</a></div></div></div><div class="search-wrap"><span class="search-close">&times;</span> <a href="javascript:" class="header-icon waves-effect waves-circle waves-light" id="back"><i class="icon icon-lg icon-chevron-left"></i> </a><input class="search-field" placeholder="Search..." id="keywords"> <a id="search-submit" href="javascript:"><i class="fa fa-search"></i></a><div class="search-container" id="search-container"><ul class="search-result" id="search-result"></ul></div></div><div id="search-tpl"><li class="search-result-item"><a href="{url}" class="search-item-li"><span class="search-item-li-title" title="{title}">{title}</span></a></li></div><script src="/js/search.js"></script><script src="/js/main.js"></script><script src="//cdn.bootcss.com/particles.js/2.0.0/particles.min.js"></script><div id="particles"></div><script src="/js/particles.js"></script><link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css"><script src="//cdn.bootcss.com/scrollReveal.js/3.0.5/scrollreveal.js"></script><script src="/js/animate.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/hijiki.model.json"},display:{position:"right",width:150,height:300},mobile:{show:!0,scale:.5},log:!1})</script></body></html>