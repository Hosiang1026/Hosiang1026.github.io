<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="Access-Control-Allow-Origin" content="*"><script type="text/javascript">var start_time=(new Date).getTime()</script><meta http-equiv="Cache-Control" content="no-cache"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="google-site-verification" content="9Wt3lmnrT2bfjaHla5s16adhvcQcBHO7PtNf97n5Od0"><meta name="baidu-site-verification" content="RYlYHsgO7Y"><meta name="sogou_site_verification" content="MSmrTj7lHV"><meta name="shenma-site-verification" content="e4428ccce0f22fad61c3716193bf4bd7_1571416388"><meta name="baidu_union_verify" content="584bb6b4bd24108df082b6d20c7aa9be"><title>推荐系列-鸿蒙内核源码分析(进程回收篇) - 进程在临终前如何向老祖宗托孤 - 百篇博客分析HarmonyOS源码 - v47.02 | 狂欢马克思</title><meta name="keywords" content="分享技术经验与交流"><meta name="description" content="&amp;emsp;&amp;emsp;百万汉字注解 &gt;&gt; 精读鸿蒙源码,中文注解分析, 深挖地基工程,大脑永久记忆,四大码仓每日同步更新&lt; gitee | github | csdn | coding &gt; 百篇博客分析 &gt;&gt; 故事说内核,问答式导读,生活式比喻,表格…"><meta property="og:type" content="article"><meta property="og:title" content="推荐系列-鸿蒙内核源码分析(进程回收篇) - 进程在临终前如何向老祖宗托孤 - 百篇博客分析HarmonyOS源码 - v47.02"><meta property="og:url" content="https://www.hosiang.cn/a7a3dc7a/index.html"><meta property="og:site_name" content="狂欢马克思"><meta property="og:description" content="&amp;emsp;&amp;emsp;百万汉字注解 &gt;&gt; 精读鸿蒙源码,中文注解分析, 深挖地基工程,大脑永久记忆,四大码仓每日同步更新&lt; gitee | github | csdn | coding &gt; 百篇博客分析 &gt;&gt; 故事说内核,问答式导读,生活式比喻,表格…"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2021-04-15T01:10:30.000Z"><meta property="article:modified_time" content="2022-06-22T09:35:22.799Z"><meta property="article:author" content="Howe Hsiang"><meta property="article:tag" content="Popular"><meta name="twitter:card" content="summary"><link rel="icon" href="/images/favicon.ico"><link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"><link href="https://cdn.bootcss.com/font-awesome-animation/0.1.0/font-awesome-animation.min.css" rel="stylesheet"><link rel="stylesheet" href="/css/style.css"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?3cd8fa109426bf3f10bd5c362175bace";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script></script><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><meta name="generator" content="Hexo 6.2.0"></head><script src="/js/jquery.min.js"></script><script src="/js/pace.min.js"></script><script src="/js/crypto-js.js"></script><script src="/js/cookie.js"></script><script src="/js/calendar.js"></script><script src="/js/festival.js"></script><script>getFestival()</script><body><script>window.onload=function(){document.getElementById("TimeShow").innerHTML="本站耗时 "+((new Date).getTime()-start_time)/1e3+" 秒 "}</script><div id="container"><header id="header"><div id="banner"></div><div id="header-outer"><div id="header-menu" class="header-menu-pos animated"><div class="header-menu-container"><a href="/" class="left"><span class="site-title">狂欢马克思</span></a><nav id="header-menu-nav" class="right"><a href="/" rel="external nofollow"><i class="fa fa-home"></i> <span>主页</span> </a><a href="/archives" rel="external nofollow"><i class="fa fa-archive"></i> <span>归档</span> </a><a href="/gitbook" rel="external nofollow"><i class="fa fa-columns"></i> <span>笔记</span> </a><a href="/music" rel="external nofollow"><i class="fa fa-music"></i> <span>音乐</span> </a><a href="/photo" rel="external nofollow"><i class="fa fa-picture-o"></i> <span>相册</span> </a><a href="/love" rel="external nofollow"><i class="fa fa-heart"></i> <span>恋爱</span> </a><a href="/collection" rel="external nofollow"><i class="fa fa-envira"></i> <span>收藏</span> </a><a href="/about" rel="external nofollow"><i class="fa fa-user"></i> <span>关于</span></a></nav><a class="mobile-header-menu-button"><i class="fa fa-bars"></i></a></div></div><div id="header-row"><div id="logo"><a href="/"><img src="/../images/logo.png" alt="logo"></a></div><div class="header-info"><div id="header-title"><h2>狂欢马克思</h2></div><div id="header-description"><h3>专注Web开发</h3></div></div><nav class="header-nav"><div class="social"><a title="Github" target="_blank" href="//github.com/Hosiang1026" rel="external nofollow"><i class="fa fa-github fa-2x"></i></a> <a title="QQ" target="_blank" href="//wpa.qq.com/msgrd?v=3&uin=641904695&site=qq&menu=yes" rel="external nofollow"><i class="fa fa-qq fa-2x"></i></a> <a title="Weibo" target="_blank" href="//www.weibo.com/haoxiang969" rel="external nofollow"><i class="fa fa-weibo fa-2x"></i></a></div></nav></div><script type="text/javascript" src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script><div id="noticeId" class="show" style="background:rgb(244,247,247,.3)"><marquee id="noticeMar" behavior="scoll" class="notice" direction="left" onmouseover="this.stop()" onmouseout="this.start()"></marquee></div><script type="text/javascript">function browserRedirect(){var i=navigator.userAgent.toLowerCase(),n="ipad"==i.match(/ipad/i),e="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),a="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),s="ucweb"==i.match(/ucweb/i),t="android"==i.match(/android/i),r="windows ce"==i.match(/windows ce/i),c="windows mobile"==i.match(/windows mobile/i),d="",m=randomColor(),d=n||e||o||a||s||t||r||c?($("#noticeId").css({"line-height":"1.6em"}),"<font style='color:"+m+"' face='新华宋体'  size='2'>官宣：<span id='msg'></span><span id='timer'></span><span id='jinrishici-sentence'></span></font> "):($("#noticeId").css({"line-height":"3.6em","margin-top":"20px"}),"<font style='color:"+m+"' face='新华宋体'  size='6'>官宣：<span id='weekend'></span><span id='msg'></span><span id='timer'></span><span id='jinrishici-sentence'></span></font> ");$("#noticeMar").html(d)}function randomColor(){for(var i="0,1,2,3,4,5,6,7,8,9,a,b,c,d,e,f".split(","),n="#",e=0;e<6;e++)n+=i[Math.floor(16*Math.random())];return n}$(function(){browserRedirect()})</script></div></header><script>console.log=function(){}</script><div class="outer"><section id="main" class="body-wrap"><article id="post-鸿蒙内核源码分析(进程回收篇) - 进程在临终前如何向老祖宗托孤 - 百篇博客分析HarmonyOS源码 - v47.02" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="post-title" itemprop="name">推荐系列-鸿蒙内核源码分析(进程回收篇) - 进程在临终前如何向老祖宗托孤 - 百篇博客分析HarmonyOS源码 - v47.02</h1><div class="post-title-bar"><ul><li><i class="fa fa-book"></i> <a href="/categories/热门文章/">热门文章</a></li><li><i class="fa fa-calendar"></i> 2021-04-15</li><li><i class="fa fa-eye"></i> <span id="busuanzi_value_page_pv"></span></li><li><span class="post-count">字数统计: 5.8k字</span></li><li><span class="post-count">阅读时长: 23分钟</span></li></ul></div></header><div class="article-entry post-content" itemprop="articleBody"><p>&amp;emsp;&amp;emsp;百万汉字注解 &gt;&gt; 精读鸿蒙源码,中文注解分析, 深挖地基工程,大脑永久记忆,四大码仓每日同步更新&lt; gitee | github | csdn | coding &gt; 百篇博客分析 &gt;&gt; 故事说内核,问答式导读,生活式比喻,表格…</p><span id="more"></span><pre><code>                                                                                                                                                                                    百万汉字注解 &gt;&gt; 精读鸿蒙源码,中文注解分析, 深挖地基工程,大脑永久记忆,四大码仓每日同步更新&lt; gitee | github | csdn | coding &gt; 
</code></pre><p>百篇博客分析 &gt;&gt; 故事说内核,问答式导读,生活式比喻,表格化说明,图形化展示,主流站点定期更新中&lt; oschina | 51cto | csdn | harmony &gt;</p><h5 id="进程关系链"><a href="#进程关系链" class="headerlink" title="进程关系链"></a>进程关系链</h5><p>进程是家族式管理的,父子关系,兄弟关系,朋友关系,子女关系,甚至陌生人关系(等待你消亡)在一个进程的生命周期中都会记录下来.用什么来记录呢?当然是内核最重要的胶水结构体 <code>java LOS_DL_LIST</code> ,进程控制块(以下简称 &#96;&#96;&#96;java<br>PCB</p><pre><code class=")用了8个双向链表来记录进程家族的基因关系和运行时关系.如下:"> ```java 
typedef struct ProcessCB &#123;
  //...此处省略其他变量
  LOS_DL_LIST          pendList;                     /**&lt; Block list to which the process belongs */ //进程所属的阻塞列表,如果因拿锁失败,就由此节点挂到等锁链表上
  LOS_DL_LIST          childrenList;                 /**&lt; my children process list */	//孩子进程都挂到这里,形成双循环链表
  LOS_DL_LIST          exitChildList;                /**&lt; my exit children process list */	//那些要退出孩子进程挂到这里，白发人送黑发人。
  LOS_DL_LIST          siblingList;                  /**&lt; linkage in my parent&#39;s children list */ //兄弟进程链表, 56个民族是一家,来自同一个父进程.
  LOS_DL_LIST          subordinateGroupList;         /**&lt; linkage in my group list */ //进程是组长时,有哪些组员进程
  LOS_DL_LIST          threadSiblingList;            /**&lt; List of threads under this process *///进程的线程(任务)列表
  LOS_DL_LIST          threadPriQueueList[OS_PRIORITY_QUEUE_NUM]; /**&lt; The process&#39;s thread group schedules thepriority hash table */	//进程的线程组调度优先级哈希表
  LOS_DL_LIST          waitList;     /**&lt; The process holds the waitLits to support wait/waitpid *///进程持有等待链表以支持wait/waitpid
&#125; LosProcessCB;
</code></pre><p>解读</p><pre><code class="java">pendList
```  个人认为它是鸿蒙内核功能最多的一个链表,它远不止字面意思阻塞链表这么简单,只有深入解读源码后才能体会它真的是太会来事了,一般把它理解为阻塞链表就行.上面挂的是处于阻塞状态的进程. 
```java 
childrenList
``` 孩子链表,所有由它fork出来的进程都挂到这个链表上.上面的孩子进程在死亡前会将自己从上面摘出去,转而挂到 ```java 
exitChildList
``` 链表上. 
```java 
exitChildList
``` 退出孩子链表,进入死亡程序的进程要挂到这个链表上,一个进程的死亡是件挺麻烦的事,进程池的数量有限,需要及时回收进程资源,但家族管理关系复杂,要去很多地方消除痕迹.尤其还有其他进程在看你笑话,等你死亡( ```java 
wait
``` / ```java 
waitpid
``` )了通知它们一声. 
```java 
siblingList
``` 兄弟链表,和你同一个父亲的进程都挂到了这个链表上. 
```java 
subordinateGroupList
```  朋友圈链表,里面是因为兴趣爱好(进程组)而挂在一起的进程,它们可以不是一个父亲,不是一个祖父,但一定是同一个老祖宗(用户态和内核态根进程). 
```java 
threadSiblingList
``` 线程链表,上面挂的是进程ID都是这个进程的线程(任务),进程和线程的关系是1:N的关系,一个线程只能属于一个进程.这里要注意任务在其生命周期中是不能改所属进程的. 
```java 
threadPriQueueList
``` 线程的调度队列数组,一共32个,任务和进程一样有32个优先级,调度算法的过程是先找到优先级最高的进程,在从该进程的任务队列里去最高的优先级任务运行. 
```java 
waitList
```  是等待子进程消亡的任务链表,注意上面挂的是任务.任务是通过系统调用  ```java 
  pid_t wait(int *status);
pid_t waitpid(pid_t pid, int *status, int options);

```  将任务挂到 ```java 
waitList
``` 上.鸿蒙waitpid系统调用为 ```java 
SysWait
``` ,稍后会讲. 
 
##### 进程正常死亡过程 
一个进程的自然消亡过程如下 
 ```java 
//一个进程的自然消亡过程,参数是当前运行的任务
STATIC VOID OsProcessNaturalExit(LosTaskCB *runTask, UINT32 status)
&#123;
  LosProcessCB *processCB = OS_PCB_FROM_PID(runTask-&gt;processID);//通过task找到所属PCB
  LosProcessCB *parentCB = NULL;

  LOS_ASSERT(!(processCB-&gt;threadScheduleMap != 0));//断言没有任务需要调度了,当前task是最后一个了
  LOS_ASSERT(processCB-&gt;processStatus &amp; OS_PROCESS_STATUS_RUNNING);//断言必须为正在运行的进程

  OsChildProcessResourcesFree(processCB);//释放孩子进程的资源

#ifdef LOSCFG_KERNEL_CPUP 
  OsCpupClean(processCB-&gt;processID);
#endif

  /* is a child process */
  if (processCB-&gt;parentProcessID != OS_INVALID_VALUE) &#123;//判断是否有父进程
      parentCB = OS_PCB_FROM_PID(processCB-&gt;parentProcessID);//获取父进程实体
      LOS_ListDelete(&amp;processCB-&gt;siblingList);//将自己从兄弟链表中摘除,家人们,永别了!
      if (!OsProcessExitCodeSignalIsSet(processCB)) &#123;//是否设置了退出码?
          OsProcessExitCodeSet(processCB, status);//将进程状态设为退出码
      &#125;
      LOS_ListTailInsert(&amp;parentCB-&gt;exitChildList, &amp;processCB-&gt;siblingList);//挂到父进程的孩子消亡链表,家人中,永别的可不止我一个.
      LOS_ListDelete(&amp;processCB-&gt;subordinateGroupList);//和志同道合的朋友们永别了,注意家里可不一定是朋友的,所有各有链表.
      LOS_ListTailInsert(&amp;processCB-&gt;group-&gt;exitProcessList, &amp;processCB-&gt;subordinateGroupList);//挂到进程组消亡链表,朋友中,永别的可不止我一个.

      OsWaitCheckAndWakeParentProcess(parentCB, processCB);//检查父进程的等待任务并唤醒任务,此处将会切换到其他任务运行.

      OsDealAliveChildProcess(processCB);//老父亲临终向各自的祖宗托孤

      processCB-&gt;processStatus |= OS_PROCESS_STATUS_ZOMBIES;//贴上僵死进程的标签

      (VOID)OsKill(processCB-&gt;parentProcessID, SIGCHLD, OS_KERNEL_KILL_PERMISSION);//以内核权限发送SIGCHLD(子进程退出)信号.
      LOS_ListHeadInsert(&amp;g_processRecyleList, &amp;processCB-&gt;pendList);//将进程通过其阻塞节点挂入全局进程回收链表
      OsRunTaskToDelete(runTask);//删除正在运行的任务
      return;
  &#125;

  LOS_Panic(&quot;pid : %u is the root process exit!\n&quot;, processCB-&gt;processID);
  return;
&#125;
</code></pre><p>解读</p><p>退群,向兄弟姐妹 <code>java siblingList</code> 告别,向朋友圈(进程组)告别 &#96;&#96;&#96;java<br>subordinateGroupList</p><pre><code class="."> 留下你的死亡记录,老父亲记录到 ```java 
exitChildList
``` ,朋友圈记录到 ```java 
exitProcessList
``` 中. 
 告诉后人死亡原因 ```java 
OsProcessExitCodeSet
``` ,因为 ```java 
waitList
``` 上挂的任务在等待你的死亡信息. 
 向老祖宗托孤,用户态和内核态进程都有自己的祖宗进程(1和2号进程),老祖宗身子硬朗,最后死.所有的短命鬼进程都可以把自己的孩子委托给老祖宗照顾,老祖宗会一视同仁. 
 将自己变成了 ```java 
OS_PROCESS_STATUS_ZOMBIES
``` 僵尸进程. 
 老父亲跑到村口广播这个孩子已经死亡的信号 ```java 
OsKill
``` . 
 将自己挂入进程回收链表,等待回收任务 ```java 
ResourcesTask
``` 回收资源. 
 最后删除这个正在运行的任务,很明显其中一定会发生一次调度 ```java 
OsSchedResched
``` .  ```java 
  //删除一个正在运行的任务
LITE_OS_SEC_TEXT VOID OsRunTaskToDelete(LosTaskCB *taskCB)
&#123;
    LosProcessCB *processCB = OS_PCB_FROM_PID(taskCB-&gt;processID);//拿到task所属进程
    OsTaskReleaseHoldLock(processCB, taskCB);//task还锁
    OsTaskStatusUnusedSet(taskCB);//task重置为未使用状态，等待回收

    LOS_ListDelete(&amp;taskCB-&gt;threadList);//从进程的线程链表中将自己摘除
    processCB-&gt;threadNumber--;//进程的活动task --，注意进程还有一个记录总task的变量 processCB-&gt;threadCount
    LOS_ListTailInsert(&amp;g_taskRecyleList, &amp;taskCB-&gt;pendList);//将task插入回收链表，等待回收资源再利用
    OsEventWriteUnsafe(&amp;g_resourceEvent, OS_RESOURCE_EVENT_FREE, FALSE, NULL);//发送释放资源的事件,事件由 OsResourceRecoveryTask 消费

    OsSchedResched();//申请调度
    return;
&#125;
</code></pre><p>但这是一个自然死亡的进程,还有很多非正常死亡在其他篇幅中已有说明.请自行翻看.非正常死亡的会产生僵尸进程.这种进程需要别的进程通过 &#96;&#96;&#96;java<br>waitpid</p><pre><code class="来回收."> 
##### 孤儿进程 
一般情况下往往是白发人送黑发人,子进程的生命周期是要短于父进程.但因为fork之后,进程之间相互独立,调度算法一视同仁,父子之间是弱的关系力,就什么情况都可能发生了.内核是允许老父亲先走的,如果父进程退出而它的一个或多个子进程还在运行，那么这些子进程就被称为孤儿进程,孤儿进程最终将被两位老祖宗(用户态和内核态)所收养,并由老祖宗完成对它们的状态收集工作。 
 ```java 
//当一个进程自然退出的时候,它的孩子进程由两位老祖宗收养
STATIC VOID OsDealAliveChildProcess(LosProcessCB *processCB)
&#123;
  UINT32 parentID;
  LosProcessCB *childCB = NULL;
  LosProcessCB *parentCB = NULL;
  LOS_DL_LIST *nextList = NULL;
  LOS_DL_LIST *childHead = NULL;

  if (!LOS_ListEmpty(&amp;processCB-&gt;childrenList)) &#123;//如果存在孩子进程
      childHead = processCB-&gt;childrenList.pstNext;//获取孩子链表
      LOS_ListDelete(&amp;(processCB-&gt;childrenList));//清空自己的孩子链表
      if (OsProcessIsUserMode(processCB)) &#123;//是用户态进程
          parentID = g_userInitProcess;//用户态进程老祖宗
      &#125; else &#123;
          parentID = g_kernelInitProcess;//内核态进程老祖宗
      &#125;

      for (nextList = childHead; ;) &#123;//遍历孩子链表
          childCB = OS_PCB_FROM_SIBLIST(nextList);//找到孩子的真身
          childCB-&gt;parentProcessID = parentID;//孩��磕��认老祖宗为爸爸
          nextList = nextList-&gt;pstNext;//找下一个孩子进程
          if (nextList == childHead) &#123;//一圈下来,孩子们都磕完头了
              break;
          &#125;
      &#125;

      parentCB = OS_PCB_FROM_PID(parentID);//找个老祖宗的真身
      LOS_ListTailInsertList(&amp;parentCB-&gt;childrenList, childHead);//挂到老祖宗的孩子链表上
  &#125;

  return;
&#125;
</code></pre><p>解读</p><p>函数很简单,都一一注释了,老父亲临终托付后事,请各自的老祖宗照顾孩子.<br>从这里也可以看出进程的家族管理模式,两个家族从进程的出生到死亡负责到底.</p><h5 id="僵尸进程"><a href="#僵尸进程" class="headerlink" title="僵尸进程"></a>僵尸进程</h5><p>一个进程在终止时会关闭所有文件描述符，释放在用户空间分配的内存，但它的 &#96;&#96;&#96;java<br>PCB</p><pre><code class="还保留着，内核在其中保存了一些信息：如果是正常终止则保存着退出状态，如果是异常终止则保存着导致该进程终止的信号是哪个。这个进程的父进程可以调用wait或waitpid获取这些信息，然后彻底清除掉这个进程。">如果一个进程已经终止，但是它的父进程尚未调用wait或waitpid对它进行清理，这时的进程状态称为僵尸（Zombie）进程,即 Z 进程.任何进程在刚终止时都是僵尸进程，正常情况下，僵尸进程都立刻被父进程清理了. 不正常情况下就需要手动 ```java 
waitpid
``` 清理了. 
##### waitpid 
在鸿蒙系统中，一个进程结束了，但是它的父进程没有等待（调用 ```java 
wait
```   ```java 
waitpid
``` ）它，那么它将变成一个僵尸进程。通过系统调用  ```java 
waitpid
``` 可以彻底的清理掉子进程.归还 ```java 
pcb
``` .最终调用到 ```java 
SysWait
</code></pre><pre><code class="java"> #include &lt;sys/wait.h&gt;
#include &quot;syscall.h&quot;

pid_t waitpid(pid_t pid, int *status, int options)
&#123;
   return syscall_cp(SYS_wait4, pid, status, options, 0);
&#125;
</code></pre><pre><code class="java"> //等待子进程结束
int SysWait(int pid, USER int *status, int options, void *rusage)
&#123;
   (void)rusage;

   return LOS_Wait(pid, status, (unsigned int)options, NULL);
&#125;
//返回已经终止的子进程的进程ID号，并清除僵死进程。
LITE_OS_SEC_TEXT INT32 LOS_Wait(INT32 pid, USER INT32 *status, UINT32 options, VOID *rusage)
&#123;
   (VOID)rusage;
   UINT32 ret;
   UINT32 intSave;
   LosProcessCB *childCB = NULL;
   LosProcessCB *processCB = NULL;
   LosTaskCB *runTask = NULL;

   ret = OsWaitOptionsCheck(options);//参数检查,只支持LOS_WAIT_WNOHANG
   if (ret != LOS_OK) &#123;
       return -ret;
   &#125;

   SCHEDULER_LOCK(intSave);
   processCB = OsCurrProcessGet();	//获取当前进程
   runTask = OsCurrTaskGet();		//获取当前任务

   ret = OsWaitChildProcessCheck(processCB, pid, &amp;childCB);//先检查下看能不能找到参数要求的退出子进程
   if (ret != LOS_OK) &#123;
       pid = -ret;
       goto ERROR;
   &#125;

   if (childCB != NULL) &#123;//找到了进程
       return OsWaitRecycleChildPorcess(childCB, intSave, status);//回收进程
   &#125;
   //没有找到,看是否要返回还是去做个登记
   if ((options &amp; LOS_WAIT_WNOHANG) != 0) &#123;//有LOS_WAIT_WNOHANG标签
       runTask-&gt;waitFlag = 0;//等待标识置0
       pid = 0;//这里置0,是为了 return 0
       goto ERROR;
   &#125;
   //等待孩子进程退出
   OsWaitInsertWaitListInOrder(runTask, processCB);//将当前任务挂入进程waitList链表
   //发起调度的目的是为了让出CPU,让其他进程/任务运行
   OsSchedResched();//发起调度
   
   runTask-&gt;waitFlag = 0;
   if (runTask-&gt;waitID == OS_INVALID_VALUE) &#123;
       pid = -LOS_ECHILD;//没有此子进程
       goto ERROR;
   &#125;

   childCB = OS_PCB_FROM_PID(runTask-&gt;waitID);//获取当前任务的等待子进程ID
   if (!(childCB-&gt;processStatus &amp; OS_PROCESS_STATUS_ZOMBIES)) &#123;//子进程非僵死进程
       pid = -LOS_ESRCH;//没有此进程
       goto ERROR;
   &#125;
   //回收僵死进��
   return OsWaitRecycleChildPorcess(childCB, intSave, status);

ERROR:
   SCHEDULER_UNLOCK(intSave);
   return pid;
&#125;
</code></pre><p>解读</p><pre><code class="java">  pid
  ``` 是数据参数,根据不同的参数代表不同的含义,含义如下: 

 
  
  参数值 
  说明 
  
 
 
  
  pid&lt;-1 
  等待进程组号为pid绝对值的任何子进程。 
  
  
  pid=-1 
  等待任何子进程，此时的waitpid()函数就退化成了普通的wait()函数。 
  
  
  pid=0 
  等待进程组号与目前进程相同的任何子进程，也就是说任何和调用waitpid()函数的进程在同一个进程组的进程。 
  
  
  pid&gt;0 
  等待进程号为pid的子进程。 
  
 
 ```java 
  pid
  ``` 不同值代表的真正含义可以看这个函数 ```java 
  OsWaitSetFlag
  ``` .  ```java 
  //设置等待子进程退出方式方法
 STATIC UINT32 OsWaitSetFlag(const LosProcessCB *processCB, INT32 pid, LosProcessCB **child)
 &#123;
     LosProcessCB *childCB = NULL;
     ProcessGroup *group = NULL;
     LosTaskCB *runTask = OsCurrTaskGet();
     UINT32 ret;

     if (pid &gt; 0) &#123;//等待进程号为pid的子进程结束
         /* Wait for the child process whose process number is pid. */
         childCB = OsFindExitChildProcess(processCB, pid);//看能否从退出的孩子链表中找到PID
         if (childCB != NULL) &#123;//找到了,确实有一个已经退出的PID,注意一个进程退出时会挂到父进程的exitChildList上
             goto WAIT_BACK;//直接成功返回
         &#125;

         ret = OsFindChildProcess(processCB, pid);//看能否从现有的孩子链表中找到PID
         if (ret != LOS_OK) &#123;
             return LOS_ECHILD;//参数进程并没有这个PID孩子,返回孩子进程失败.
         &#125;
         runTask-&gt;waitFlag = OS_PROCESS_WAIT_PRO;//设置当前任务的等待类型
         runTask-&gt;waitID = pid;	//当前任务要等待进程ID结束
     &#125; else if (pid == 0) &#123;//等待同一进程组中的任何子进程
         /* Wait for any child process in the same process group */
         childCB = OsFindGroupExitProcess(processCB-&gt;group, OS_INVALID_VALUE);//看能否从退出的孩子链表中找到PID
         if (childCB != NULL) &#123;//找到了,确实有一个已经退出的PID
             goto WAIT_BACK;//直接成功返回
         &#125;
         runTask-&gt;waitID = processCB-&gt;group-&gt;groupID;//等待进程组的任意一个子进程结束
         runTask-&gt;waitFlag = OS_PROCESS_WAIT_GID;//设置当前任务的等待类型
     &#125; else if (pid == -1) &#123;//等待任意子进程
         /* Wait for any child process */
         childCB = OsFindExitChildProcess(processCB, OS_INVALID_VALUE);//看能否从退出的孩子链表中找到PID
         if (childCB != NULL) &#123;//找到了,确实有一个已经退出的PID
             goto WAIT_BACK;
         &#125;
         runTask-&gt;waitID = pid;//等待PID,这个PID可以和当前进程没有任何关系
         runTask-&gt;waitFlag = OS_PROCESS_WAIT_ANY;//设置当前任务的等待类型
     &#125; else &#123; /* pid &lt; -1 */ //等待指定进程组内为|pid|的所有子进程
         /* Wait for any child process whose group number is the pid absolute value. */
         group = OsFindProcessGroup(-pid);//先通过PID找到进程组
         if (group == NULL) &#123;
             return LOS_ECHILD;
         &#125;

         childCB = OsFindGroupExitProcess(group, OS_INVALID_VALUE);//在进程组里任意一个已经退出的子进程
         if (childCB != NULL) &#123;
             goto WAIT_BACK;
         &#125;

         runTask-&gt;waitID = -pid;//此处用负数是为了和(pid == 0)以示区别,因为二者的waitFlag都一样.
         runTask-&gt;waitFlag = OS_PROCESS_WAIT_GID;//设置当前任务的等待类型
     &#125;

 WAIT_BACK:
     *child = childCB;
     return LOS_OK;
 &#125;
</code></pre><pre><code class="java">  status
  ``` 带走进程退出码, ```java 
  exitCode
  ``` 分成了三个部分格式如下  ```java 
 /*
  * Process exit code
  * 31    15           8           7        0
  * |     | exit code  | core dump | signal |
  */
  #define OS_PRO_EXIT_OK 0 //进程正常退出
  //置进程退出码第七位为1
  STATIC INLINE VOID OsProcessExitCodeCoreDumpSet(LosProcessCB *processCB)
  &#123;
   processCB-&gt;exitCode |= 0x80U;// 0b10000000 
  &#125;
  //设置进程退出信号(0 ~ 7)
  STATIC INLINE VOID OsProcessExitCodeSignalSet(LosProcessCB *processCB, UINT32 signal)
  &#123;
   processCB-&gt;exitCode |= signal &amp; 0x7FU;//0b01111111
  &#125;
  //清除进程退出信号(0 ~ 7)
  STATIC INLINE VOID OsProcessExitCodeSignalClear(LosProcessCB *processCB)
  &#123;
   processCB-&gt;exitCode &amp;= (~0x7FU);//低7位全部清0
  &#125;
  //进程退出码是否被设置过,默认是 0 ,如果 &amp; 0x7FU 还是 0 ,说明没有被设置过.
  STATIC INLINE BOOL OsProcessExitCodeSignalIsSet(LosProcessCB *processCB)
  &#123;
   return (processCB-&gt;exitCode) &amp; 0x7FU;
  &#125;
  //设置进程退出号(8 ~ 15)
  STATIC INLINE VOID OsProcessExitCodeSet(LosProcessCB *processCB, UINT32 code)
  &#123;
   processCB-&gt;exitCode |= ((code &amp; 0x000000FFU) &lt;&lt; 8U) &amp; 0x0000FF00U; /* 8: Move 8 bits to the left, exitCode */
  &#125;

  ```   ```java 
  0 - 7
  ``` 为信号位,信号处理有专门的篇幅,此处不做详细介绍,请自行翻看,这里仅列出部分信号含义.  ```java 
 #define SIGHUP    1	//终端挂起或者控制进程终止
  #define SIGINT    2	//键盘中断（如break键被按下）
  #define SIGQUIT   3	//键盘的退出键被按下
  #define SIGILL    4	//非法指令
  #define SIGTRAP   5	//跟踪陷阱（trace trap），启动进程，跟踪代码的执行
  #define SIGABRT   6	//由abort(3)发出的退出指令
  #define SIGIOT    SIGABRT //abort发出的信号
  #define SIGBUS    7	//总线错误 
  #define SIGFPE    8	//浮点异常
  #define SIGKILL   9		//常用的命令 kill 9 123 | 不能被忽略、处理和阻塞
  #define SIGUSR1   10	//用户自定义信号1 
  #define SIGSEGV   11	//无效的内存引用, 段违例（segmentation     violation），进程试图去访问其虚地址空间以外的位置 
  #define SIGUSR2   12	//用户��定义信号2
  #define SIGPIPE   13	//向某个非读管道中写入数据 
  #define SIGALRM   14	//由alarm(2)发出的信号,默认行为为进程终止
  #define SIGTERM   15	//终止信号
  #define SIGSTKFLT 16	//栈溢出
  #define SIGCHLD   17	//子进程结束信号
  #define SIGCONT   18	//进程继续（曾被停止的进程）
  #define SIGSTOP   19	//终止进程  	 | 不能被忽略、处理和阻塞
  #define SIGTSTP   20	//控制终端（tty）上 按下停止键
  #define SIGTTIN   21	//进程停止，后台进程企图从控制终端读
  #define SIGTTOU   22	//进程停止，后台进程企图从控制终端写
  #define SIGURG    23	//I/O有紧急数据到达当前进程
  #define SIGXCPU   24	//进程的CPU时间片到期
  #define SIGXFSZ   25	//文件大小的超出上限
  #define SIGVTALRM 26	//虚拟时钟超时
  #define SIGPROF   27	//profile时钟超时
  #define SIGWINCH  28	//窗口大小改变
  #define SIGIO     29	//I/O相关
  #define SIGPOLL   29	//
  #define SIGPWR    30	//电源故障,关机
  #define SIGSYS    31	//系统调用中参数错，如系统调用号非法 
  #define SIGUNUSED SIGSYS		//系统调用异常
</code></pre><p>&#96;&#96;&#96;java<br>options</p><p>&#96;&#96;&#96; 是行为参数,提供了一些另外的选项来控制waitpid()函数的行为。</p><pre><code> 参数值 
 鸿蒙支持 
 说明 
 


 
 LOS_WAIT_WNOHANG 
 支持 
 如果没有孩子进程退出，则立即返回,而不是阻塞在这个函数上等待；如果结束了，则返回该子进程的进程号。 
 
 
 LOS_WAIT_WUNTRACED 
 不支持 
 报告终止或停止的子进程的状态 
 
 
 LOS_WAIT_WCONTINUED 
 不支持 
  
 
</code></pre><p>鸿蒙目前只支持了LOS_WAIT_WNOHANG模式,内核源码中虽有 <code>java LOS_WAIT_WUNTRACED</code> 和 &#96;&#96;&#96;java<br>LOS_WAIT_WCONTINUED</p><p>&#96;&#96;&#96; 的实现痕迹,但是整体阅读下来比较乱,应该是没有写好.</p><h5 id="鸿蒙源码百篇博客-往期回顾"><a href="#鸿蒙源码百篇博客-往期回顾" class="headerlink" title="鸿蒙源码百篇博客 往期回顾"></a>鸿蒙源码百篇博客 往期回顾</h5><p>v47.xx (进程回收篇) | 进程在临终前如何向老祖宗托孤 &lt; csdn | 51cto | harmony &gt;<br>v46.xx (特殊进程篇) | 龙生龙,凤生凤,老鼠生儿会打洞 &lt; csdn | 51cto | harmony &gt;<br>v45.xx (fork篇) | fork是如何做到调用一次,返回两次的 ? &lt; csdn | 51cto | harmony &gt;<br>v44.xx (中断管理篇) | 硬中断的实现&lt;&gt;观察者模式 &lt; csdn | 51cto | harmony &gt;<br>v43.xx (中断概念篇) | 外人眼中权势滔天的当红海公公 &lt; csdn | 51cto | harmony &gt;<br>v42.xx (中断切换篇) | 中断切换到底在切换什么? &lt; csdn | 51cto | harmony &gt;<br>v41.xx (任务切换篇) | 汇编逐行注解分析任务上下文 &lt; csdn | 51cto | harmony &gt;<br>v40.xx (汇编汇总篇) | 所有的汇编代码都在这里 &lt; csdn | 51cto | harmony &gt;<br>v39.xx (异常接管篇) | 社会很单纯,复杂的是人 &lt; csdn | 51cto | harmony &gt;<br>v38.xx (寄存器篇) | ARM所有寄存器一网打尽,不再神秘 &lt; csdn | 51cto | harmony &gt;<br>v37.xx (系统调用篇) | 全盘解剖系统调用实现过程 &lt; csdn | 51cto | harmony &gt;<br>v36.xx (工作模式篇) | CPU是韦小宝,有哪七个老婆? &lt; csdn | 51cto | harmony &gt;<br>v35.xx (时间管理篇) | Tick是操作系统的基本时间单位 &lt; csdn | 51cto | harmony &gt;<br>v34.xx (原子操作篇) | 是谁在为原子操作保驾护航? &lt; csdn | 51cto | harmony &gt;<br>v33.xx (消息队列篇) | 进程间如何异步解耦传递大数据 ? &lt; csdn | 51cto | harmony &gt;<br>v32.xx (CPU篇) | 内核是如何描述CPU的? &lt; csdn | 51cto | harmony &gt;<br>v31.xx (定时器篇) | 内核最高优先级任务是谁? &lt; csdn | 51cto | harmony &gt;<br>v30.xx (事件控制篇) | 任务间多对多的同步方案 &lt; csdn | 51cto | harmony &gt;<br>v29.xx (信号量篇) | 信号量解决任务同步问题 &lt; csdn | 51cto | harmony &gt;<br>v28.xx (进程通讯篇) | 进程间通讯有哪九大方式? &lt; csdn | 51cto | harmony &gt;<br>v27.xx (互斥锁篇) | 互斥锁比自旋锁可丰满许多 &lt; csdn | 51cto | harmony &gt;<br>v26.xx (自旋锁篇) | 真的好想为自旋锁立贞节牌坊! &lt; csdn | 51cto | harmony &gt;<br>v25.xx (并发并行篇) | 怎么记住并发并行的区别? &lt; csdn | 51cto | harmony &gt;<br>v24.xx (进程概念篇) | 进程在管理哪些资源? &lt; csdn | 51cto | harmony &gt;<br>v23.xx (汇编传参篇) | 汇编如何传递复杂的参数? &lt; csdn | 51cto | harmony &gt;<br>v22.xx (汇编基础篇) | CPU在哪里打卡上班? &lt; csdn | 51cto | harmony &gt;<br>v21.xx (线程概念篇) | 是谁在不断的折腾CPU? &lt; csdn | 51cto | harmony &gt;<br>v20.xx (用栈方式篇) | 栈是构建底层运行的基础 &lt; csdn | 51cto | harmony &gt;<br>v19.xx (位图管理篇) | 为何进程和线程优先级都是32个? &lt; csdn | 51cto | harmony &gt;<br>v18.xx (源码结构篇) | 内核500问你能答对多少? &lt; csdn | 51cto | harmony &gt;<br>v17.xx (物理内存篇) | 这样记伙伴算法永远不会忘 &lt; csdn | 51cto | harmony &gt;<br>v16.xx (内存规则篇) | 内存管理到底在管什么? &lt; csdn | 51cto | harmony &gt;<br>v15.xx (内存映射篇) | 什么是内存最重要的实现基础 ? &lt; csdn | 51cto | harmony &gt;<br>v14.xx (内存汇编篇) | 什么是虚拟内存的实现基础? &lt; csdn | 51cto | harmony &gt;<br>v13.xx (源码注释篇) | 热爱是所有的理由和答案 &lt; csdn | 51cto | harmony &gt;<br>v12.xx (内存管理篇) | 虚拟内存全景图是怎样的? &lt; csdn | 51cto | harmony &gt;<br>v11.xx (内存分配篇) | 内存有哪些分配方式? &lt; csdn | 51cto | harmony &gt;<br>v10.xx (内存主奴篇) | 紫禁城的主子和奴才如何相处? &lt; csdn | 51cto | harmony &gt;<br>v09.xx (调度故事篇) | 用故事说内核调度 &lt; csdn | 51cto | harmony &gt;<br>v08.xx (总目录) | 百万汉字注解 百篇博客分析 &lt; csdn | 51cto | harmony &gt;<br>v07.xx (调度机制篇) | 任务是如何被调度执行的? &lt; csdn | 51cto | harmony &gt;<br>v06.xx (调度队列篇) | 就绪队列对调度的作用 &lt; csdn | 51cto | harmony &gt;<br>v05.xx (任务管理篇) | 谁在让CPU忙忙碌碌? &lt; csdn | 51cto | harmony &gt;<br>v04.xx (任务调度篇) | 任务是内核调度的单元 &lt; csdn | 51cto | harmony &gt;<br>v03.xx (时钟任务篇) | 触发调度最大的动力来自哪里? &lt; csdn | 51cto | harmony &gt;<br>v02.xx (进程管理篇) | 进程是内核资源管理单元 &lt; csdn | 51cto | harmony &gt;<br>v01.xx (双向链表篇) | 谁是内核最重要结构体? &lt; csdn | 51cto | harmony &gt;</p><h5 id="参与贡献"><a href="#参与贡献" class="headerlink" title="参与贡献"></a>参与贡献</h5><p>![Test](<a target="_blank" rel="external nofollow noopener noreferrer" href="https://gitee.com/weharmony/docs/raw/master/pic/other/kernel_liteos_a_note.png">https://gitee.com/weharmony/docs/raw/master/pic/other/kernel_liteos_a_note.png</a> 鸿蒙内核源码分析(进程回收篇) - 进程在临终前如何向老祖宗托孤 - 百篇博客分析HarmonyOS源码 - v47.02)<br>Fork 本仓库 &gt;&gt; 新建 Feat_xxx 分支 &gt;&gt; 提交代码注解 &gt;&gt; 新建 Pull Request<br>新建 Issue</p><h5 id="喜欢请「点赞-关注-收藏」"><a href="#喜欢请「点赞-关注-收藏」" class="headerlink" title="喜欢请「点赞+关注+收藏」"></a>喜欢请「点赞+关注+收藏」</h5><p>关注「鸿蒙内核源码分析」公众号<br>各大站点搜 「鸿蒙内核源码分析」.欢迎转载,请注明出处.<br>进入 &gt;&gt; oschina | csdn | 51cto | 简书 | 掘金 | harmony</p><div class="post-copyright"><div class="content"><p>本文标题： 推荐系列-鸿蒙内核源码分析(进程回收篇) - 进程在临终前如何向老祖宗托孤 - 百篇博客分析HarmonyOS源码 - v47.02</p><p>本文作者： OSChina</p><p>发布时间： 2021年04月15日 09:10</p><p>最后更新： 2022年06月22日 17:35</p><p>原始链接： <a class="post-url" href="/a7a3dc7a/" title="推荐系列-鸿蒙内核源码分析(进程回收篇) - 进程在临终前如何向老祖宗托孤 - 百篇博客分析HarmonyOS源码 - v47.02">https://www.hosiang.cn/a7a3dc7a/</a></p><p>版权声明： 本文著作权归作者所有，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener noreferrer" target="_blank">CC BY-NC-SA 4.0</a>许可协议，转载请注明出处！</p><footer><a href="https://www.hosiang.cn"><img src="/../images/logo.png" alt="Howe Hsiang"> Howe Hsiang</a></footer></div></div><div class="page-reward"><a id="rewardBtn" href="javascript:;">赏</a></div><div id="reward" class="post-modal reward-lay"><a class="close" href="javascript:;" id="reward-close">×</a> <span class="reward-title"><i class="icon icon-quote-left"></i> 喜欢就赞赏一下呗！ <i class="icon icon-quote-right"></i></span><div class="reward-content"><div class="reward-code"><img id="rewardCode" src="/images/threepay_code.jpg" alt="打赏二维码"></div><div class="reward-select"></div></div></div></div><footer class="article-footer"><div class="post-share"><a href="javascript:" id="share-sub" class="post-share-fab"><i class="fa fa-share-alt" style="padding-top:11px!important"></i></a><div class="post-share-list" id="share-list"><ul class="share-icons"><li><a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://www.hosiang.cn/a7a3dc7a/" data-title="Facebook" rel="external nofollow noopener noreferrer"><i class="fa fa-facebook" style="padding-top:9px!important"></i></a></li><li><a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《推荐系列-鸿蒙内核源码分析(进程回收篇) - 进程在临终前如何向老祖宗托孤 - 百篇博客分析HarmonyOS源码 - v47.02》 — 狂欢马克思&url=https://www.hosiang.cn/a7a3dc7a/&via=https://www.hosiang.cn" data-title="Twitter" rel="external nofollow noopener noreferrer"><i class="fa fa-twitter" style="padding-top:9px!important"></i></a></li><li><a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://www.hosiang.cn/a7a3dc7a/" data-title="Google+" rel="external nofollow noopener noreferrer"><i class="fa fa-google-plus" style="padding-top:9px!important"></i></a></li><li><a class="qq share-sns" target="_blank" href="https://connect.qq.com/widget/shareqq/index.html?url=https://www.hosiang.cn/a7a3dc7a/&title=《推荐系列-鸿蒙内核源码分析(进程回收篇) - 进程在临终前如何向老祖宗托孤 - 百篇博客分析HarmonyOS源码 - v47.02》 — 狂欢马克思&source=&amp;emsp;&amp;emsp;百万汉字注解 &gt;&gt; 精读鸿蒙源码,中文注解分析, 深挖地基工程,大脑永久记忆,四大码仓每日同步更新&l..." data-title="QQ" rel="external nofollow noopener noreferrer"><i class="fa fa-qq" style="padding-top:9px!important"></i></a></li><li><a class="weixin share-sns" id="wxFab" href="javascript:" data-title="微信"><i class="fa fa-weixin" style="padding-top:9px!important"></i></a></li><li><a class="weibo share-sns" target="_blank" href="https://service.weibo.com/share/share.php?url=https://www.hosiang.cn/a7a3dc7a/&title=《推荐系列-鸿蒙内核源码分析(进程回收篇) - 进程在临终前如何向老祖宗托孤 - 百篇博客分析HarmonyOS源码 - v47.02》 — 狂欢马克思&pic=https://gitee.com/weharmony/docs/raw/master/pic/other/kernel_liteos_a_note.png" data-title="微博" rel="external nofollow noopener noreferrer"><i class="fa fa-weibo" style="padding-top:9px!important"></i></a></li></ul></div></div><div class="post-modal wx-share" id="wxShare"><a class="close" href="javascript:" id="wxShare-close">×</a><p>扫一扫，分享到微信</p><img src="//api.qrserver.com/v1/create-qr-code/?data=https://www.hosiang.cn/a7a3dc7a/" alt="微信分享二维码"></div><div class="mask"></div><ul class="article-footer-menu"><li class="article-footer-tags"><i class="fa fa-tags"></i> <a href="/tags/Popular/" class="color3">Popular</a></li></ul></footer></div></article><aside class="post-toc-pos post-toc-top" id="post-toc"><nav class="post-toc-wrap"><ol class="post-toc"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E8%BF%9B%E7%A8%8B%E5%85%B3%E7%B3%BB%E9%93%BE"><span class="post-toc-text">进程关系链</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E5%83%B5%E5%B0%B8%E8%BF%9B%E7%A8%8B"><span class="post-toc-text">僵尸进程</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E9%B8%BF%E8%92%99%E6%BA%90%E7%A0%81%E7%99%BE%E7%AF%87%E5%8D%9A%E5%AE%A2-%E5%BE%80%E6%9C%9F%E5%9B%9E%E9%A1%BE"><span class="post-toc-text">鸿蒙源码百篇博客 往期回顾</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E5%8F%82%E4%B8%8E%E8%B4%A1%E7%8C%AE"><span class="post-toc-text">参与贡献</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E5%96%9C%E6%AC%A2%E8%AF%B7%E3%80%8C%E7%82%B9%E8%B5%9E-%E5%85%B3%E6%B3%A8-%E6%94%B6%E8%97%8F%E3%80%8D"><span class="post-toc-text">喜欢请「点赞+关注+收藏」</span></a></li></ol></nav></aside><nav id="article-nav"><a href="/8fc5b4d7/" id="article-nav-newer" class="article-nav-link-wrap"><span class="article-nav-title"><i class="fa fa-hand-o-left" aria-hidden="true"></i> 推荐系列-原来Java的发家史是这么回事 </span></a><a href="/d289aef6/" id="article-nav-older" class="article-nav-link-wrap"><span class="article-nav-title">推荐系列- 面向 K8s 设计误区</span> <i class="fa fa-hand-o-right" aria-hidden="true"></i></a></nav><div id="gitalk"></div><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script>var gitalk=new Gitalk({repo:"bolg-comment",owner:"Hosiang1026",admin:"Hosiang1026",clientID:"37a2dd4473e8970cecc2",clientSecret:"e30efa17d86d9de4f4ab810872dc62a7b2e7e634",pagerDirection:"last",distractionFreeMode:!0,createIssueManually:!1});gitalk.render("gitalk")</script></section></div><footer id="footer"><div class="outer"><div id="footer-info" class="inner"><script id="_wau78w">var _wau=_wau||[];_wau.push(["small","5dnguv4c2n","78w"])</script><script async src="//waust.at/s.js"></script><p><span id="busuanzi_container_site_uv" style="display:none"><span class="post-count">总字数：<span>1777.3k</span> </span>总访客数：<span id="busuanzi_value_site_uv"></span> </span><span id="busuanzi_container_site_pv" style="display:none">总访问量：<span id="busuanzi_value_site_pv"></span></span><br><span id="TimeShow">本站</span><span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span><br>Copyright&copy; 2018 - 2022 狂欢马克思 <a href="https://beian.miit.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">京ICP备17060439号</a></p></div></div><script>var now=new Date;function createtime(){var n=new Date("2017/09/18");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="安全运行 "+dnum+" 天 ",document.getElementById("times").innerHTML=hnum+" 小时 "+mnum+" 分 "+snum+" 秒"}setInterval("createtime()",800)</script></footer><script>var mihoConfig={root:"https://www.hosiang.cn",animate:"true",isHome:"false",share:"true",reward:" 1"}</script><div class="sidebar"><div id="sidebar-search" title="Search"><i class="fa fa-search"></i></div><div id="sidebar-category" title="Categories"><i class="fa fa-book"></i></div><div id="sidebar-tag" title="Tags"><i class="fa fa-tags"></i></div><div id="sidebar-top"><span class="sidebar-top-icon"><i class="fa fa-angle-up"></i></span></div></div><div class="sidebar-menu-box" id="sidebar-menu-box"><div class="sidebar-menu-box-container"><div id="sidebar-menu-box-categories"><a class="category-link" href="/categories/%E5%85%B4%E8%B6%A3%E7%88%B1%E5%A5%BD/">兴趣爱好</a><a class="category-link" href="/categories/%E5%85%B6%E4%BB%96%E5%BC%80%E5%8F%91/">其他开发</a><a class="category-link" href="/categories/%E5%89%8D%E6%B2%BF%E5%BC%80%E5%8F%91/">前沿开发</a><a class="category-link" href="/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">前端开发</a><a class="category-link" href="/categories/%E5%8D%87%E7%BA%A7%E7%89%88%E6%9C%AC/">升级版本</a><a class="category-link" href="/categories/%E5%8D%9A%E5%AE%A2%E6%95%99%E7%A8%8B/">博客教程</a><a class="category-link" href="/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/">后端开发</a><a class="category-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a><a class="category-link" href="/categories/%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/">日常记录</a><a class="category-link" href="/categories/%E7%83%AD%E9%97%A8%E6%96%87%E7%AB%A0/">热门文章</a></div><div id="sidebar-menu-box-tags"><a href="/tags/Ajax/" style="font-size:10px">Ajax</a> <a href="/tags/AliGenie/" style="font-size:10px">AliGenie</a> <a href="/tags/Alipay/" style="font-size:10px">Alipay</a> <a href="/tags/Android/" style="font-size:10px">Android</a> <a href="/tags/Blockchain/" style="font-size:17.5px">Blockchain</a> <a href="/tags/CQRS/" style="font-size:10px">CQRS</a> <a href="/tags/Database/" style="font-size:15px">Database</a> <a href="/tags/Docker/" style="font-size:10px">Docker</a> <a href="/tags/EasyUI/" style="font-size:10px">EasyUI</a> <a href="/tags/Guitar/" style="font-size:10px">Guitar</a> <a href="/tags/Hackintosh/" style="font-size:12.5px">Hackintosh</a> <a href="/tags/Hexo/" style="font-size:15px">Hexo</a> <a href="/tags/IntelliJ-IDEA/" style="font-size:10px">IntelliJ IDEA</a> <a href="/tags/Java/" style="font-size:12.5px">Java</a> <a href="/tags/Kali-Linux/" style="font-size:10px">Kali Linux</a> <a href="/tags/Life/" style="font-size:17.5px">Life</a> <a href="/tags/Mac-OS/" style="font-size:12.5px">Mac OS</a> <a href="/tags/MultiThread/" style="font-size:10px">MultiThread</a> <a href="/tags/NodeJS/" style="font-size:10px">NodeJS</a> <a href="/tags/Popular/" style="font-size:20px">Popular</a> <a href="/tags/Python/" style="font-size:10px">Python</a> <a href="/tags/SaaS/" style="font-size:10px">SaaS</a> <a href="/tags/Servlet/" style="font-size:10px">Servlet</a> <a href="/tags/Spring/" style="font-size:17.5px">Spring</a> <a href="/tags/Upgrade/" style="font-size:10px">Upgrade</a> <a href="/tags/Web/" style="font-size:10px">Web</a> <a href="/tags/Windows/" style="font-size:10px">Windows</a> <a href="/tags/Work/" style="font-size:10px">Work</a> <a href="/tags/iOS/" style="font-size:10px">iOS</a></div></div><a href="javascript:" class="sidebar-menu-box-close">&times;</a></div><div class="mobile-header-menu-nav" id="mobile-header-menu-nav"><div class="mobile-header-menu-container"><span class="title">导航</span><ul class="mobile-header-menu-navbar"><li><a href="/"><i class="fa fa-home"></i><span>主页</span></a></li><li><a href="/archives"><i class="fa fa-archive"></i><span>归档</span></a></li><li><a href="/gitbook"><i class="fa fa-columns"></i><span>笔记</span></a></li><li><a href="/music"><i class="fa fa-music"></i><span>音乐</span></a></li><li><a href="/photo"><i class="fa fa-picture-o"></i><span>相册</span></a></li><li><a href="/love"><i class="fa fa-heart"></i><span>恋爱</span></a></li><li><a href="/collection"><i class="fa fa-envira"></i><span>收藏</span></a></li><li><a href="/about"><i class="fa fa-user"></i><span>关于</span></a></li></ul></div><div class="mobile-header-tag-container"><span class="title">标签</span><div id="mobile-header-container-tags"><a href="/tags/Ajax/" style="font-size:10px">Ajax</a> <a href="/tags/AliGenie/" style="font-size:10px">AliGenie</a> <a href="/tags/Alipay/" style="font-size:10px">Alipay</a> <a href="/tags/Android/" style="font-size:10px">Android</a> <a href="/tags/Blockchain/" style="font-size:17.5px">Blockchain</a> <a href="/tags/CQRS/" style="font-size:10px">CQRS</a> <a href="/tags/Database/" style="font-size:15px">Database</a> <a href="/tags/Docker/" style="font-size:10px">Docker</a> <a href="/tags/EasyUI/" style="font-size:10px">EasyUI</a> <a href="/tags/Guitar/" style="font-size:10px">Guitar</a> <a href="/tags/Hackintosh/" style="font-size:12.5px">Hackintosh</a> <a href="/tags/Hexo/" style="font-size:15px">Hexo</a> <a href="/tags/IntelliJ-IDEA/" style="font-size:10px">IntelliJ IDEA</a> <a href="/tags/Java/" style="font-size:12.5px">Java</a> <a href="/tags/Kali-Linux/" style="font-size:10px">Kali Linux</a> <a href="/tags/Life/" style="font-size:17.5px">Life</a> <a href="/tags/Mac-OS/" style="font-size:12.5px">Mac OS</a> <a href="/tags/MultiThread/" style="font-size:10px">MultiThread</a> <a href="/tags/NodeJS/" style="font-size:10px">NodeJS</a> <a href="/tags/Popular/" style="font-size:20px">Popular</a> <a href="/tags/Python/" style="font-size:10px">Python</a> <a href="/tags/SaaS/" style="font-size:10px">SaaS</a> <a href="/tags/Servlet/" style="font-size:10px">Servlet</a> <a href="/tags/Spring/" style="font-size:17.5px">Spring</a> <a href="/tags/Upgrade/" style="font-size:10px">Upgrade</a> <a href="/tags/Web/" style="font-size:10px">Web</a> <a href="/tags/Windows/" style="font-size:10px">Windows</a> <a href="/tags/Work/" style="font-size:10px">Work</a> <a href="/tags/iOS/" style="font-size:10px">iOS</a></div></div></div><div class="search-wrap"><span class="search-close">&times;</span> <a href="javascript:" class="header-icon waves-effect waves-circle waves-light" id="back"><i class="icon icon-lg icon-chevron-left"></i> </a><input class="search-field" placeholder="Search..." id="keywords"> <a id="search-submit" href="javascript:"><i class="fa fa-search"></i></a><div class="search-container" id="search-container"><ul class="search-result" id="search-result"></ul></div></div><div id="search-tpl"><li class="search-result-item"><a href="{url}" class="search-item-li"><span class="search-item-li-title" title="{title}">{title}</span></a></li></div><script src="/js/search.js"></script><script src="/js/main.js"></script><script src="//cdn.bootcss.com/particles.js/2.0.0/particles.min.js"></script><div id="particles"></div><script src="/js/particles.js"></script><link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css"><script src="//cdn.bootcss.com/scrollReveal.js/3.0.5/scrollreveal.js"></script><script src="/js/animate.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/hijiki.model.json"},display:{position:"right",width:150,height:300},mobile:{show:!0,scale:.5},log:!1})</script></body></html>