<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="Access-Control-Allow-Origin" content="*"><script type="text/javascript">var start_time=(new Date).getTime()</script><meta http-equiv="Cache-Control" content="no-cache"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="google-site-verification" content="9Wt3lmnrT2bfjaHla5s16adhvcQcBHO7PtNf97n5Od0"><meta name="baidu-site-verification" content="RYlYHsgO7Y"><meta name="sogou_site_verification" content="MSmrTj7lHV"><meta name="shenma-site-verification" content="e4428ccce0f22fad61c3716193bf4bd7_1571416388"><meta name="baidu_union_verify" content="584bb6b4bd24108df082b6d20c7aa9be"><title>推荐系列-前沿科技探究DeepSQL-库内AI算法 | 狂欢马克思</title><meta name="keywords" content="分享技术经验与交流"><meta name="description" content="&amp;emsp;&amp;emsp;库DeepSQL特性实现DB4AI功能，即在数据库内实现AI算法，以更好的支撑大数据的快速分析和计算。这里提供了一整套基于SQL的机器学习、数据挖掘以及统计学的算法，用户可以直接使用SQL进行机…"><meta property="og:type" content="article"><meta property="og:title" content="推荐系列-前沿科技探究DeepSQL-库内AI算法"><meta property="og:url" content="https://www.hosiang.cn/cc7a5449/index.html"><meta property="og:site_name" content="狂欢马克思"><meta property="og:description" content="&amp;emsp;&amp;emsp;库DeepSQL特性实现DB4AI功能，即在数据库内实现AI算法，以更好的支撑大数据的快速分析和计算。这里提供了一整套基于SQL的机器学习、数据挖掘以及统计学的算法，用户可以直接使用SQL进行机…"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2022-02-19T03:56:26.000Z"><meta property="article:modified_time" content="2022-05-11T08:58:24.765Z"><meta property="article:author" content="Howe Hsiang"><meta property="article:tag" content="Popular"><meta name="twitter:card" content="summary"><link rel="icon" href="/images/favicon.ico"><link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"><link href="https://cdn.bootcss.com/font-awesome-animation/0.1.0/font-awesome-animation.min.css" rel="stylesheet"><link rel="stylesheet" href="/css/style.css"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?3cd8fa109426bf3f10bd5c362175bace";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script></script><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><meta name="generator" content="Hexo 6.2.0"></head><script src="/js/jquery.min.js"></script><script src="/js/pace.min.js"></script><script src="/js/crypto-js.js"></script><script src="/js/cookie.js"></script><script src="/js/calendar.js"></script><script src="/js/festival.js"></script><script>getFestival()</script><body><script>window.onload=function(){document.getElementById("TimeShow").innerHTML="本站耗时 "+((new Date).getTime()-start_time)/1e3+" 秒 "}</script><div id="container"><header id="header"><div id="banner"></div><div id="header-outer"><div id="header-menu" class="header-menu-pos animated"><div class="header-menu-container"><a href="/" class="left"><span class="site-title">狂欢马克思</span></a><nav id="header-menu-nav" class="right"><a href="/" rel="external nofollow"><i class="fa fa-home"></i> <span>主页</span> </a><a href="/archives" rel="external nofollow"><i class="fa fa-archive"></i> <span>归档</span> </a><a href="/gitbook" rel="external nofollow"><i class="fa fa-columns"></i> <span>笔记</span> </a><a href="/music" rel="external nofollow"><i class="fa fa-music"></i> <span>音乐</span> </a><a href="/photo" rel="external nofollow"><i class="fa fa-picture-o"></i> <span>相册</span> </a><a href="/collection" rel="external nofollow"><i class="fa fa-envira"></i> <span>收藏</span> </a><a href="/about" rel="external nofollow"><i class="fa fa-user"></i> <span>关于</span></a></nav><a class="mobile-header-menu-button"><i class="fa fa-bars"></i></a></div></div><div id="header-row"><div id="logo"><a href="/"><img src="/../images/logo.png" alt="logo"></a></div><div class="header-info"><div id="header-title"><h2>狂欢马克思</h2></div><div id="header-description"><h3>专注Web开发</h3></div></div><nav class="header-nav"><div class="social"><a title="Github" target="_blank" href="//github.com/Hosiang1026" rel="external nofollow"><i class="fa fa-github fa-2x"></i></a> <a title="QQ" target="_blank" href="//wpa.qq.com/msgrd?v=3&uin=641904695&site=qq&menu=yes" rel="external nofollow"><i class="fa fa-qq fa-2x"></i></a> <a title="Weibo" target="_blank" href="//www.weibo.com/haoxiang969" rel="external nofollow"><i class="fa fa-weibo fa-2x"></i></a></div></nav></div><div id="noticeId" class="show" style="background:rgb(244,247,247,.3)"><marquee id="noticeMar" behavior="scoll" class="notice" direction="left" onmouseover="this.stop()" onmouseout="this.start()"></marquee></div><script type="text/javascript">function browserRedirect(){var i=navigator.userAgent.toLowerCase(),n="ipad"==i.match(/ipad/i),o="iphone os"==i.match(/iphone os/i),a="midp"==i.match(/midp/i),t="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),e="ucweb"==i.match(/ucweb/i),s="android"==i.match(/android/i),d="windows ce"==i.match(/windows ce/i),p="windows mobile"==i.match(/windows mobile/i),r="",c=randomColor(),r=n||o||a||t||e||s||d||p?($("#noticeId").css({"line-height":"1.6em"}),"<font style='color:"+c+"' face='新华宋体'  size='2'>官宣：<span id='weekend'></span><span id='msg'></span><span id='timer'></span><span id='hitokoto'></span></span></span><span id='YQData'></font> "):($("#noticeId").css({"line-height":"3.6em","margin-top":"20px"}),"<font style='color:"+c+"' face='新华宋体'  size='6'>官宣：<span id='weekend'></span><span id='msg'></span><span id='timer'></span><span id='hitokoto'></span></span><span id='YQData'></span></font> ");$("#noticeMar").html(r)}function randomColor(){for(var i="0,1,2,3,4,5,6,7,8,9,a,b,c,d,e,f".split(","),n="#",o=0;o<6;o++)n+=i[Math.floor(16*Math.random())];return n}$(function(){browserRedirect(),0<$("#hitokoto").length&&getHitokoto()})</script></div></header><script>console.log=function(){}</script><div class="outer"><section id="main" class="body-wrap"><article id="post-前沿科技探究DeepSQL-库内AI算法" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="post-title" itemprop="name">推荐系列-前沿科技探究DeepSQL-库内AI算法</h1><div class="post-title-bar"><ul><li><i class="fa fa-book"></i> <a href="/categories/热门文章/">热门文章</a></li><li><i class="fa fa-calendar"></i> 2022-02-19</li><li><i class="fa fa-eye"></i> <span id="busuanzi_value_page_pv"></span></li><li><span class="post-count">字数统计: 16.1k字</span></li><li><span class="post-count">阅读时长: 82分钟</span></li></ul></div></header><div class="article-entry post-content" itemprop="articleBody"><p>&amp;emsp;&amp;emsp;库DeepSQL特性实现DB4AI功能，即在数据库内实现AI算法，以更好的支撑大数据的快速分析和计算。这里提供了一整套基于SQL的机器学习、数据挖掘以及统计学的算法，用户可以直接使用SQL进行机…</p><span id="more"></span><p>概述<br>环境部署<br>使用指导<br>最佳实践<br>常见问题处理</p><h3 id="一、概述"><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h3><p>DeepSQL是对openGauss DB4AI能力的增强，让对MADLib比较熟悉的数据分析师或开发者可以轻松迁移到openGauss上进行工作。DeepSQL将常用的机器学习算法封装为SQL语句，支持60多个常用算法。其中包括回归算法（例如线性回归，逻辑回归，随机森林等）、分类算法（比如KNN等）、聚类算法（比如K-means）等。除了基础的机器学习算法之外，还包括图相关的算法，比如最短路径，图形直径等等算法；此外还支持数据处理（比如PCA），稀疏向量，统计学常用算法（比如协方差，Pearson系数计算等），训练集测试集分割方法，交叉验证方法等。<br>表 1 支持的机器学习算法 - 回归类算法</p><pre><code>算法中文名称  
算法英文名称  
应用场景  




逻辑回归  
Logistic Regression  
例如寻找某疾病的危险因素，金融商业机构需要对企业进行评估等。 预测：根据模型预测���同的自变量情况下某病或某情况的发生概率。 判别：实际上跟预测类似，也是根据模型判断某人属于某病或属于某种情况的概率有多大，即判断某��有多大可能是属于某病。  


Cox比例风险回归  
Cox Proportional Hazards Regression  
该模型以生存结局和生存时间为因变量，可同时分析众多因素对生存期的影响，能分析带有截尾生存时间的资料，且不要求估计资料的生存分布类型。由于上述优良性质，该模型自问世以来，在医学类研究中得到广泛的应用，是迄今生存分析中应用最多的多因素分析方法。  


弹性网络回归  
Elastic Net Regularization  
弹性回归是岭回归和套索回归的混合技术，它同时使用 L2 和 L1 正则化。当有多个相关的特征时，套索回归很可能随机选择其中一个，而弹性回归很可能都会选择。  


广义线性模型  
Generalized Linear Models  
在一些实际问题中，变量间的关系并不都是线性的，这种情况就应该用曲线去进行拟合。  


边际效应  
Marginal Effects  
提供边际效应的计算。  


多类回归  
Multinomial Regression  
如果目标类别数超过两个，这时就需要使用多类回归，如疗效可能是“无效”，“显效”，“痊愈”三类。  


序数回归  
Ordinal Regression  
在统计学中，序数回归是一种用于预测序数变量的回归分析，即其值存在于任意范围内的变量，不同值之间的度量距离也不同。它可以被认为是介于回归和分类之间的一类问题。例如，病情的分级（1、2、3、4级），症状的感觉分级（不痛、微痛、较痛和剧痛），对药物剂量反应的分级（无效、微效、中效和高效）等等。不同级别之间的差异不一定相等，如不痛与微痛的差值不一定等于较痛与剧痛的差值。  


聚类方差  
Clustered Variance  
Clustered Variance模块调整聚类的标准误差。例如，将一个数据集合复制100次，不应该增加参数估计的精度，但是在符合独立同分布假设（Independent Identically Distributed，IID）下执行这个过程实际上会提高精度。  


稳健方差  
Robust Variance  
Robust Variance模块中的函数用于计算线性回归、逻辑回归、多类逻辑回归和Cox比例风险回归的稳健方差（Huber-White估计）。它们可用于计算具有潜在噪声异常值的数据集中数据的差异。  


支持向量机  
Support Vector Machines(SVM)  
用于文本和超文本的分类、图像分类，比起传统的查询优化方案，支持向量机能够获取明显更高的搜索准确度。这同样也适用于图像分割系统。  


线性回归  
Linear Regression  
应用广泛，例如经济学、金融学等。  
</code></pre><p>表 2 支持的机器学习算法 - 其他监督学习</p><pre><code>算法名称（中文）  
算法名称（英文）  
应用场景  




决策树  
Decision Tree  
最为广泛的归纳推理算法之一，处理类别型或连续型变量的分类预测问题，可以用图形和if-then的规则表示模型，可读性较高。  


随机森林  
Random Forest  
随机森林是一类专门为决策树分类器设计的组合方法。它组合多棵决策树作出的预测。  


条件随机场  
Conditional Random Field (CRF)  
条件随机场（CRF）是一种判别的，无向概率的图形模型。线性链CRF是一种特殊类型的CRF，它假定当前状态仅取决于先前的状态。在分词、词性标注和命名实体识别等序列标注任务中取得了很好的效果。  


朴素贝叶斯  
Naive Bayes  
通过计算概率来进行分类，可以用来处理多分类问题，比如：垃圾邮件过滤器。  


神经网络  
Neural Networks  
拥有广泛的应用场景，譬如语音识别、图像识别、机器翻译等等。在模式识别的领域中算是标准监督学习算法，并在计算神经学中，持续成为被研究的课题。MLP已被证明是一种通用的函数近似方法，可以被用来拟合复杂的函数或解决分类问题。  


k临近算法  
k-Nearest Neighbors  
K近邻分类方法通过计算每个训练样例到待分类样品的距离，取和待分类样品距离最近的K个训练样例，K个样品中哪个类别的训练样例占多数，则待分类元组就属于哪个类别。 可用于：文字识别，面部识别，基因模式识别，客户流失预测、欺诈侦测。  
</code></pre><p>表 3 支持的机器学习算法 - 数据处理类算法</p><pre><code>算法名称（中文）  
算法名称（英文）  
应用场景  




数组操作  
Array Operations  
数组、向量操作运算，包括基础的加减乘除、幂运算、开方、cos、sin、绝对值、方差等。  


主成成分分析  
Dimensionality Reduction (PCA)  
降维，计算主成分。  


变量编码  
Encoding Categorical Variables  
当前支持one-hot和dummy编码技术。 当需要用一组特定的预测变量与其它预测变量组作比较时，通常使用哑编码（dummy coding），与之比较的变量组称为参照组。One-hot编码与哑编码类似，两者的区别是前者为每种分类值建立数字类型的0/1指示列。在每行数据中（对应一个数据点），只有一个分类编码列的值可以为1。  


矩阵操作  
Matrix Operations  
运用矩阵分解，将大型矩阵分解成简单矩阵的乘积形式，则可大大降低计算的难度以及计算量。 矩阵加减乘除、最值、均值、求秩、求逆、矩阵分解(QR，LU，Cholesky)，特征提取。  


规范化和距离函数  
Norms and Distance Functions  
求范数，余弦相似度，向量间距离。  


稀疏向量  
Sparse Vectors  
实现稀疏向量类型，如果向量中重复值较多，可以用来压缩储存节省空间。  


透视图  
Pivot  
透视表或枢轴表，通常用来实现OLAP或报表系统中一类常见的行列转置需求。pivot函数能够对一个表中存储的数据执行基本行转列操作，并将汇总后的结果输出到另一个表中。使行列转置操作变得更为简单与灵活。  


模式匹配  
Path  
是在一系列行上执行常规模式匹配，并提取有关模式匹配的有用信息。有用的信息可以是简单的匹配计数或更多涉及的内容，如聚合或窗口函数。  


会话  
Sessionize  
会话化功能对包括事件序列的数据集执行面向时间的会话重建。定义的不活动时段表示一个会话��结束和下一个会话的开始。 可以用于：网络分析，网络安全，制造，财务和运营分析。  


共轭梯度法  
Conjugate gradient  
求解系数矩阵为对称正定矩阵的线性方程组的数值解的方法。  


词干提取  
Stemming  
词干提取简单说就是找出单词中的词干部分，场景比如：搜索引擎建立网页主题概念。 在英文网站优化作用明显，对其他语言有借鉴意义。  


训练集测试集分割  
Train-Test Split  
分割数据集，把一份数据集划分成训练集和测试集，train的部分用于训练，test部分用于验证。  


交叉验证  
Cross Validation  
交叉验证。  


预测指标  
Prediction Metrics  
用于评估模型预测的质量，包括均方误差，AUC值、混淆矩阵、修正R方等用于评价模型的函数。  


小批量预处理  
Mini-Batch Preprocessor  
把数据打包成小份进行训练，优点是它可以比随机梯度下降（默认MADlib优化器）表现更好，会更快更平滑的收敛。  
</code></pre><p>表 4 支持的机器学习算法 - 图类</p><pre><code>算法名称（中文）  
算法名称（英文）  
应用场景  




所有对间最短路径  
All Pairs Shortest Path (APSP)  
所有对最短路径（APSP）算法找到所有顶点对之间的最短路径的长度（总和权重），使得路径边缘的权重之和最小化。  


广度优先算法  
Breadth-First Search  
广度优先算法遍历路径。  


超链接诱导主题搜索  
Hyperlink-Induced Topic Search (HITS)  
HITS算法输出每个节点的authority评分和hub评分，其中authority评分给出页面内容的分数，hub评估出连接到其他页面的分数。  


平均路径长度  
Average Path Length  
此函数计算每对顶点之间的最短路径的平均值。平均路径长度基于“可到达的目标顶点”，因此它忽略了未连接的顶点之间的无限长度路径。  


中心性  
Closeness Centrality  
接近度度量是和的倒数，平均值的倒数，以及到所有可到达目标顶点（不包括源顶点）的最短距离的倒数之和。  


图表直径  
Graph Diameter  
直径被定义为图中所有最短路径中最长的。  


入度出度  
In-Out Degree  
计算图中每个点的入度出度，入度指指向此点的边的数量，出度指此点指向其他点的边的数量。  


网页排名  
PageRank  
给定图形，给定图形，PageRank算法输出概率分布，该概率分布表示随机遍历图形的人将到达任何特定顶点的可能性。  


单源最短路径  
Single Source Shortest Path (SSSP)  
给定图形和源顶点，单源最短路径（SSSP）算法找到从源顶点到图中的每个其他顶点的路径，使得路径边缘的权重之和最小化（每条边权值非负）。  


弱连通分量  
Weakly Connected Component  
给定有向图，弱连通分量（WCC）是原始图的子图，其中所有顶点通过某个路径彼此连接，忽略边的方向。在无向图的情况下，弱连通分量也是强连通分量。该模块还包括许多在WCC输出上运行的辅助函数。  
</code></pre><p>表 5 支持的机器学习算法 - 时间序列</p><pre><code>算法名称（中文）  
算法名称（英文）  
应用场景  




差分整合移动平均自回归模型  
Autoregressive Integrated Moving Average model(ARIMA)  
时间序列预测，用于理解和预测一系列数据的未来值。 比如：国际航空旅客数据，预测旅客人数。  
</code></pre><p>表 6 支持的机器学习算法 - 采样</p><pre><code>算法名称（中文）  
算法名称（英文）  
应用场景  




采样函数  
sample  
抽样。  


分层抽样  
Stratified Sampling  
分层随机抽样，又称类型随机抽样，它是先将总体各单位按一定标准分成各种类型（或层）；然后根据各类型单位数与总体单位数的比例，确定从各类型中抽取样本单位的数量；最后，按照随机原则从各类型中抽取样本。  


对称抽样  
Balanced Sampling  
一些分类算法仅在每个类中的样本数大致相同时才最佳地执行。高度偏斜的数据集在许多领域中是常见的（例如，欺诈检测），因此重新采样以抵消这种不平衡可以产生更好的决策边界。  
</code></pre><p>表 7 支持的机器学习算法 - 统计学</p><pre><code>算法名称（中文）  
算法名称（英文）  
应用场景  




汇总统计函数  
Summary  
生成任何数据表的摘要统计信息。  


协方差和相关系数  
Correlation and Covariance  
描述性统计，求Pearson系数，相关系数，另一个输出协方差。了解数据从统计学上反映的量的特征，以便我们更好地认识这些将要被挖掘的数据。  


统计频率算法  
CountMin (Cormode-Muthukrishnan)  
统计一个实时的数据流中元素出现的频率，并且准备随时回答某个元素出现的频率，不需要的精确的计数。  


基数估计算法  
FM (Flajolet-Martin)  
获取指定列中的不同值的数量。 找出这个数字集合中不重复的数字的个数。  


最频繁值  
MFV (Most Frequent Values)  
计算频繁值的场景。  


假设检验  
Hypothesis Tests  
包含F-test，chi2-test等。  


概率函数  
Probability Functions  
概率函数模块为各种概率分布提供累积分布，密度、质量和分位数函数。  
</code></pre><p>表 8 支持的机器学习算法 - 其他算法</p><pre><code>算法名称（中文）  
算法名称（英文）  
应用场景  




k-聚类算法  
K-means  
聚类场景。  


隐含狄利克雷分布  
Latent Dirichlet Allocation (LDA)  
LDA 在主题模型中占有非常重要的地位，常用来文本分类。  


关联规则算法  
Apriori Algorithm  
关联规则算法，关联规则挖掘的目标是发现数据项集之间的关联关系。比如经典的“啤酒和尿布”。  
</code></pre><p> </p><h3 id="二、环境部署"><a href="#二、环境部署" class="headerlink" title="二、环境部署"></a>二、环境部署</h3><p>DeepSQL环境包括编译数据库和安装算法库两个部分。</p><h4 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h4><p>环境中安装python2.7.12以上版本Python。<br>数据库需要开启对PL&#x2F;Python存储过程的支持。<br>安装算法库需要拥有管理员权限的用户。</p><h4 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h4><p>检查部署Python环境。 安装前，请查看系统安装的python版本，当前DeepSQL需要python2.7.12以上版本的环境。</p><p>如果当前系统python2版本高于2.7.12，可以直接安装python-devel包。<br>如果版本过低，或者无法安装python-devel包，可以下载最新python2源码，手动配置编译python2，并配置环境变量。<br>算法库中，部分算法调用了python包，如numpy，pandas等。用户可以安装以下python库：<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  pip install numpy</span><br><span class="line">pip install pandas</span><br><span class="line">pip install scipy</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><p>编译部署数据库。 数据库需要开启对PL&#x2F;Python存储过程的支持。默认编译数据库，不包含此模块。因此需要编译数据库时，在configure阶段，加入–with-python参数； 其他编译保持步骤不变； 编译完成后，需要重新gs_initdb； 默认PL&#x2F;Python存储过程模块不被加载，请执行“CREATE EXTENSION plpythonu”来加载模块。<br>算法库编译和安装。 算法库使用开源的MADlib机器学习框架。源码包和相应patch可以从第三方库的代码仓库里获取。安装命令如下：<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  tar -zxf apache-madlib-<span class="number">1.17</span><span class="number">.0</span>-src.tar.gz</span><br><span class="line">cp madlib.patch apache-madlib-<span class="number">1.17</span><span class="number">.0</span>-src           </span><br><span class="line">cd apache-madlib-<span class="number">1.17</span><span class="number">.0</span>-src/</span><br><span class="line">patch -p1 &lt; madlib.patch</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>编译命令如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure -DCMAKE_INSTALL_PREFIX=&#123;YOUR_MADLIB_INSTALL_FOLDER&#125; -DPOSTGRESQL_EXECUTABLE=$GAUSSHOME/bin/ -DPOSTGRESQL_9_2_EXECUTABLE=$GAUSSHOME/bin/ -DPOSTGRESQL_9_2_CLIENT_INCLUDE_DIR=$GAUSSHOME/bin/ -DPOSTGRESQL_9_2_SERVER_INCLUDE_DIR=$GAUSSHOME/bin/ # 以上均为configure命令。 make make install </span><br></pre></td></tr></table></figure><br>其中， {YOUR_MADLIB_INSTALL_FOLDER}需要改为用户的实际安装路径。<p></p><p>将算法库安装到数据库中。</p><p>a.进入{YOUR_MADLIB_INSTALL_FOLDER}路径。<br>b.进入bin文件夹。<br>c.执行如下命令。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./madpack -s &lt;SCHEMA_NAME&gt; -p opengauss -c &lt;USER_NAME&gt;@<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:&lt;PORT&gt;/&lt;DATABASE_NAME&gt; install</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>命令中参数说明如下：</p><p>-s：schema的名称。<br>-p：数据库平台，使用opengauss即可。<br>-c：连接数据库的参数。包括用户名、‘@’、IP地址、端口号和目标数据库名称。</p><p>install为安装的命令，除此之外，还有reinstall（重新安装），uninstall（卸载）等命令可用。</p><p> </p><h3 id="三、使用指导"><a href="#三、使用指导" class="headerlink" title="三、使用指导"></a>三、使用指导</h3><h4 id="PL-x2F-Python存储过程"><a href="#PL-x2F-Python存储过程" class="headerlink" title="PL&#x2F;Python存储过程"></a>PL&#x2F;Python存储过程</h4><p>当前PL&#x2F;Python存储过程优先支持python2；默认版本也是python2。<br>PL&#x2F;Python中的函数通过标准的CREATE FUNCTION声明：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  CREATE FUNCTION <span class="title function_">funcname</span> <span class="params">(argument-list)</span></span><br><span class="line">RETURNS <span class="keyword">return</span>-type</span><br><span class="line">AS $$</span><br><span class="line"># PL/Python function body</span><br><span class="line">$$ LANGUAGE plpythonu;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>函数体是一个简单的Python脚本，当函数被调用的时候，它的参数作为列表args的元素传递；命名参数也会被当做普通的变量传递到Python脚本中。命名参数的使用通常更易读。 结果将使用return或yield（结果集语句的情况） 照常从Python代码中返回。如果没有提供返回值，Python返回缺省的None。 PL&#x2F;Python将Python中的None认为SQL空值。<br>例如，返回两个整数中较大者的函数定义如下。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  CREATE FUNCTION <span class="title function_">pymax</span><span class="params">(a integer, b integer)</span> RETURNS integer AS $$   </span><br><span class="line"><span class="keyword">if</span> a &gt; b:     </span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"><span class="keyword">return</span> b </span><br><span class="line">$$ LANGUAGE plpythonu;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="数据库Null-None和空串处理"><a href="#数据库Null-None和空串处理" class="headerlink" title="数据库Null, None和空串处理"></a>数据库Null, None和空串处理</h4><p>如果向函数传递了一个SQL null值，参数值在Python中将会显示为None。在数据库中，不同的兼容性下，空串的行为会被当做NULL处理。<br>同一个函数，在不同的兼容性下表现不同。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">  CREATE FUNCTION <span class="title function_">quote</span><span class="params">(t text, how text)</span> RETURNS text AS $$</span><br><span class="line"><span class="type">if</span> <span class="variable">how</span> <span class="operator">=</span>= <span class="string">&quot;literal&quot;</span>:</span><br><span class="line">    <span class="keyword">return</span> plpy.quote_literal(t)    </span><br><span class="line"><span class="type">elif</span> <span class="variable">how</span> <span class="operator">=</span>= <span class="string">&quot;nullable&quot;</span>:</span><br><span class="line">    <span class="keyword">return</span> plpy.quote_nullable(t)    </span><br><span class="line"><span class="type">elif</span> <span class="variable">how</span> <span class="operator">=</span>= <span class="string">&quot;ident&quot;</span>:</span><br><span class="line">    <span class="keyword">return</span> plpy.quote_ident(t)</span><br><span class="line"><span class="keyword">else</span>:        </span><br><span class="line">    raise plpy.Error(<span class="string">&quot;unrecognized quote type %s&quot;</span> % how)</span><br><span class="line">$$ LANGUAGE plpythonu;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>示例1：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT <span class="title function_">quote</span><span class="params">(t, <span class="string">&#x27;literal&#x27;</span>)</span> FROM (VALUES (<span class="string">&#x27;abc&#x27;</span>),(<span class="string">&#x27;a&#x27;</span><span class="string">&#x27;bc&#x27;</span>),(<span class="string">&#x27;&#x27;</span><span class="string">&#x27;abc&#x27;</span><span class="string">&#x27;&#x27;</span>),(<span class="string">&#x27;&#x27;</span>),(<span class="string">&#x27;&#x27;</span><span class="string">&#x27;&#x27;</span>),(<span class="string">&#x27;xyzv&#x27;</span>)) AS <span class="title function_">v</span><span class="params">(t)</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>数据库不同兼容性下的结果为：</p><p>兼容性为A时，返回结果如下：<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  ERROR:  TypeError: argument <span class="number">1</span> must be string, not None</span><br><span class="line">CONTEXT:  Traceback (most recent call last):</span><br><span class="line">PL/Python function <span class="string">&quot;quote&quot;</span>, line <span class="number">3</span>, in &lt;<span class="keyword">module</span>&gt;</span><br><span class="line"><span class="keyword">return</span> plpy.quote_literal(t)</span><br><span class="line">referenced column: quote</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><p>兼容性为B时，返回结果如下：<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">  quote</span><br><span class="line">-----------</span><br><span class="line"><span class="string">&#x27;abc&#x27;</span></span><br><span class="line"><span class="string">&#x27;a&#x27;</span><span class="string">&#x27;bc&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span><span class="string">&#x27;abc&#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;xyzv&#x27;</span></span><br><span class="line">(<span class="number">6</span> rows)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><p>示例2：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT <span class="title function_">quote</span><span class="params">(t, <span class="string">&#x27;nullable&#x27;</span>)</span> FROM (VALUES (<span class="string">&#x27;abc&#x27;</span>),(<span class="string">&#x27;a&#x27;</span><span class="string">&#x27;bc&#x27;</span>),(<span class="string">&#x27;&#x27;</span><span class="string">&#x27;abc&#x27;</span><span class="string">&#x27;&#x27;</span>),(<span class="string">&#x27;&#x27;</span>),(<span class="string">&#x27;&#x27;</span><span class="string">&#x27;&#x27;</span>),(NULL)) AS <span class="title function_">v</span><span class="params">(t)</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>数据库不同兼容性下的结果为：</p><p>兼容性为A时，返回结果如下：<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">  quote</span><br><span class="line">-----------</span><br><span class="line"><span class="string">&#x27;abc&#x27;</span></span><br><span class="line"><span class="string">&#x27;a&#x27;</span><span class="string">&#x27;bc&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span><span class="string">&#x27;abc&#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">NULL</span><br><span class="line"><span class="string">&#x27;&#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">NULL</span><br><span class="line">(<span class="number">6</span> rows)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><p>兼容性为B时，返回结果如下：<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">  quote</span><br><span class="line">-----------</span><br><span class="line"><span class="string">&#x27;abc&#x27;</span></span><br><span class="line"><span class="string">&#x27;a&#x27;</span><span class="string">&#x27;bc&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span><span class="string">&#x27;abc&#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">NULL</span><br><span class="line">(<span class="number">6</span> rows)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><p>可以看到，在兼容性“A”中，空串被当为NULL了。</p><h4 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h4><p>当前PL&#x2F;Python存储过程中，不支持触发器功能。</p><h4 id="匿名代码块"><a href="#匿名代码块" class="headerlink" title="匿名代码块"></a>匿名代码块</h4><p>PL&#x2F;Python也支持DO声明的匿名代码块：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  DO $$</span><br><span class="line"># PL/Python code</span><br><span class="line">$$ LANGUAGE plpythonu;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>一个匿名代码块不接受参数，并且丢弃它可能返回的值。</p><h4 id="共享数据"><a href="#共享数据" class="headerlink" title="共享数据"></a>共享数据</h4><p>每个函数都在Python解释器里获得自己的执行环境。<br>全局字典SD在函数调用之间用于存储数据。这些变量是私有静态数据。每一个函数都有自己的SD数据空间，函数A的全局数据和函数参数是函数B不可用的。<br>全局字典GD是公共数据，在一个gsql会话中，所有python函数都可访问和改变，使用时需要小心。<br>当gsql断开或退出，共享数据就被释放。</p><h4 id="数据库访问"><a href="#数据库访问" class="headerlink" title="数据库访问"></a>数据库访问</h4><p>PL&#x2F;Python语言模块自动import一个叫plpy的Python模块。<br>plpy模块提供几个函数执行数据库命令：比如plpy.execute，plpy.prepare等。<br>plpy模块也提供了函数plpy.debug(msg)、 plpy.log(msg)、plpy.info(msg)、 plpy.notice(msg)、plpy.warning(msg)、 plpy.error(msg)和plpy.fatal(msg)。 plpy.error和 plpy.fatal实际上抛出了一个Python异常，会导致当前事务或者子事务退出。<br>另一个实用函数集是plpy.quote_literal(string)、 plpy.quote_nullable(string)和 plpy.quote_ident(string)。</p><h4 id="关于审计"><a href="#关于审计" class="headerlink" title="关于审计"></a>关于审计</h4><p>PL&#x2F;Python存储过程支持审计功能。具体设置可以参考审计。</p><h4 id="关于并发执行"><a href="#关于并发执行" class="headerlink" title="关于并发执行"></a>关于并发执行</h4><p>当前PL&#x2F;Python存储过程对并发执行不友好，建议串行执行。</p><h4 id="库内算法"><a href="#库内算法" class="headerlink" title="库内算法"></a>库内算法</h4><p>具体库内算法介绍和使用，可参考MADlib官方网站（MADlib文档）。</p><h4 id="其他算法支持"><a href="#其他算法支持" class="headerlink" title="其他算法支持"></a>其他算法支持</h4><p>除了MADlib提供的算法外，openGauss又额外提供了以下三个算法。<br>表 1 额外增加的模块列表</p><pre><code>算法名称（中文）  
算法名称（英文）  
</code></pre><p>梯度提升树<br>gbdt</p><pre><code>梯度提升  
xgboost  


时间序列预测的算法  
facebook_prophet  
</code></pre><p>使用时，需要安装依赖的python库：</p><p>如果使用prophet算法：<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  pip install pystan</span><br><span class="line">pip install holidays==<span class="number">0.9</span><span class="number">.8</span></span><br><span class="line">pip install fbprophet==<span class="number">0.3</span>.post2</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><p>如果使用xgboost算法：<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  pip install xgboost</span><br><span class="line">pip install scikit-learn</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><p>gbdt不需要额外安装其他库。</p><p>详细操作请参考最佳实践。</p><h3 id="四、最佳实践"><a href="#四、最佳实践" class="headerlink" title="四、最佳实践"></a>四、最佳实践</h3><p>本章节介绍部分算法的使用，主要包含分类、回归、聚类、gbdt算法、xgboost算法和prohpet算法。<br>首先需要创建一个数据库，并安装算法。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  create database test1 dbcompatibility=<span class="string">&#x27;B&#x27;</span>;</span><br><span class="line">./madpack -s madlib -p opengauss -c opg@<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">7651</span>/test1 install</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="分类算法"><a href="#分类算法" class="headerlink" title="分类算法"></a>分类算法</h4><p>以svm分类房价为例子：</p><p>数据集准备。<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">  DROP TABLE IF EXISTS houses;</span><br><span class="line">CREATE TABLE <span class="title function_">houses</span> <span class="params">(id INT, tax INT, bedroom INT, bath FLOAT, price INT,  size INT, lot INT)</span>;</span><br><span class="line">INSERT INTO houses <span class="title function_">VALUES</span></span><br><span class="line"><span class="params">(<span class="number">1</span> ,  <span class="number">590</span> ,       <span class="number">2</span> ,    <span class="number">1</span> ,  <span class="number">50000</span> ,  <span class="number">770</span> , <span class="number">22100</span>)</span>,</span><br><span class="line">(<span class="number">2</span> , <span class="number">1050</span> ,       <span class="number">3</span> ,    <span class="number">2</span> ,  <span class="number">85000</span> , <span class="number">1410</span> , <span class="number">12000</span>),</span><br><span class="line">(<span class="number">3</span> ,   <span class="number">20</span> ,       <span class="number">3</span> ,    <span class="number">1</span> ,  <span class="number">22500</span> , <span class="number">1060</span> ,  <span class="number">3500</span>),</span><br><span class="line">(<span class="number">4</span> ,  <span class="number">870</span> ,       <span class="number">2</span> ,    <span class="number">2</span> ,  <span class="number">90000</span> , <span class="number">1300</span> , <span class="number">17500</span>),</span><br><span class="line">(<span class="number">5</span> , <span class="number">1320</span> ,       <span class="number">3</span> ,    <span class="number">2</span> , <span class="number">133000</span> , <span class="number">1500</span> , <span class="number">30000</span>),</span><br><span class="line">(<span class="number">6</span> , <span class="number">1350</span> ,       <span class="number">2</span> ,    <span class="number">1</span> ,  <span class="number">90500</span> ,  <span class="number">820</span> , <span class="number">25700</span>),</span><br><span class="line">(<span class="number">7</span> , <span class="number">2790</span> ,       <span class="number">3</span> ,  <span class="number">2.5</span> , <span class="number">260000</span> , <span class="number">2130</span> , <span class="number">25000</span>),</span><br><span class="line">(<span class="number">8</span> ,  <span class="number">680</span> ,       <span class="number">2</span> ,    <span class="number">1</span> , <span class="number">142500</span> , <span class="number">1170</span> , <span class="number">22000</span>),</span><br><span class="line">(<span class="number">9</span> , <span class="number">1840</span> ,       <span class="number">3</span> ,    <span class="number">2</span> , <span class="number">160000</span> , <span class="number">1500</span> , <span class="number">19000</span>),</span><br><span class="line">(<span class="number">10</span> , <span class="number">3680</span> ,       <span class="number">4</span> ,    <span class="number">2</span> , <span class="number">240000</span> , <span class="number">2790</span> , <span class="number">20000</span>),</span><br><span class="line">(<span class="number">11</span> , <span class="number">1660</span> ,       <span class="number">3</span> ,    <span class="number">1</span> ,  <span class="number">87000</span> , <span class="number">1030</span> , <span class="number">17500</span>),</span><br><span class="line">(<span class="number">12</span> , <span class="number">1620</span> ,       <span class="number">3</span> ,    <span class="number">2</span> , <span class="number">118600</span> , <span class="number">1250</span> , <span class="number">20000</span>),</span><br><span class="line">(<span class="number">13</span> , <span class="number">3100</span> ,       <span class="number">3</span> ,    <span class="number">2</span> , <span class="number">140000</span> , <span class="number">1760</span> , <span class="number">38000</span>),</span><br><span class="line">(<span class="number">14</span> , <span class="number">2070</span> ,       <span class="number">2</span> ,    <span class="number">3</span> , <span class="number">148000</span> , <span class="number">1550</span> , <span class="number">14000</span>),</span><br><span class="line">(<span class="number">15</span> ,  <span class="number">650</span> ,       <span class="number">3</span> ,  <span class="number">1.5</span> ,  <span class="number">65000</span> , <span class="number">1450</span> , <span class="number">12000</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><p>模型训练。 训练前配置相应schema和兼容性参数：<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  SET search_path=<span class="string">&quot;$user&quot;</span>,<span class="keyword">public</span>,madlib;</span><br><span class="line"><span class="type">SET</span> <span class="variable">behavior_compat_options</span> <span class="operator">=</span> <span class="string">&#x27;bind_procedure_searchpath&#x27;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>使用默认的参数进行训练，分类的条件为‘price &lt; 100000’，SQL语句如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  DROP TABLE IF EXISTS houses_svm, houses_svm_summary; </span><br><span class="line">SELECT madlib.svm_classification(<span class="string">&#x27;public.houses&#x27;</span>,<span class="string">&#x27;public.houses_svm&#x27;</span>,<span class="string">&#x27;price &lt; 100000&#x27;</span>,<span class="string">&#x27;ARRAY[1, tax, bath, size]&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><p>查看模型。<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  \x on</span><br><span class="line">SELECT * FROM houses_svm;</span><br><span class="line">\x off</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>结果如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">  -[ RECORD <span class="number">1</span> ]------+-----------------------------------------------------------------</span><br><span class="line">coef               | &#123;<span class="number">.113989576847</span>,-<span class="number">.00226133300602</span>,-<span class="number">.0676303607996</span>,<span class="number">.00179440841072</span>&#125;</span><br><span class="line">loss               | <span class="number">.614496714256667</span></span><br><span class="line">norm_of_gradient   | <span class="number">108.171180769224</span></span><br><span class="line">num_iterations     | <span class="number">100</span></span><br><span class="line">num_rows_processed | <span class="number">15</span></span><br><span class="line">num_rows_skipped   | <span class="number">0</span></span><br><span class="line">dep_var_mapping    | &#123;f,t&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><p>进行预测。<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  DROP TABLE IF EXISTS houses_pred; </span><br><span class="line">SELECT madlib.svm_predict(<span class="string">&#x27;public.houses_svm&#x27;</span>,<span class="string">&#x27;public.houses&#x27;</span>,<span class="string">&#x27;id&#x27;</span>,<span class="string">&#x27;public.houses_pred&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><pre><code>查看预测结果  
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT *, price &lt; <span class="number">100000</span> AS actual FROM houses JOIN houses_pred <span class="title function_">USING</span> <span class="params">(id)</span> ORDER BY id;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>结果如下：<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">   id | tax  | bedroom | bath | price  | size |  lot  | prediction | decision_function | actual</span><br><span class="line">----+------+---------+------+--------+------+-------+------------+-------------------+--------</span><br><span class="line">  <span class="number">1</span> |  <span class="number">590</span> |       <span class="number">2</span> |    <span class="number">1</span> |  <span class="number">50000</span> |  <span class="number">770</span> | <span class="number">22100</span> | t          |      <span class="number">.09386721875</span> | t</span><br><span class="line">  <span class="number">2</span> | <span class="number">1050</span> |       <span class="number">3</span> |    <span class="number">2</span> |  <span class="number">85000</span> | <span class="number">1410</span> | <span class="number">12000</span> | t          |     <span class="number">.134445058042</span> | t</span><br><span class="line">  <span class="number">3</span> |   <span class="number">20</span> |       <span class="number">3</span> |    <span class="number">1</span> |  <span class="number">22500</span> | <span class="number">1060</span> |  <span class="number">3500</span> | t          |   <span class="number">1.9032054712902</span> | t</span><br><span class="line">  <span class="number">4</span> |  <span class="number">870</span> |       <span class="number">2</span> |    <span class="number">2</span> |  <span class="number">90000</span> | <span class="number">1300</span> | <span class="number">17500</span> | t          |    <span class="number">.3441000739464</span> | t</span><br><span class="line">  <span class="number">5</span> | <span class="number">1320</span> |       <span class="number">3</span> |    <span class="number">2</span> | <span class="number">133000</span> | <span class="number">1500</span> | <span class="number">30000</span> | f          |   -<span class="number">.3146180966186</span> | f</span><br><span class="line">  <span class="number">6</span> | <span class="number">1350</span> |       <span class="number">2</span> |    <span class="number">1</span> |  <span class="number">90500</span> |  <span class="number">820</span> | <span class="number">25700</span> | f          |  -<span class="number">1.5350254452892</span> | t</span><br><span class="line">  <span class="number">7</span> | <span class="number">2790</span> |       <span class="number">3</span> |  <span class="number">2.5</span> | <span class="number">260000</span> | <span class="number">2130</span> | <span class="number">25000</span> | f          |  -<span class="number">2.5421154971142</span> | f</span><br><span class="line">  <span class="number">8</span> |  <span class="number">680</span> |       <span class="number">2</span> |    <span class="number">1</span> | <span class="number">142500</span> | <span class="number">1170</span> | <span class="number">22000</span> | t          |    <span class="number">.6081106124962</span> | f</span><br><span class="line">  <span class="number">9</span> | <span class="number">1840</span> |       <span class="number">3</span> |    <span class="number">2</span> | <span class="number">160000</span> | <span class="number">1500</span> | <span class="number">19000</span> | f          |   -<span class="number">1.490511259749</span> | f</span><br><span class="line"> <span class="number">10</span> | <span class="number">3680</span> |       <span class="number">4</span> |    <span class="number">2</span> | <span class="number">240000</span> | <span class="number">2790</span> | <span class="number">20000</span> | f          |   -<span class="number">3.336577140997</span> | f</span><br><span class="line"> <span class="number">11</span> | <span class="number">1660</span> |       <span class="number">3</span> |    <span class="number">1</span> |  <span class="number">87000</span> | <span class="number">1030</span> | <span class="number">17500</span> | f          |  -<span class="number">1.8592129109042</span> | t</span><br><span class="line"> <span class="number">12</span> | <span class="number">1620</span> |       <span class="number">3</span> |    <span class="number">2</span> | <span class="number">118600</span> | <span class="number">1250</span> | <span class="number">20000</span> | f          |  -<span class="number">1.4416201011046</span> | f</span><br><span class="line"> <span class="number">13</span> | <span class="number">3100</span> |       <span class="number">3</span> |    <span class="number">2</span> | <span class="number">140000</span> | <span class="number">1760</span> | <span class="number">38000</span> | f          |   -<span class="number">3.873244660547</span> | f</span><br><span class="line"> <span class="number">14</span> | <span class="number">2070</span> |       <span class="number">2</span> |    <span class="number">3</span> | <span class="number">148000</span> | <span class="number">1550</span> | <span class="number">14000</span> | f          |  -<span class="number">1.9885277913972</span> | f</span><br><span class="line"> <span class="number">15</span> |  <span class="number">650</span> |       <span class="number">3</span> |  <span class="number">1.5</span> |  <span class="number">65000</span> | <span class="number">1450</span> | <span class="number">12000</span> | t          |   <span class="number">1.1445697772786</span> | t</span><br><span class="line">(<span class="number">15</span> rows)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><pre><code>查看误分率  
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT <span class="title function_">COUNT</span><span class="params">(*)</span> FROM houses_pred JOIN houses <span class="title function_">USING</span> <span class="params">(id)</span> WHERE houses_pred.prediction != (houses.price &lt; <span class="number">100000</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>结果如下：<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  count</span><br><span class="line">-------</span><br><span class="line">     <span class="number">3</span></span><br><span class="line">(<span class="number">1</span> row)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><p>使用svm其他核进行训练。<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  DROP TABLE IF EXISTS houses_svm_gaussian, houses_svm_gaussian_summary, houses_svm_gaussian_random; </span><br><span class="line">SELECT madlib.svm_classification( <span class="string">&#x27;public.houses&#x27;</span>,<span class="string">&#x27;public.houses_svm_gaussian&#x27;</span>,<span class="string">&#x27;price &lt; 100000&#x27;</span>,<span class="string">&#x27;ARRAY[1, tax, bath, size]&#x27;</span>,<span class="string">&#x27;gaussian&#x27;</span>,<span class="string">&#x27;n_components=10&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;init_stepsize=1, max_iter=200&#x27;</span> );</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>进行预测，并查看训练结果。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  DROP TABLE IF EXISTS houses_pred_gaussian; </span><br><span class="line">SELECT madlib.svm_predict(<span class="string">&#x27;public.houses_svm_gaussian&#x27;</span>,<span class="string">&#x27;public.houses&#x27;</span>,<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;public.houses_pred_gaussian&#x27;</span>);</span><br><span class="line">SELECT <span class="title function_">COUNT</span><span class="params">(*)</span> FROM houses_pred_gaussian JOIN houses <span class="title function_">USING</span> <span class="params">(id)</span> WHERE houses_pred_gaussian.prediction != (houses.price &lt; <span class="number">100000</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>结果如下。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">   count </span><br><span class="line">-------+    </span><br><span class="line"><span class="number">0</span> </span><br><span class="line">(<span class="number">1</span> row)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><p>其他参��� 除了指定不同的核方法外，还可以指定迭代次数，初始参数，比如init_stepsize, max_iter, class_weight等。</p><h4 id="回归算法"><a href="#回归算法" class="headerlink" title="回归算法"></a>回归算法</h4><p>我们以线性回归预测波士顿房价为例：</p><p>数据集准备。 同svm的数据集，请参见1。<br>训练模型。<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  SET search_path=<span class="string">&quot;$user&quot;</span>,<span class="keyword">public</span>,madlib;</span><br><span class="line"><span class="type">SET</span> <span class="variable">behavior_compat_options</span> <span class="operator">=</span> <span class="string">&#x27;bind_procedure_searchpath&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">DROP TABLE IF EXISTS houses_linregr, houses_linregr_summary;</span><br><span class="line">SELECT madlib.linregr_train( <span class="string">&#x27;public.houses&#x27;</span>, <span class="string">&#x27;public.houses_linregr&#x27;</span>,  <span class="string">&#x27;price&#x27;</span>, <span class="string">&#x27;ARRAY[1, tax, bath, size]&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><p>查看模型内容。<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  \x ON</span><br><span class="line">SELECT * FROM houses_linregr;</span><br><span class="line">\x OFF</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>返回结果如下。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">  -[ RECORD <span class="number">1</span> ]------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">coef                     | &#123;-<span class="number">12849.4168959872</span>,<span class="number">28.9613922651775</span>,<span class="number">10181.6290712649</span>,<span class="number">50.516894915353</span>&#125;</span><br><span class="line">r2                       | <span class="number">.768577580597462</span></span><br><span class="line">std_err                  | &#123;<span class="number">33453.0344331377</span>,<span class="number">15.8992104963991</span>,<span class="number">19437.7710925915</span>,<span class="number">32.9280231740856</span>&#125;</span><br><span class="line">t_stats                  | &#123;-<span class="number">.384103179688204</span>,<span class="number">1.82156166004197</span>,<span class="number">.523806408809163</span>,<span class="number">1.53416118083608</span>&#125;</span><br><span class="line">p_values                 | &#123;<span class="number">.708223134615411</span>,<span class="number">.0958005827189556</span>,<span class="number">.610804093526516</span>,<span class="number">.153235085548177</span>&#125;</span><br><span class="line">condition_no             | <span class="number">9002.50457069858</span></span><br><span class="line">num_rows_processed       | <span class="number">15</span></span><br><span class="line">num_missing_rows_skipped | <span class="number">0</span></span><br><span class="line">variance_covariance      | &#123;</span><br><span class="line">    &#123;<span class="number">1119105512.7847</span>,<span class="number">217782.067878005</span>,-<span class="number">283344228.394538</span>,-<span class="number">616679.693190829</span>&#125;,&#123;<span class="number">217782.067878005</span>,<span class="number">252.784894408806</span>,-<span class="number">46373.1796964038</span>,-<span class="number">369.864520095145</span>&#125;,&#123;-<span class="number">283344228.394538</span>,-<span class="number">46373.1796964038</span>,<span class="number">377826945.047986</span>,-<span class="number">209088.217319699</span>&#125;,&#123;-<span class="number">616679.693190829</span>,-<span class="number">369.864520095145</span>,-<span class="number">209088.217319699</span>,<span class="number">1084.25471015312</span>&#125;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><p>预测，并对比结果。<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  SELECT houses.*,</span><br><span class="line">    madlib.linregr_predict( m.coef, ARRAY[<span class="number">1</span>,tax,bath,size]) as predict,</span><br><span class="line">    price - madlib.linregr_predict( m.coef, ARRAY[<span class="number">1</span>,tax,bath,size]) as residual</span><br><span class="line">FROM <span class="keyword">public</span>.houses, <span class="keyword">public</span>.houses_linregr AS m </span><br><span class="line">ORDER BY id;</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>返回结果如下。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">   id | tax  | bedroom | bath | price  | size |  lot  |     predict      |     residual</span><br><span class="line">----+------+---------+------+--------+------+-------+------------------+-------------------</span><br><span class="line">  <span class="number">1</span> |  <span class="number">590</span> |       <span class="number">2</span> |    <span class="number">1</span> |  <span class="number">50000</span> |  <span class="number">770</span> | <span class="number">22100</span> | <span class="number">53317.4426965543</span> | -<span class="number">3317.44269655428</span></span><br><span class="line">  <span class="number">2</span> | <span class="number">1050</span> |       <span class="number">3</span> |    <span class="number">2</span> |  <span class="number">85000</span> | <span class="number">1410</span> | <span class="number">12000</span> | <span class="number">109152.124955627</span> | -<span class="number">24152.1249556268</span></span><br><span class="line">  <span class="number">3</span> |   <span class="number">20</span> |       <span class="number">3</span> |    <span class="number">1</span> |  <span class="number">22500</span> | <span class="number">1060</span> |  <span class="number">3500</span> | <span class="number">51459.3486308555</span> | -<span class="number">28959.3486308555</span></span><br><span class="line">  <span class="number">4</span> |  <span class="number">870</span> |       <span class="number">2</span> |    <span class="number">2</span> |  <span class="number">90000</span> | <span class="number">1300</span> | <span class="number">17500</span> |  <span class="number">98382.215907206</span> | -<span class="number">8382.21590720599</span></span><br><span class="line">  <span class="number">5</span> | <span class="number">1320</span> |       <span class="number">3</span> |    <span class="number">2</span> | <span class="number">133000</span> | <span class="number">1500</span> | <span class="number">30000</span> | <span class="number">121518.221409606</span> |  <span class="number">11481.7785903935</span></span><br><span class="line">  <span class="number">6</span> | <span class="number">1350</span> |       <span class="number">2</span> |    <span class="number">1</span> |  <span class="number">90500</span> |  <span class="number">820</span> | <span class="number">25700</span> | <span class="number">77853.9455638568</span> |  <span class="number">12646.0544361432</span></span><br><span class="line">  <span class="number">7</span> | <span class="number">2790</span> |       <span class="number">3</span> |  <span class="number">2.5</span> | <span class="number">260000</span> | <span class="number">2130</span> | <span class="number">25000</span> | <span class="number">201007.926371722</span> |  <span class="number">58992.0736282778</span></span><br><span class="line">  <span class="number">8</span> |  <span class="number">680</span> |       <span class="number">2</span> |    <span class="number">1</span> | <span class="number">142500</span> | <span class="number">1170</span> | <span class="number">22000</span> | <span class="number">76130.7259665615</span> |  <span class="number">66369.2740334385</span></span><br><span class="line">  <span class="number">9</span> | <span class="number">1840</span> |       <span class="number">3</span> |    <span class="number">2</span> | <span class="number">160000</span> | <span class="number">1500</span> | <span class="number">19000</span> | <span class="number">136578.145387499</span> |  <span class="number">23421.8546125013</span></span><br><span class="line"> <span class="number">10</span> | <span class="number">3680</span> |       <span class="number">4</span> |    <span class="number">2</span> | <span class="number">240000</span> | <span class="number">2790</span> | <span class="number">20000</span> | <span class="number">255033.901596231</span> | -<span class="number">15033.9015962306</span></span><br><span class="line"> <span class="number">11</span> | <span class="number">1660</span> |       <span class="number">3</span> |    <span class="number">1</span> |  <span class="number">87000</span> | <span class="number">1030</span> | <span class="number">17500</span> | <span class="number">97440.5250982859</span> | -<span class="number">10440.5250982859</span></span><br><span class="line"> <span class="number">12</span> | <span class="number">1620</span> |       <span class="number">3</span> |    <span class="number">2</span> | <span class="number">118600</span> | <span class="number">1250</span> | <span class="number">20000</span> | <span class="number">117577.415360321</span> |  <span class="number">1022.58463967856</span></span><br><span class="line"> <span class="number">13</span> | <span class="number">3100</span> |       <span class="number">3</span> |    <span class="number">2</span> | <span class="number">140000</span> | <span class="number">1760</span> | <span class="number">38000</span> | <span class="number">186203.892319614</span> | -<span class="number">46203.8923196141</span></span><br><span class="line"> <span class="number">14</span> | <span class="number">2070</span> |       <span class="number">2</span> |    <span class="number">3</span> | <span class="number">148000</span> | <span class="number">1550</span> | <span class="number">14000</span> | <span class="number">155946.739425522</span> | -<span class="number">7946.73942552213</span></span><br><span class="line"> <span class="number">15</span> |  <span class="number">650</span> |       <span class="number">3</span> |  <span class="number">1.5</span> |  <span class="number">65000</span> | <span class="number">1450</span> | <span class="number">12000</span> | <span class="number">94497.4293105374</span> | -<span class="number">29497.4293105374</span></span><br><span class="line">(<span class="number">15</span> rows)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><h4 id="聚类算法"><a href="#聚类算法" class="headerlink" title="聚类算法"></a>聚类算法</h4><p>以kmeans为例：</p><p>准备数据。<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">  DROP TABLE IF EXISTS km_sample; </span><br><span class="line">CREATE TABLE <span class="title function_">km_sample</span><span class="params">(pid <span class="type">int</span>, points <span class="type">double</span> precision[])</span>; </span><br><span class="line">INSERT INTO km_sample <span class="title function_">VALUES</span> </span><br><span class="line"><span class="params">(<span class="number">1</span>,  <span class="string">&#x27;&#123;14.23, 1.71, 2.43, 15.6, 127, 2.8, 3.0600, 0.2800, 2.29, 5.64, 1.04, 3.92, 1065&#125;&#x27;</span>)</span>, </span><br><span class="line">(<span class="number">2</span>,  <span class="string">&#x27;&#123;13.2, 1.78, 2.14, 11.2, 1, 2.65, 2.76, 0.26, 1.28, 4.38, 1.05, 3.49, 1050&#125;&#x27;</span>), </span><br><span class="line">(<span class="number">3</span>,  <span class="string">&#x27;&#123;13.16, 2.36,  2.67, 18.6, 101, 2.8,  3.24, 0.3, 2.81, 5.6799, 1.03, 3.17, 1185&#125;&#x27;</span>), </span><br><span class="line">(<span class="number">4</span>,  <span class="string">&#x27;&#123;14.37, 1.95, 2.5, 16.8, 113, 3.85, 3.49, 0.24, 2.18, 7.8, 0.86, 3.45, 1480&#125;&#x27;</span>), </span><br><span class="line">(<span class="number">5</span>,  <span class="string">&#x27;&#123;13.24, 2.59, 2.87, 21, 118, 2.8, 2.69, 0.39, 1.82, 4.32, 1.04, 2.93, 735&#125;&#x27;</span>), </span><br><span class="line">(<span class="number">6</span>,  <span class="string">&#x27;&#123;14.2, 1.76, 2.45, 15.2, 112, 3.27, 3.39, 0.34, 1.97, 6.75, 1.05, 2.85, 1450&#125;&#x27;</span>), </span><br><span class="line">(<span class="number">7</span>,  <span class="string">&#x27;&#123;14.39, 1.87, 2.45, 14.6, 96, 2.5, 2.52, 0.3, 1.98, 5.25, 1.02, 3.58, 1290&#125;&#x27;</span>), </span><br><span class="line">(<span class="number">8</span>,  <span class="string">&#x27;&#123;14.06, 2.15, 2.61, 17.6, 121, 2.6, 2.51, 0.31, 1.25, 5.05, 1.06, 3.58, 1295&#125;&#x27;</span>), </span><br><span class="line">(<span class="number">9</span>,  <span class="string">&#x27;&#123;14.83, 1.64, 2.17, 14, 97, 2.8, 2.98, 0.29, 1.98, 5.2, 1.08, 2.85, 1045&#125;&#x27;</span>), </span><br><span class="line">(<span class="number">10</span>, <span class="string">&#x27;&#123;13.86, 1.35, 2.27, 16, 98, 2.98, 3.15, 0.22, 1.8500, 7.2199, 1.01, 3.55, 1045&#125;&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><p>运行kmeans算法。 使用kmeans++进行计算，距离函数使用欧几里得距离。<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">  SET search_path=<span class="string">&quot;$user&quot;</span>,<span class="keyword">public</span>,madlib;</span><br><span class="line"><span class="type">SET</span> <span class="variable">behavior_compat_options</span> <span class="operator">=</span> <span class="string">&#x27;bind_procedure_searchpath&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">DROP TABLE IF EXISTS km_result; </span><br><span class="line">CREATE TABLE km_result AS SELECT * FROM madlib.kmeanspp( <span class="string">&#x27;public.km_sample&#x27;</span>,   -- Table of source data                              </span><br><span class="line">                                                         <span class="string">&#x27;points&#x27;</span>,      -- Column containing point co-ordinates                              </span><br><span class="line">                                                         <span class="number">2</span>,             -- Number of centroids to calculate                              </span><br><span class="line">                                                         <span class="string">&#x27;madlib.squared_dist_norm2&#x27;</span>,   -- Distance function                              </span><br><span class="line">                                                         <span class="string">&#x27;madlib.avg&#x27;</span>,  -- Aggregate function                              </span><br><span class="line">                                                         <span class="number">20</span>,            -- Number of iterations                             </span><br><span class="line">                                                         <span class="number">0.001</span>          -- Fraction of centroids reassigned to keep iterating</span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>kmeans执行完后，不会自动创建表保存内容，所以需要用户自行创建table。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  \x on</span><br><span class="line"> select * from km_result;</span><br><span class="line">\x off</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>返回结果如下。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  -[ RECORD <span class="number">1</span> ]----+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">centroids        | &#123;</span><br><span class="line">    &#123;<span class="number">14.0333333333333</span>,<span class="number">1.84111111111111</span>,<span class="number">2.41</span>,<span class="number">15.5111111111111</span>,<span class="number">96.2222222222222</span>,<span class="number">2.91666666666667</span>,<span class="number">3.01111111111111</span>,<span class="number">.282222222222222</span>,<span class="number">1.95444444444444</span>,<span class="number">5.88553333333333</span>,<span class="number">1.02222222222222</span>,<span class="number">3.38222222222222</span>,<span class="number">1211.66666666667</span>&#125;,&#123;<span class="number">13.24</span>,<span class="number">2.59</span>,<span class="number">2.87</span>,<span class="number">21</span>,<span class="number">118</span>,<span class="number">2.8</span>,<span class="number">2.69</span>,<span class="number">.39</span>,<span class="number">1.82</span>,<span class="number">4.32</span>,<span class="number">1.04</span>,<span class="number">2.93</span>,<span class="number">735</span>&#125;&#125;</span><br><span class="line">cluster_variance | &#123;<span class="number">257041.999707571</span>,<span class="number">0</span>&#125;</span><br><span class="line">objective_fn     | <span class="number">257041.999707571</span></span><br><span class="line">frac_reassigned  | <span class="number">0</span></span><br><span class="line">num_iterations   | <span class="number">2</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><p>应用聚类结果。 执行以下函数，计算每个节点的临近节点和相应距离。<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">  DROP TABLE IF EXISTS km_points_silh; </span><br><span class="line">SELECT * FROM madlib.simple_silhouette_points(<span class="string">&#x27;public.km_sample&#x27;</span>,          -- Input points table</span><br><span class="line">                                              <span class="string">&#x27;public.km_points_silh&#x27;</span>,      -- Output table</span><br><span class="line">                                              <span class="string">&#x27;pid&#x27;</span>,                 -- Point ID column in input table</span><br><span class="line">                                              <span class="string">&#x27;points&#x27;</span>,              -- Points column in input table</span><br><span class="line">                                              <span class="string">&#x27;public.km_result&#x27;</span>,           -- Centroids table</span><br><span class="line">                                              <span class="string">&#x27;centroids&#x27;</span>,           -- Column in centroids table containing centroids</span><br><span class="line">                                              <span class="string">&#x27;madlib.squared_dist_norm2&#x27;</span>   -- Distance function</span><br><span class="line">); </span><br><span class="line">SELECT * FROM km_points_silh ORDER BY pid;</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>返回结果如下。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">   pid | centroid_id | neighbor_centroid_id |       silh</span><br><span class="line">-----+-------------+----------------------+------------------</span><br><span class="line">   <span class="number">1</span> |           <span class="number">0</span> |                    <span class="number">1</span> | <span class="number">.793983543638996</span></span><br><span class="line">   <span class="number">2</span> |           <span class="number">0</span> |                    <span class="number">1</span> | <span class="number">.688301735667703</span></span><br><span class="line">   <span class="number">3</span> |           <span class="number">0</span> |                    <span class="number">1</span> | <span class="number">.996324103148159</span></span><br><span class="line">   <span class="number">4</span> |           <span class="number">0</span> |                    <span class="number">1</span> | <span class="number">.869765755931474</span></span><br><span class="line">   <span class="number">5</span> |           <span class="number">1</span> |                    <span class="number">0</span> |                <span class="number">1</span></span><br><span class="line">   <span class="number">6</span> |           <span class="number">0</span> |                    <span class="number">1</span> | <span class="number">.888416176253661</span></span><br><span class="line">   <span class="number">7</span> |           <span class="number">0</span> |                    <span class="number">1</span> | <span class="number">.980107240092519</span></span><br><span class="line">   <span class="number">8</span> |           <span class="number">0</span> |                    <span class="number">1</span> | <span class="number">.975880363039906</span></span><br><span class="line">   <span class="number">9</span> |           <span class="number">0</span> |                    <span class="number">1</span> | <span class="number">.712384473959954</span></span><br><span class="line">  <span class="number">10</span> |           <span class="number">0</span> |                    <span class="number">1</span> | <span class="number">.712198411442872</span></span><br><span class="line">(<span class="number">10</span> rows)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><h4 id="gbdt算法"><a href="#gbdt算法" class="headerlink" title="gbdt算法"></a>gbdt算法</h4><p>gdbt的基学习器虽然是回归树，但算法本身支持分类和回归两种操作。以下将展示两种任务的具体实现。这里值得注意的一点是，本方法不支持标签列含有空值（NULL）的情况。<br>分类任务：</p><p>准备数据。<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">  DROPTABLEIFEXISTS dt_golf CASCADE;</span><br><span class="line">DROPTABLEIFEXISTS train_output,train_output_summary;</span><br><span class="line">CREATETABLE <span class="title function_">dt_golf</span> <span class="params">(</span></span><br><span class="line"><span class="params">    id integerNOTNULL,</span></span><br><span class="line"><span class="params"><span class="string">&quot;OUTLOOK&quot;</span>text,</span></span><br><span class="line"><span class="params">    temperature <span class="type">double</span> precision,</span></span><br><span class="line"><span class="params">    humidity <span class="type">double</span> precision,</span></span><br><span class="line"><span class="params"><span class="string">&quot;Cont_features&quot;</span><span class="type">double</span> precision[],</span></span><br><span class="line"><span class="params">    cat_features text[],</span></span><br><span class="line"><span class="params">    windy <span class="type">boolean</span>,</span></span><br><span class="line"><span class="params">    class integer</span></span><br><span class="line"><span class="params">)</span> ;</span><br><span class="line">INSERTINTO <span class="title function_">dt_golf</span> <span class="params">(id,<span class="string">&quot;OUTLOOK&quot;</span>,temperature,humidity,<span class="string">&quot;Cont_features&quot;</span>,cat_features, windy,class)</span> VALUES</span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;sunny&#x27;</span>, <span class="number">85</span>, <span class="number">85</span>,ARRAY[<span class="number">85</span>, <span class="number">85</span>], ARRAY[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>], <span class="literal">false</span>, <span class="number">0</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;sunny&#x27;</span>, <span class="number">80</span>, <span class="number">90</span>, ARRAY[<span class="number">80</span>, <span class="number">90</span>], ARRAY[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>], <span class="literal">true</span>, <span class="number">0</span>),</span><br><span class="line">(<span class="number">3</span>, <span class="string">&#x27;overcast&#x27;</span>, <span class="number">83</span>, <span class="number">78</span>, ARRAY[<span class="number">83</span>, <span class="number">78</span>], ARRAY[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>], <span class="literal">false</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="number">4</span>, <span class="string">&#x27;rain&#x27;</span>, <span class="number">70</span>, NULL, ARRAY[<span class="number">70</span>, <span class="number">96</span>], ARRAY[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>], <span class="literal">false</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="number">5</span>, <span class="string">&#x27;rain&#x27;</span>, <span class="number">68</span>, <span class="number">80</span>, ARRAY[<span class="number">68</span>, <span class="number">80</span>], ARRAY[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>], <span class="literal">false</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="number">6</span>, <span class="string">&#x27;rain&#x27;</span>, NULL, <span class="number">70</span>, ARRAY[<span class="number">65</span>, <span class="number">70</span>], ARRAY[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>], <span class="literal">true</span>, <span class="number">0</span>),</span><br><span class="line">(<span class="number">7</span>, <span class="string">&#x27;overcast&#x27;</span>, <span class="number">64</span>, <span class="number">65</span>, ARRAY[<span class="number">64</span>, <span class="number">65</span>], ARRAY[<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;b&#x27;</span>], NULL , <span class="number">1</span>),</span><br><span class="line">(<span class="number">8</span>, <span class="string">&#x27;sunny&#x27;</span>, <span class="number">72</span>, <span class="number">95</span>, ARRAY[<span class="number">72</span>, <span class="number">95</span>], ARRAY[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>], <span class="literal">false</span>, <span class="number">0</span>),</span><br><span class="line">(<span class="number">9</span>, <span class="string">&#x27;sunny&#x27;</span>, <span class="number">69</span>, <span class="number">70</span>, ARRAY[<span class="number">69</span>, <span class="number">70</span>], ARRAY[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>], <span class="literal">false</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="number">10</span>, <span class="string">&#x27;rain&#x27;</span>, <span class="number">75</span>, <span class="number">80</span>, ARRAY[<span class="number">75</span>, <span class="number">80</span>], ARRAY[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>], <span class="literal">false</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="number">11</span>, <span class="string">&#x27;sunny&#x27;</span>, <span class="number">75</span>, <span class="number">70</span>, ARRAY[<span class="number">75</span>, <span class="number">70</span>], ARRAY[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;d&#x27;</span>], <span class="literal">true</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="number">12</span>, <span class="string">&#x27;overcast&#x27;</span>, <span class="number">72</span>, <span class="number">90</span>, ARRAY[<span class="number">72</span>, <span class="number">90</span>], ARRAY[<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;b&#x27;</span>], NULL, <span class="number">1</span>),</span><br><span class="line">(<span class="number">13</span>, <span class="string">&#x27;overcast&#x27;</span>, <span class="number">81</span>, <span class="number">75</span>, ARRAY[<span class="number">81</span>, <span class="number">75</span>], ARRAY[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>], <span class="literal">false</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="number">15</span>, NULL, <span class="number">81</span>, <span class="number">75</span>, ARRAY[<span class="number">81</span>, <span class="number">75</span>], ARRAY[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>], <span class="literal">false</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="number">16</span>, <span class="string">&#x27;overcast&#x27;</span>, NULL, <span class="number">75</span>, ARRAY[<span class="number">81</span>, <span class="number">75</span>], ARRAY[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;d&#x27;</span>], <span class="literal">false</span>,<span class="number">1</span>),</span><br><span class="line">(<span class="number">14</span>, <span class="string">&#x27;rain&#x27;</span>, <span class="number">71</span>, <span class="number">80</span>, ARRAY[<span class="number">71</span>, <span class="number">80</span>], ARRAY[<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;b&#x27;</span>], <span class="literal">true</span>, <span class="number">0</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><p>训练模型。<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">  select madlib.gbdt_train(<span class="string">&#x27;dt_golf&#x27;</span>,         -- source table</span><br><span class="line">                  <span class="string">&#x27;train_output&#x27;</span>,    -- output model table</span><br><span class="line">                  <span class="string">&#x27;id&#x27;</span>  ,            -- id column</span><br><span class="line">                  <span class="string">&#x27;class&#x27;</span>,           -- response</span><br><span class="line">                  <span class="string">&#x27;&quot;OUTLOOK&quot;, temperature&#x27;</span>,          -- features</span><br><span class="line">                  NULL,        -- exclude columns</span><br><span class="line">                  <span class="number">1</span>,       --weight</span><br><span class="line">                  <span class="number">10</span>,                -- num of trees</span><br><span class="line">                  NULL,                 -- num of random features</span><br><span class="line">                  <span class="number">10</span>,       -- max depth</span><br><span class="line">                  <span class="number">1</span>,        -- min split</span><br><span class="line">                  <span class="number">1</span>,        -- min bucket</span><br><span class="line">                  <span class="number">8</span>,        -- number of bins per continuous variable</span><br><span class="line">                  <span class="string">&#x27;max_surrogates=0&#x27;</span>,</span><br><span class="line">                  TRUE</span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>模型训练结束会生成两个表，其中一张表train_output中保存着gdbt中的回归树模型，内容包括对每一个基学习器的参数记录。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">         Column       |     Type      | Modifiers | Storage  | Stats target | Description</span><br><span class="line">--------------------+---------------+-----------+----------+--------------+-------------</span><br><span class="line"> iteration          | integer       |           | plain    |              |</span><br><span class="line"> tree               | madlib.bytea8 |           | external |              |</span><br><span class="line"> cat_levels_in_text | text[]        |           | extended |              |</span><br><span class="line"> cat_n_levels       | integer[]     |           | extended |              |</span><br><span class="line"> tree_depth         | integer       |           | plain    |              |</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">   iteration |  cat_levels_in_text   | cat_n_levels | tree_depth</span><br><span class="line">-----------+-----------------------+--------------+------------</span><br><span class="line">         <span class="number">0</span> | &#123;sunny,rain,overcast&#125; | &#123;<span class="number">3</span>&#125;          |          <span class="number">4</span></span><br><span class="line">         <span class="number">1</span> | &#123;sunny,rain,overcast&#125; | &#123;<span class="number">3</span>&#125;          |          <span class="number">5</span></span><br><span class="line">         <span class="number">2</span> | &#123;sunny,rain,overcast&#125; | &#123;<span class="number">3</span>&#125;          |          <span class="number">6</span></span><br><span class="line">         <span class="number">3</span> | &#123;sunny,rain,overcast&#125; | &#123;<span class="number">3</span>&#125;          |          <span class="number">4</span></span><br><span class="line">         <span class="number">4</span> | &#123;sunny,rain,overcast&#125; | &#123;<span class="number">3</span>&#125;          |          <span class="number">5</span></span><br><span class="line">         <span class="number">5</span> | &#123;sunny,rain,overcast&#125; | &#123;<span class="number">3</span>&#125;          |          <span class="number">5</span></span><br><span class="line">         <span class="number">6</span> | &#123;sunny,rain,overcast&#125; | &#123;<span class="number">3</span>&#125;          |          <span class="number">5</span></span><br><span class="line">         <span class="number">7</span> | &#123;sunny,rain,overcast&#125; | &#123;<span class="number">3</span>&#125;          |          <span class="number">5</span></span><br><span class="line">         <span class="number">8</span> | &#123;sunny,rain,overcast&#125; | &#123;<span class="number">3</span>&#125;          |          <span class="number">4</span></span><br><span class="line">         <span class="number">9</span> | &#123;sunny,rain,overcast&#125; | &#123;<span class="number">3</span>&#125;          |          <span class="number">3</span></span><br><span class="line">(<span class="number">10</span> rows)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>另一张表train_output_summary，内容是对gdbt训练的整体描述：<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  select * from train_output_summary;</span><br><span class="line"> method | cat_features | con_features | source_table | model_table  | null_proxy | learning_rate | is_classification | predict_dt_prob | num_trees</span><br><span class="line">--------+--------------+--------------+--------------+--------------+------------+---------------+-------------------+-----------------+-----------</span><br><span class="line"> GBDT   | <span class="string">&quot;OUTLOOK&quot;</span>    | temperature  | dt_golf      | train_output |            |           <span class="number">.01</span> | t                 | response        |        <span class="number">10</span></span><br><span class="line">(<span class="number">1</span> row)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><p>预测。<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select madlib.gbdt_predict(<span class="string">&#x27;dt_golf2&#x27;</span>,<span class="string">&#x27;train_output&#x27;</span>,<span class="string">&#x27;test_output&#x27;</span>,<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>查看预测结果<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">  select test_output.id, test_prediction,<span class="keyword">class</span> <span class="title class_">from</span> test_output join dt_golf <span class="title function_">using</span> <span class="params">(id)</span>;</span><br><span class="line">id | test_prediction | class</span><br><span class="line">----+-----------------+-------</span><br><span class="line">  <span class="number">1</span> |             <span class="number">1.0</span> |     <span class="number">0</span></span><br><span class="line">  <span class="number">2</span> |             <span class="number">1.0</span> |     <span class="number">0</span></span><br><span class="line">  <span class="number">3</span> |             <span class="number">1.0</span> |     <span class="number">1</span></span><br><span class="line">  <span class="number">4</span> |             <span class="number">1.0</span> |     <span class="number">1</span></span><br><span class="line">  <span class="number">5</span> |             <span class="number">1.0</span> |     <span class="number">1</span></span><br><span class="line">  <span class="number">6</span> |             <span class="number">1.0</span> |     <span class="number">0</span></span><br><span class="line">  <span class="number">7</span> |             <span class="number">1.0</span> |     <span class="number">1</span></span><br><span class="line">  <span class="number">8</span> |             <span class="number">0.0</span> |     <span class="number">0</span></span><br><span class="line">  <span class="number">9</span> |             <span class="number">1.0</span> |     <span class="number">1</span></span><br><span class="line"> <span class="number">10</span> |             <span class="number">1.0</span> |     <span class="number">1</span></span><br><span class="line"> <span class="number">11</span> |             <span class="number">1.0</span> |     <span class="number">1</span></span><br><span class="line"> <span class="number">12</span> |             <span class="number">1.0</span> |     <span class="number">1</span></span><br><span class="line"> <span class="number">13</span> |             <span class="number">1.0</span> |     <span class="number">1</span></span><br><span class="line"> <span class="number">15</span> |             <span class="number">0.0</span> |     <span class="number">1</span></span><br><span class="line"> <span class="number">16</span> |             <span class="number">1.0</span> |     <span class="number">1</span></span><br><span class="line"> <span class="number">14</span> |             <span class="number">0.0</span> |     <span class="number">0</span></span><br><span class="line">(<span class="number">16</span> rows)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><h4 id="回归任务"><a href="#回归任务" class="headerlink" title="回归任务"></a>回归任务</h4><p>准备数据。<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">  DROP TABLE IF EXISTS crime;</span><br><span class="line">CREATE TABLE <span class="title function_">crime</span> <span class="params">(</span></span><br><span class="line"><span class="params">    id SERIAL NOT NULL,</span></span><br><span class="line"><span class="params">    CrimeRat DOUBLE PRECISION,</span></span><br><span class="line"><span class="params">    MaleTeen INTEGER,</span></span><br><span class="line"><span class="params">    South SMALLINT,</span></span><br><span class="line"><span class="params">    Educ DOUBLE PRECISION,</span></span><br><span class="line"><span class="params">    Police60 INTEGER,</span></span><br><span class="line"><span class="params">    Police59 INTEGER,</span></span><br><span class="line"><span class="params">    Labor INTEGER,</span></span><br><span class="line"><span class="params">    Males INTEGER,</span></span><br><span class="line"><span class="params">    Pop   INTEGER,</span></span><br><span class="line"><span class="params">    NonWhite INTEGER,</span></span><br><span class="line"><span class="params">    Unemp1  INTEGER,</span></span><br><span class="line"><span class="params">    Unemp2  INTEGER,</span></span><br><span class="line"><span class="params">    Median  INTEGER,</span></span><br><span class="line"><span class="params">    BelowMed INTEGER</span></span><br><span class="line"><span class="params">)</span>;</span><br><span class="line">    </span><br><span class="line">INSERT INTO <span class="title function_">crime</span><span class="params">(</span></span><br><span class="line"><span class="params">    CrimeRat, MaleTeen, South, Educ, Police60, Police59, Labor, Males, Pop,</span></span><br><span class="line"><span class="params">    NonWhite, Unemp1, Unemp2, Median, BelowMed</span></span><br><span class="line"><span class="params">)</span> VALUES</span><br><span class="line">(<span class="number">79.1</span>, <span class="number">151</span>, <span class="number">1</span>, <span class="number">9.1</span>, <span class="number">58</span>, <span class="number">56</span>, <span class="number">510</span>, <span class="number">950</span>, <span class="number">33</span>, <span class="number">301</span>, <span class="number">108</span>, <span class="number">41</span>, <span class="number">394</span>, <span class="number">261</span>),</span><br><span class="line">(<span class="number">163.5</span>, <span class="number">143</span>, <span class="number">0</span>, <span class="number">11.3</span>, <span class="number">103</span>, <span class="number">95</span>, <span class="number">583</span>, <span class="number">1012</span>, <span class="number">13</span>, <span class="number">102</span>, <span class="number">96</span>, <span class="number">36</span>, <span class="number">557</span>, <span class="number">194</span>),</span><br><span class="line">(<span class="number">57.8</span>, <span class="number">142</span>, <span class="number">1</span>, <span class="number">8.9</span>, <span class="number">45</span>, <span class="number">44</span>, <span class="number">533</span>, <span class="number">969</span>, <span class="number">18</span>, <span class="number">219</span>, <span class="number">94</span>, <span class="number">33</span>, <span class="number">318</span>, <span class="number">250</span>),</span><br><span class="line">(<span class="number">196.9</span>, <span class="number">136</span>, <span class="number">0</span>, <span class="number">12.1</span>, <span class="number">149</span>, <span class="number">141</span>, <span class="number">577</span>, <span class="number">994</span>, <span class="number">157</span>, <span class="number">80</span>, <span class="number">102</span>, <span class="number">39</span>, <span class="number">673</span>, <span class="number">167</span>),</span><br><span class="line">(<span class="number">123.4</span>, <span class="number">141</span>, <span class="number">0</span>, <span class="number">12.1</span>, <span class="number">109</span>, <span class="number">101</span>, <span class="number">591</span>, <span class="number">985</span>, <span class="number">18</span>, <span class="number">30</span>, <span class="number">91</span>, <span class="number">20</span>, <span class="number">578</span>, <span class="number">174</span>),</span><br><span class="line">(<span class="number">68.2</span>, <span class="number">121</span>, <span class="number">0</span>, <span class="number">11.0</span>, <span class="number">118</span>, <span class="number">115</span>, <span class="number">547</span>, <span class="number">964</span>, <span class="number">25</span>, <span class="number">44</span>, <span class="number">84</span>, <span class="number">29</span>, <span class="number">689</span>, <span class="number">126</span>),</span><br><span class="line">(<span class="number">96.3</span>, <span class="number">127</span>, <span class="number">1</span>, <span class="number">11.1</span>, <span class="number">82</span>, <span class="number">79</span>, <span class="number">519</span>, <span class="number">982</span>, <span class="number">4</span>, <span class="number">139</span>, <span class="number">97</span>, <span class="number">38</span>, <span class="number">620</span>, <span class="number">168</span>),</span><br><span class="line">(<span class="number">155.5</span>, <span class="number">131</span>, <span class="number">1</span>, <span class="number">10.9</span>, <span class="number">115</span>, <span class="number">109</span>, <span class="number">542</span>, <span class="number">969</span>, <span class="number">50</span>, <span class="number">179</span>, <span class="number">79</span>, <span class="number">35</span>, <span class="number">472</span>, <span class="number">206</span>),</span><br><span class="line">(<span class="number">85.6</span>, <span class="number">157</span>, <span class="number">1</span>, <span class="number">9.0</span>, <span class="number">65</span>, <span class="number">62</span>, <span class="number">553</span>, <span class="number">955</span>, <span class="number">39</span>, <span class="number">286</span>, <span class="number">81</span>, <span class="number">28</span>, <span class="number">421</span>, <span class="number">239</span>),</span><br><span class="line">(<span class="number">70.5</span>, <span class="number">140</span>, <span class="number">0</span>, <span class="number">11.8</span>, <span class="number">71</span>, <span class="number">68</span>, <span class="number">632</span>, <span class="number">1029</span>, <span class="number">7</span>, <span class="number">15</span>, <span class="number">100</span>, <span class="number">24</span>, <span class="number">526</span>, <span class="number">174</span>),</span><br><span class="line">(<span class="number">167.4</span>, <span class="number">124</span>, <span class="number">0</span>, <span class="number">10.5</span>, <span class="number">121</span>, <span class="number">116</span>, <span class="number">580</span>, <span class="number">966</span>, <span class="number">101</span>, <span class="number">106</span>, <span class="number">77</span>, <span class="number">35</span>, <span class="number">657</span>, <span class="number">170</span>),</span><br><span class="line">(<span class="number">84.9</span>, <span class="number">134</span>, <span class="number">0</span>, <span class="number">10.8</span>, <span class="number">75</span>, <span class="number">71</span>, <span class="number">595</span>, <span class="number">972</span>, <span class="number">47</span>, <span class="number">59</span>, <span class="number">83</span>, <span class="number">31</span>, <span class="number">580</span>, <span class="number">172</span>),</span><br><span class="line">(<span class="number">51.1</span>, <span class="number">128</span>, <span class="number">0</span>, <span class="number">11.3</span>, <span class="number">67</span>, <span class="number">60</span>, <span class="number">624</span>, <span class="number">972</span>, <span class="number">28</span>, <span class="number">10</span>, <span class="number">77</span>, <span class="number">25</span>, <span class="number">507</span>, <span class="number">206</span>),</span><br><span class="line">(<span class="number">66.4</span>, <span class="number">135</span>, <span class="number">0</span>, <span class="number">11.7</span>, <span class="number">62</span>, <span class="number">61</span>, <span class="number">595</span>, <span class="number">986</span>, <span class="number">22</span>, <span class="number">46</span>, <span class="number">77</span>, <span class="number">27</span>, <span class="number">529</span>, <span class="number">190</span>),</span><br><span class="line">(<span class="number">79.8</span>, <span class="number">152</span>, <span class="number">1</span>, <span class="number">8.7</span>, <span class="number">57</span>, <span class="number">53</span>, <span class="number">530</span>, <span class="number">986</span>, <span class="number">30</span>, <span class="number">72</span>, <span class="number">92</span>, <span class="number">43</span>, <span class="number">405</span>, <span class="number">264</span>),</span><br><span class="line">(<span class="number">94.6</span>, <span class="number">142</span>, <span class="number">1</span>, <span class="number">8.8</span>, <span class="number">81</span>, <span class="number">77</span>, <span class="number">497</span>, <span class="number">956</span>, <span class="number">33</span>, <span class="number">321</span>, <span class="number">116</span>, <span class="number">47</span>, <span class="number">427</span>, <span class="number">247</span>),</span><br><span class="line">(<span class="number">53.9</span>, <span class="number">143</span>, <span class="number">0</span>, <span class="number">11.0</span>, <span class="number">66</span>, <span class="number">63</span>, <span class="number">537</span>, <span class="number">977</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">114</span>, <span class="number">35</span>, <span class="number">487</span>, <span class="number">166</span>),</span><br><span class="line">(<span class="number">92.9</span>, <span class="number">135</span>, <span class="number">1</span>, <span class="number">10.4</span>, <span class="number">123</span>, <span class="number">115</span>, <span class="number">537</span>, <span class="number">978</span>, <span class="number">31</span>, <span class="number">170</span>, <span class="number">89</span>, <span class="number">34</span>, <span class="number">631</span>, <span class="number">165</span>),</span><br><span class="line">(<span class="number">75.0</span>, <span class="number">130</span>, <span class="number">0</span>, <span class="number">11.6</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">536</span>, <span class="number">934</span>, <span class="number">51</span>, <span class="number">24</span>, <span class="number">78</span>, <span class="number">34</span>, <span class="number">627</span>, <span class="number">135</span>),</span><br><span class="line">(<span class="number">122.5</span>, <span class="number">125</span>, <span class="number">0</span>, <span class="number">10.8</span>, <span class="number">113</span>, <span class="number">105</span>, <span class="number">567</span>, <span class="number">985</span>, <span class="number">78</span>, <span class="number">94</span>, <span class="number">130</span>, <span class="number">58</span>, <span class="number">626</span>, <span class="number">166</span>),</span><br><span class="line">(<span class="number">74.2</span>, <span class="number">126</span>, <span class="number">0</span>, <span class="number">10.8</span>, <span class="number">74</span>, <span class="number">67</span>, <span class="number">602</span>, <span class="number">984</span>, <span class="number">34</span>, <span class="number">12</span>, <span class="number">102</span>, <span class="number">33</span>, <span class="number">557</span>, <span class="number">195</span>),</span><br><span class="line">(<span class="number">43.9</span>, <span class="number">157</span>, <span class="number">1</span>, <span class="number">8.9</span>, <span class="number">47</span>, <span class="number">44</span>, <span class="number">512</span>, <span class="number">962</span>, <span class="number">22</span>, <span class="number">423</span>, <span class="number">97</span>, <span class="number">34</span>, <span class="number">288</span>, <span class="number">276</span>),</span><br><span class="line">(<span class="number">121.6</span>, <span class="number">132</span>, <span class="number">0</span>, <span class="number">9.6</span>, <span class="number">87</span>, <span class="number">83</span>, <span class="number">564</span>, <span class="number">953</span>, <span class="number">43</span>, <span class="number">92</span>, <span class="number">83</span>, <span class="number">32</span>, <span class="number">513</span>, <span class="number">227</span>),</span><br><span class="line">(<span class="number">96.8</span>, <span class="number">131</span>, <span class="number">0</span>, <span class="number">11.6</span>, <span class="number">78</span>, <span class="number">73</span>, <span class="number">574</span>, <span class="number">1038</span>, <span class="number">7</span>, <span class="number">36</span>, <span class="number">142</span>, <span class="number">42</span>, <span class="number">540</span>, <span class="number">176</span>),</span><br><span class="line">(<span class="number">52.3</span>, <span class="number">130</span>, <span class="number">0</span>, <span class="number">11.6</span>, <span class="number">63</span>, <span class="number">57</span>, <span class="number">641</span>, <span class="number">984</span>, <span class="number">14</span>, <span class="number">26</span>, <span class="number">70</span>, <span class="number">21</span>, <span class="number">486</span>, <span class="number">196</span>),</span><br><span class="line">(<span class="number">199.3</span>, <span class="number">131</span>, <span class="number">0</span>, <span class="number">12.1</span>, <span class="number">160</span>, <span class="number">143</span>, <span class="number">631</span>, <span class="number">1071</span>, <span class="number">3</span>, <span class="number">77</span>, <span class="number">102</span>, <span class="number">41</span>, <span class="number">674</span>, <span class="number">152</span>),</span><br><span class="line">(<span class="number">34.2</span>, <span class="number">135</span>, <span class="number">0</span>, <span class="number">10.9</span>, <span class="number">69</span>, <span class="number">71</span>, <span class="number">540</span>, <span class="number">965</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">80</span>, <span class="number">22</span>, <span class="number">564</span>, <span class="number">139</span>),</span><br><span class="line">(<span class="number">121.6</span>, <span class="number">152</span>, <span class="number">0</span>, <span class="number">11.2</span>, <span class="number">82</span>, <span class="number">76</span>, <span class="number">571</span>, <span class="number">1018</span>, <span class="number">10</span>, <span class="number">79</span>, <span class="number">103</span>, <span class="number">28</span>, <span class="number">537</span>, <span class="number">215</span>),</span><br><span class="line">(<span class="number">104.3</span>, <span class="number">119</span>, <span class="number">0</span>, <span class="number">10.7</span>, <span class="number">166</span>, <span class="number">157</span>, <span class="number">521</span>, <span class="number">938</span>, <span class="number">168</span>, <span class="number">89</span>, <span class="number">92</span>, <span class="number">36</span>, <span class="number">637</span>, <span class="number">154</span>),</span><br><span class="line">(<span class="number">69.6</span>, <span class="number">166</span>, <span class="number">1</span>, <span class="number">8.9</span>, <span class="number">58</span>, <span class="number">54</span>, <span class="number">521</span>, <span class="number">973</span>, <span class="number">46</span>, <span class="number">254</span>, <span class="number">72</span>, <span class="number">26</span>, <span class="number">396</span>, <span class="number">237</span>),</span><br><span class="line">(<span class="number">37.3</span>, <span class="number">140</span>, <span class="number">0</span>, <span class="number">9.3</span>, <span class="number">55</span>, <span class="number">54</span>, <span class="number">535</span>, <span class="number">1045</span>, <span class="number">6</span>, <span class="number">20</span>, <span class="number">135</span>, <span class="number">40</span>, <span class="number">453</span>, <span class="number">200</span>),</span><br><span class="line">(<span class="number">75.4</span>, <span class="number">125</span>, <span class="number">0</span>, <span class="number">10.9</span>, <span class="number">90</span>, <span class="number">81</span>, <span class="number">586</span>, <span class="number">964</span>, <span class="number">97</span>, <span class="number">82</span>, <span class="number">105</span>, <span class="number">43</span>, <span class="number">617</span>, <span class="number">163</span>),</span><br><span class="line">(<span class="number">107.2</span>, <span class="number">147</span>, <span class="number">1</span>, <span class="number">10.4</span>, <span class="number">63</span>, <span class="number">64</span>, <span class="number">560</span>, <span class="number">972</span>, <span class="number">23</span>, <span class="number">95</span>, <span class="number">76</span>, <span class="number">24</span>, <span class="number">462</span>, <span class="number">233</span>),</span><br><span class="line">(<span class="number">92.3</span>, <span class="number">126</span>, <span class="number">0</span>, <span class="number">11.8</span>, <span class="number">97</span>, <span class="number">97</span>, <span class="number">542</span>, <span class="number">990</span>, <span class="number">18</span>, <span class="number">21</span>, <span class="number">102</span>, <span class="number">35</span>, <span class="number">589</span>, <span class="number">166</span>),</span><br><span class="line">(<span class="number">65.3</span>, <span class="number">123</span>, <span class="number">0</span>, <span class="number">10.2</span>, <span class="number">97</span>, <span class="number">87</span>, <span class="number">526</span>, <span class="number">948</span>, <span class="number">113</span>, <span class="number">76</span>, <span class="number">124</span>, <span class="number">50</span>, <span class="number">572</span>, <span class="number">158</span>),</span><br><span class="line">(<span class="number">127.2</span>, <span class="number">150</span>, <span class="number">0</span>, <span class="number">10.0</span>, <span class="number">109</span>, <span class="number">98</span>, <span class="number">531</span>, <span class="number">964</span>, <span class="number">9</span>, <span class="number">24</span>, <span class="number">87</span>, <span class="number">38</span>, <span class="number">559</span>, <span class="number">153</span>),</span><br><span class="line">(<span class="number">83.1</span>, <span class="number">177</span>, <span class="number">1</span>, <span class="number">8.7</span>, <span class="number">58</span>, <span class="number">56</span>, <span class="number">638</span>, <span class="number">974</span>, <span class="number">24</span>, <span class="number">349</span>, <span class="number">76</span>, <span class="number">28</span>, <span class="number">382</span>, <span class="number">254</span>),</span><br><span class="line">(<span class="number">56.6</span>, <span class="number">133</span>, <span class="number">0</span>, <span class="number">10.4</span>, <span class="number">51</span>, <span class="number">47</span>, <span class="number">599</span>, <span class="number">1024</span>, <span class="number">7</span>, <span class="number">40</span>, <span class="number">99</span>, <span class="number">27</span>, <span class="number">425</span>, <span class="number">225</span>),</span><br><span class="line">(<span class="number">82.6</span>, <span class="number">149</span>, <span class="number">1</span>, <span class="number">8.8</span>, <span class="number">61</span>, <span class="number">54</span>, <span class="number">515</span>, <span class="number">953</span>, <span class="number">36</span>, <span class="number">165</span>, <span class="number">86</span>, <span class="number">35</span>, <span class="number">395</span>, <span class="number">251</span>),</span><br><span class="line">(<span class="number">115.1</span>, <span class="number">145</span>, <span class="number">1</span>, <span class="number">10.4</span>, <span class="number">82</span>, <span class="number">74</span>, <span class="number">560</span>, <span class="number">981</span>, <span class="number">96</span>, <span class="number">126</span>, <span class="number">88</span>, <span class="number">31</span>, <span class="number">488</span>, <span class="number">228</span>),</span><br><span class="line">(<span class="number">88.0</span>, <span class="number">148</span>, <span class="number">0</span>, <span class="number">12.2</span>, <span class="number">72</span>, <span class="number">66</span>, <span class="number">601</span>, <span class="number">998</span>, <span class="number">9</span>, <span class="number">19</span>, <span class="number">84</span>, <span class="number">20</span>, <span class="number">590</span>, <span class="number">144</span>),</span><br><span class="line">(<span class="number">54.2</span>, <span class="number">141</span>, <span class="number">0</span>, <span class="number">10.9</span>, <span class="number">56</span>, <span class="number">54</span>, <span class="number">523</span>, <span class="number">968</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">107</span>, <span class="number">37</span>, <span class="number">489</span>, <span class="number">170</span>),</span><br><span class="line">(<span class="number">82.3</span>, <span class="number">162</span>, <span class="number">1</span>, <span class="number">9.9</span>, <span class="number">75</span>, <span class="number">70</span>, <span class="number">522</span>, <span class="number">996</span>, <span class="number">40</span>, <span class="number">208</span>, <span class="number">73</span>, <span class="number">27</span>, <span class="number">496</span>, <span class="number">224</span>),</span><br><span class="line">(<span class="number">103.0</span>, <span class="number">136</span>, <span class="number">0</span>, <span class="number">12.1</span>, <span class="number">95</span>, <span class="number">96</span>, <span class="number">574</span>, <span class="number">1012</span>, <span class="number">29</span>, <span class="number">36</span>, <span class="number">111</span>, <span class="number">37</span>, <span class="number">622</span>, <span class="number">162</span>),</span><br><span class="line">(<span class="number">45.5</span>, <span class="number">139</span>, <span class="number">1</span>, <span class="number">8.8</span>, <span class="number">46</span>, <span class="number">41</span>, <span class="number">480</span>, <span class="number">968</span>, <span class="number">19</span>, <span class="number">49</span>, <span class="number">135</span>, <span class="number">53</span>, <span class="number">457</span>, <span class="number">249</span>),</span><br><span class="line">(<span class="number">50.8</span>, <span class="number">126</span>, <span class="number">0</span>, <span class="number">10.4</span>, <span class="number">106</span>, <span class="number">97</span>, <span class="number">599</span>, <span class="number">989</span>, <span class="number">40</span>, <span class="number">24</span>, <span class="number">78</span>, <span class="number">25</span>, <span class="number">593</span>, <span class="number">171</span>),</span><br><span class="line">(<span class="number">84.9</span>, <span class="number">130</span>, <span class="number">0</span>, <span class="number">12.1</span>, <span class="number">90</span>, <span class="number">91</span>, <span class="number">623</span>, <span class="number">1049</span>, <span class="number">3</span>, <span class="number">22</span>, <span class="number">113</span>, <span class="number">40</span>, <span class="number">588</span>, <span class="number">160</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><p>训练模型。<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">  select madlib.gbdt_train(<span class="string">&#x27;crime&#x27;</span>,         -- source table</span><br><span class="line">                  <span class="string">&#x27;train_output&#x27;</span>,    -- output model table</span><br><span class="line">                  <span class="string">&#x27;id&#x27;</span>  ,            -- id column</span><br><span class="line">                  <span class="string">&#x27;CrimeRat&#x27;</span>,           -- response</span><br><span class="line">                 <span class="string">&#x27;*&#x27;</span>,          -- features</span><br><span class="line">                  NULL,        -- exclude columns</span><br><span class="line">                  <span class="number">1</span>,       --weight</span><br><span class="line">                  <span class="number">20</span>,                -- num of trees</span><br><span class="line">                  <span class="number">4</span>,                 -- num of random features</span><br><span class="line">                  <span class="number">10</span>,       -- max depth</span><br><span class="line">                  <span class="number">1</span>,        -- min split</span><br><span class="line">                  <span class="number">1</span>,        -- min bucket</span><br><span class="line">                  <span class="number">8</span>,        -- number of bins per continuous variable</span><br><span class="line">                  <span class="string">&#x27;max_surrogates=0&#x27;</span>,</span><br><span class="line">                  FALSE</span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>当is_clasification设为FALSE时，模型为回归任务。默认状态下gbdt提供回归计算支持。方法生成两个表，其中一张表记录每棵树的集体信息和模型的二进制，一张表记录方法的参数信息。<br>预测。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select madlib.gbdt_predict(<span class="string">&#x27;crime&#x27;</span>,<span class="string">&#x27;train_output&#x27;</span>,<span class="string">&#x27;test_output&#x27;</span>,<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>查看预测结果：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">  select test_output.id, test_prediction,CrimeRat  from test_output join crime <span class="title function_">using</span> <span class="params">(id)</span>;</span><br><span class="line">    </span><br><span class="line"> id |  test_prediction   | crimerat</span><br><span class="line">----+--------------------+----------</span><br><span class="line">  <span class="number">1</span> |               <span class="number">79.1</span> |     <span class="number">79.1</span></span><br><span class="line">  <span class="number">2</span> |              <span class="number">163.5</span> |    <span class="number">163.5</span></span><br><span class="line">  <span class="number">3</span> |               <span class="number">57.8</span> |     <span class="number">57.8</span></span><br><span class="line">  <span class="number">4</span> |              <span class="number">196.9</span> |    <span class="number">196.9</span></span><br><span class="line">  <span class="number">5</span> |              <span class="number">123.4</span> |    <span class="number">123.4</span></span><br><span class="line">  <span class="number">6</span> |               <span class="number">68.2</span> |     <span class="number">68.2</span></span><br><span class="line">  <span class="number">7</span> |   <span class="number">96.2999999992251</span> |     <span class="number">96.3</span></span><br><span class="line">  <span class="number">8</span> | <span class="number">155.49842087765936</span> |    <span class="number">155.5</span></span><br><span class="line">  <span class="number">9</span> |              <span class="number">84.35</span> |     <span class="number">85.6</span></span><br><span class="line"> <span class="number">10</span> |  <span class="number">70.50157912234037</span> |     <span class="number">70.5</span></span><br><span class="line"> <span class="number">11</span> |  <span class="number">167.4000000007749</span> |    <span class="number">167.4</span></span><br><span class="line"> <span class="number">12</span> |               <span class="number">84.9</span> |     <span class="number">84.9</span></span><br><span class="line"> <span class="number">13</span> |               <span class="number">51.1</span> |     <span class="number">51.1</span></span><br><span class="line"> <span class="number">14</span> |               <span class="number">66.4</span> |     <span class="number">66.4</span></span><br><span class="line"> <span class="number">15</span> |               <span class="number">79.8</span> |     <span class="number">79.8</span></span><br><span class="line"> <span class="number">16</span> |               <span class="number">94.6</span> |     <span class="number">94.6</span></span><br><span class="line"> <span class="number">17</span> |               <span class="number">53.9</span> |     <span class="number">53.9</span></span><br><span class="line"> <span class="number">18</span> |               <span class="number">92.9</span> |     <span class="number">92.9</span></span><br><span class="line"> <span class="number">19</span> |               <span class="number">75.0</span> |       <span class="number">75</span></span><br><span class="line"> <span class="number">20</span> |              <span class="number">122.5</span> |    <span class="number">122.5</span></span><br><span class="line"> <span class="number">21</span> |               <span class="number">74.2</span> |     <span class="number">74.2</span></span><br><span class="line"> <span class="number">22</span> |               <span class="number">43.9</span> |     <span class="number">43.9</span></span><br><span class="line"> <span class="number">23</span> |              <span class="number">121.6</span> |    <span class="number">121.6</span></span><br><span class="line"> <span class="number">24</span> |               <span class="number">96.8</span> |     <span class="number">96.8</span></span><br><span class="line"> <span class="number">25</span> |               <span class="number">52.3</span> |     <span class="number">52.3</span></span><br><span class="line"> <span class="number">26</span> |              <span class="number">199.3</span> |    <span class="number">199.3</span></span><br><span class="line"> <span class="number">27</span> |               <span class="number">34.2</span> |     <span class="number">34.2</span></span><br><span class="line"> <span class="number">28</span> |              <span class="number">121.6</span> |    <span class="number">121.6</span></span><br><span class="line"> <span class="number">29</span> |              <span class="number">104.3</span> |    <span class="number">104.3</span></span><br><span class="line"> <span class="number">30</span> |               <span class="number">69.6</span> |     <span class="number">69.6</span></span><br><span class="line"> <span class="number">31</span> |               <span class="number">37.3</span> |     <span class="number">37.3</span></span><br><span class="line"> <span class="number">32</span> |               <span class="number">75.4</span> |     <span class="number">75.4</span></span><br><span class="line"> <span class="number">33</span> |              <span class="number">107.2</span> |    <span class="number">107.2</span></span><br><span class="line"> <span class="number">34</span> |               <span class="number">92.3</span> |     <span class="number">92.3</span></span><br><span class="line"> <span class="number">35</span> |   <span class="number">65.2999999992251</span> |     <span class="number">65.3</span></span><br><span class="line"> <span class="number">36</span> | <span class="number">127.19842087765963</span> |    <span class="number">127.2</span></span><br><span class="line"> <span class="number">37</span> |  <span class="number">84.35000000002215</span> |     <span class="number">83.1</span></span><br><span class="line"> <span class="number">38</span> |  <span class="number">56.60155638297881</span> |     <span class="number">56.6</span></span><br><span class="line"> <span class="number">39</span> |  <span class="number">82.45000000075257</span> |     <span class="number">82.6</span></span><br><span class="line"> <span class="number">40</span> | <span class="number">115.10002273936168</span> |    <span class="number">115.1</span></span><br><span class="line"> <span class="number">41</span> |               <span class="number">88.0</span> |       <span class="number">88</span></span><br><span class="line"> <span class="number">42</span> |  <span class="number">54.19997726063828</span> |     <span class="number">54.2</span></span><br><span class="line"> <span class="number">43</span> |  <span class="number">82.44999999999999</span> |     <span class="number">82.3</span></span><br><span class="line"> <span class="number">44</span> | <span class="number">103.00002273936173</span> |      <span class="number">103</span></span><br><span class="line"> <span class="number">45</span> | <span class="number">45.500000000000156</span> |     <span class="number">45.5</span></span><br><span class="line"> <span class="number">46</span> |               <span class="number">50.8</span> |     <span class="number">50.8</span></span><br><span class="line"> <span class="number">47</span> |               <span class="number">84.9</span> |     <span class="number">84.9</span></span><br><span class="line">(<span class="number">47</span> rows)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><h4 id="xgboost算法"><a href="#xgboost算法" class="headerlink" title="xgboost算法"></a>xgboost算法</h4><p>新增的xgboost支持分类和回归两种操作。下面以分类iris花为例，展示xgboost算法。<br>xgboost支持grid search方式，可以同时训练多组参数。</p><p>准备数据。<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">  DROP TABLE IF EXISTS iris;</span><br><span class="line">create table <span class="title function_">iris</span> <span class="params">(id serial, a <span class="type">float</span>, d <span class="type">float</span>, c <span class="type">float</span>, b <span class="type">float</span>, label <span class="type">int</span>)</span>;</span><br><span class="line">    </span><br><span class="line">INSERT into <span class="title function_">iris</span> <span class="params">(a, b, c, d, label)</span> values </span><br><span class="line">(<span class="number">5.1</span>, <span class="number">3.5</span>, <span class="number">1.4</span>, <span class="number">0.2</span>, <span class="number">0</span>),(<span class="number">4.9</span>, <span class="number">3.0</span>, <span class="number">1.4</span>, <span class="number">0.2</span>, <span class="number">0</span>),(<span class="number">4.7</span>, <span class="number">3.2</span>, <span class="number">1.3</span>, <span class="number">0.2</span>, <span class="number">0</span>),(<span class="number">4.6</span>, <span class="number">3.1</span>, <span class="number">1.5</span>, <span class="number">0.2</span>, <span class="number">0</span>),</span><br><span class="line">(<span class="number">5.0</span>, <span class="number">3.6</span>, <span class="number">1.4</span>, <span class="number">0.2</span>, <span class="number">0</span>),(<span class="number">5.4</span>, <span class="number">3.9</span>, <span class="number">1.7</span>, <span class="number">0.4</span>, <span class="number">0</span>),(<span class="number">4.6</span>, <span class="number">3.4</span>, <span class="number">1.4</span>, <span class="number">0.3</span>, <span class="number">0</span>),(<span class="number">5.0</span>, <span class="number">3.4</span>, <span class="number">1.5</span>, <span class="number">0.2</span>, <span class="number">0</span>),</span><br><span class="line">(<span class="number">4.4</span>, <span class="number">2.9</span>, <span class="number">1.4</span>, <span class="number">0.2</span>, <span class="number">0</span>),(<span class="number">4.9</span>, <span class="number">3.1</span>, <span class="number">1.5</span>, <span class="number">0.1</span>, <span class="number">0</span>),(<span class="number">5.4</span>, <span class="number">3.7</span>, <span class="number">1.5</span>, <span class="number">0.2</span>, <span class="number">0</span>),(<span class="number">4.8</span>, <span class="number">3.4</span>, <span class="number">1.6</span>, <span class="number">0.2</span>, <span class="number">0</span>),</span><br><span class="line">(<span class="number">4.8</span>, <span class="number">3.0</span>, <span class="number">1.4</span>, <span class="number">0.1</span>, <span class="number">0</span>),(<span class="number">4.3</span>, <span class="number">3.0</span>, <span class="number">1.1</span>, <span class="number">0.1</span>, <span class="number">0</span>),(<span class="number">5.8</span>, <span class="number">4.0</span>, <span class="number">1.2</span>, <span class="number">0.2</span>, <span class="number">0</span>),(<span class="number">5.7</span>, <span class="number">4.4</span>, <span class="number">1.5</span>, <span class="number">0.4</span>, <span class="number">0</span>),</span><br><span class="line">(<span class="number">5.4</span>, <span class="number">3.9</span>, <span class="number">1.3</span>, <span class="number">0.4</span>, <span class="number">0</span>),(<span class="number">5.1</span>, <span class="number">3.5</span>, <span class="number">1.4</span>, <span class="number">0.3</span>, <span class="number">0</span>),(<span class="number">5.7</span>, <span class="number">3.8</span>, <span class="number">1.7</span>, <span class="number">0.3</span>, <span class="number">0</span>),(<span class="number">5.1</span>, <span class="number">3.8</span>, <span class="number">1.5</span>, <span class="number">0.3</span>, <span class="number">0</span>),</span><br><span class="line">(<span class="number">5.4</span>, <span class="number">3.4</span>, <span class="number">1.7</span>, <span class="number">0.2</span>, <span class="number">0</span>),(<span class="number">5.1</span>, <span class="number">3.7</span>, <span class="number">1.5</span>, <span class="number">0.4</span>, <span class="number">0</span>),(<span class="number">4.6</span>, <span class="number">3.6</span>, <span class="number">1.0</span>, <span class="number">0.2</span>, <span class="number">0</span>),(<span class="number">5.1</span>, <span class="number">3.3</span>, <span class="number">1.7</span>, <span class="number">0.5</span>, <span class="number">0</span>),</span><br><span class="line">(<span class="number">4.8</span>, <span class="number">3.4</span>, <span class="number">1.9</span>, <span class="number">0.2</span>, <span class="number">0</span>),(<span class="number">5.0</span>, <span class="number">3.0</span>, <span class="number">1.6</span>, <span class="number">0.2</span>, <span class="number">0</span>),(<span class="number">5.0</span>, <span class="number">3.4</span>, <span class="number">1.6</span>, <span class="number">0.4</span>, <span class="number">0</span>),(<span class="number">5.2</span>, <span class="number">3.5</span>, <span class="number">1.5</span>, <span class="number">0.2</span>, <span class="number">0</span>),</span><br><span class="line">(<span class="number">5.2</span>, <span class="number">3.4</span>, <span class="number">1.4</span>, <span class="number">0.2</span>, <span class="number">0</span>),(<span class="number">4.7</span>, <span class="number">3.2</span>, <span class="number">1.6</span>, <span class="number">0.2</span>, <span class="number">0</span>),(<span class="number">4.8</span>, <span class="number">3.1</span>, <span class="number">1.6</span>, <span class="number">0.2</span>, <span class="number">0</span>),(<span class="number">5.4</span>, <span class="number">3.4</span>, <span class="number">1.5</span>, <span class="number">0.4</span>, <span class="number">0</span>),</span><br><span class="line">(<span class="number">5.2</span>, <span class="number">4.1</span>, <span class="number">1.5</span>, <span class="number">0.1</span>, <span class="number">0</span>),(<span class="number">5.5</span>, <span class="number">4.2</span>, <span class="number">1.4</span>, <span class="number">0.2</span>, <span class="number">0</span>),(<span class="number">4.9</span>, <span class="number">3.1</span>, <span class="number">1.5</span>, <span class="number">0.2</span>, <span class="number">0</span>),(<span class="number">5.0</span>, <span class="number">3.2</span>, <span class="number">1.2</span>, <span class="number">0.2</span>, <span class="number">0</span>),</span><br><span class="line">(<span class="number">5.5</span>, <span class="number">3.5</span>, <span class="number">1.3</span>, <span class="number">0.2</span>, <span class="number">0</span>),(<span class="number">4.9</span>, <span class="number">3.6</span>, <span class="number">1.4</span>, <span class="number">0.1</span>, <span class="number">0</span>),(<span class="number">4.4</span>, <span class="number">3.0</span>, <span class="number">1.3</span>, <span class="number">0.2</span>, <span class="number">0</span>),(<span class="number">5.1</span>, <span class="number">3.4</span>, <span class="number">1.5</span>, <span class="number">0.2</span>, <span class="number">0</span>),</span><br><span class="line">(<span class="number">5.0</span>, <span class="number">3.5</span>, <span class="number">1.3</span>, <span class="number">0.3</span>, <span class="number">0</span>),(<span class="number">4.5</span>, <span class="number">2.3</span>, <span class="number">1.3</span>, <span class="number">0.3</span>, <span class="number">0</span>),(<span class="number">4.4</span>, <span class="number">3.2</span>, <span class="number">1.3</span>, <span class="number">0.2</span>, <span class="number">0</span>),(<span class="number">5.0</span>, <span class="number">3.5</span>, <span class="number">1.6</span>, <span class="number">0.6</span>, <span class="number">0</span>),</span><br><span class="line">(<span class="number">5.1</span>, <span class="number">3.8</span>, <span class="number">1.9</span>, <span class="number">0.4</span>, <span class="number">0</span>),(<span class="number">4.8</span>, <span class="number">3.0</span>, <span class="number">1.4</span>, <span class="number">0.3</span>, <span class="number">0</span>),(<span class="number">5.1</span>, <span class="number">3.8</span>, <span class="number">1.6</span>, <span class="number">0.2</span>, <span class="number">0</span>),(<span class="number">4.6</span>, <span class="number">3.2</span>, <span class="number">1.4</span>, <span class="number">0.2</span>, <span class="number">0</span>),</span><br><span class="line">(<span class="number">5.3</span>, <span class="number">3.7</span>, <span class="number">1.5</span>, <span class="number">0.2</span>, <span class="number">0</span>),(<span class="number">5.0</span>, <span class="number">3.3</span>, <span class="number">1.4</span>, <span class="number">0.2</span>, <span class="number">0</span>),(<span class="number">7.0</span>, <span class="number">3.2</span>, <span class="number">4.7</span>, <span class="number">1.4</span>, <span class="number">1</span>),(<span class="number">6.4</span>, <span class="number">3.2</span>, <span class="number">4.5</span>, <span class="number">1.5</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="number">6.9</span>, <span class="number">3.1</span>, <span class="number">4.9</span>, <span class="number">1.5</span>, <span class="number">1</span>),(<span class="number">5.5</span>, <span class="number">2.3</span>, <span class="number">4.0</span>, <span class="number">1.3</span>, <span class="number">1</span>),(<span class="number">6.5</span>, <span class="number">2.8</span>, <span class="number">4.6</span>, <span class="number">1.5</span>, <span class="number">1</span>),(<span class="number">5.7</span>, <span class="number">2.8</span>, <span class="number">4.5</span>, <span class="number">1.3</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="number">6.3</span>, <span class="number">3.3</span>, <span class="number">4.7</span>, <span class="number">1.6</span>, <span class="number">1</span>),(<span class="number">4.9</span>, <span class="number">2.4</span>, <span class="number">3.3</span>, <span class="number">1.0</span>, <span class="number">1</span>),(<span class="number">6.6</span>, <span class="number">2.9</span>, <span class="number">4.6</span>, <span class="number">1.3</span>, <span class="number">1</span>),(<span class="number">5.2</span>, <span class="number">2.7</span>, <span class="number">3.9</span>, <span class="number">1.4</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="number">5.0</span>, <span class="number">2.0</span>, <span class="number">3.5</span>, <span class="number">1.0</span>, <span class="number">1</span>),(<span class="number">5.9</span>, <span class="number">3.0</span>, <span class="number">4.2</span>, <span class="number">1.5</span>, <span class="number">1</span>),(<span class="number">6.0</span>, <span class="number">2.2</span>, <span class="number">4.0</span>, <span class="number">1.0</span>, <span class="number">1</span>),(<span class="number">6.1</span>, <span class="number">2.9</span>, <span class="number">4.7</span>, <span class="number">1.4</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="number">5.6</span>, <span class="number">2.9</span>, <span class="number">3.6</span>, <span class="number">1.3</span>, <span class="number">1</span>),(<span class="number">6.7</span>, <span class="number">3.1</span>, <span class="number">4.4</span>, <span class="number">1.4</span>, <span class="number">1</span>),(<span class="number">5.6</span>, <span class="number">3.0</span>, <span class="number">4.5</span>, <span class="number">1.5</span>, <span class="number">1</span>),(<span class="number">5.8</span>, <span class="number">2.7</span>, <span class="number">4.1</span>, <span class="number">1.0</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="number">6.2</span>, <span class="number">2.2</span>, <span class="number">4.5</span>, <span class="number">1.5</span>, <span class="number">1</span>),(<span class="number">5.6</span>, <span class="number">2.5</span>, <span class="number">3.9</span>, <span class="number">1.1</span>, <span class="number">1</span>),(<span class="number">5.9</span>, <span class="number">3.2</span>, <span class="number">4.8</span>, <span class="number">1.8</span>, <span class="number">1</span>),(<span class="number">6.1</span>, <span class="number">2.8</span>, <span class="number">4.0</span>, <span class="number">1.3</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="number">6.3</span>, <span class="number">2.5</span>, <span class="number">4.9</span>, <span class="number">1.5</span>, <span class="number">1</span>),(<span class="number">6.1</span>, <span class="number">2.8</span>, <span class="number">4.7</span>, <span class="number">1.2</span>, <span class="number">1</span>),(<span class="number">6.4</span>, <span class="number">2.9</span>, <span class="number">4.3</span>, <span class="number">1.3</span>, <span class="number">1</span>),(<span class="number">6.6</span>, <span class="number">3.0</span>, <span class="number">4.4</span>, <span class="number">1.4</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="number">6.8</span>, <span class="number">2.8</span>, <span class="number">4.8</span>, <span class="number">1.4</span>, <span class="number">1</span>),(<span class="number">6.7</span>, <span class="number">3.0</span>, <span class="number">5.0</span>, <span class="number">1.7</span>, <span class="number">1</span>),(<span class="number">6.0</span>, <span class="number">2.9</span>, <span class="number">4.5</span>, <span class="number">1.5</span>, <span class="number">1</span>),(<span class="number">5.7</span>, <span class="number">2.6</span>, <span class="number">3.5</span>, <span class="number">1.0</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="number">5.5</span>, <span class="number">2.4</span>, <span class="number">3.8</span>, <span class="number">1.1</span>, <span class="number">1</span>),(<span class="number">5.5</span>, <span class="number">2.4</span>, <span class="number">3.7</span>, <span class="number">1.0</span>, <span class="number">1</span>),(<span class="number">5.8</span>, <span class="number">2.7</span>, <span class="number">3.9</span>, <span class="number">1.2</span>, <span class="number">1</span>),(<span class="number">6.0</span>, <span class="number">2.7</span>, <span class="number">5.1</span>, <span class="number">1.6</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="number">5.4</span>, <span class="number">3.0</span>, <span class="number">4.5</span>, <span class="number">1.5</span>, <span class="number">1</span>),(<span class="number">6.0</span>, <span class="number">3.4</span>, <span class="number">4.5</span>, <span class="number">1.6</span>, <span class="number">1</span>),(<span class="number">6.7</span>, <span class="number">3.1</span>, <span class="number">4.7</span>, <span class="number">1.5</span>, <span class="number">1</span>),(<span class="number">6.3</span>, <span class="number">2.3</span>, <span class="number">4.4</span>, <span class="number">1.3</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="number">5.6</span>, <span class="number">3.0</span>, <span class="number">4.1</span>, <span class="number">1.3</span>, <span class="number">1</span>),(<span class="number">5.5</span>, <span class="number">2.5</span>, <span class="number">4.0</span>, <span class="number">1.3</span>, <span class="number">1</span>),(<span class="number">5.5</span>, <span class="number">2.6</span>, <span class="number">4.4</span>, <span class="number">1.2</span>, <span class="number">1</span>),(<span class="number">6.1</span>, <span class="number">3.0</span>, <span class="number">4.6</span>, <span class="number">1.4</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="number">5.8</span>, <span class="number">2.6</span>, <span class="number">4.0</span>, <span class="number">1.2</span>, <span class="number">1</span>),(<span class="number">5.0</span>, <span class="number">2.3</span>, <span class="number">3.3</span>, <span class="number">1.0</span>, <span class="number">1</span>),(<span class="number">5.6</span>, <span class="number">2.7</span>, <span class="number">4.2</span>, <span class="number">1.3</span>, <span class="number">1</span>),(<span class="number">5.7</span>, <span class="number">3.0</span>, <span class="number">4.2</span>, <span class="number">1.2</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="number">5.7</span>, <span class="number">2.9</span>, <span class="number">4.2</span>, <span class="number">1.3</span>, <span class="number">1</span>),(<span class="number">6.2</span>, <span class="number">2.9</span>, <span class="number">4.3</span>, <span class="number">1.3</span>, <span class="number">1</span>),(<span class="number">5.1</span>, <span class="number">2.5</span>, <span class="number">3.0</span>, <span class="number">1.1</span>, <span class="number">1</span>),(<span class="number">5.7</span>, <span class="number">2.8</span>, <span class="number">4.1</span>, <span class="number">1.3</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="number">6.3</span>, <span class="number">3.3</span>, <span class="number">6.0</span>, <span class="number">2.5</span>, <span class="number">2</span>),(<span class="number">5.8</span>, <span class="number">2.7</span>, <span class="number">5.1</span>, <span class="number">1.9</span>, <span class="number">2</span>),(<span class="number">7.1</span>, <span class="number">3.0</span>, <span class="number">5.9</span>, <span class="number">2.1</span>, <span class="number">2</span>),(<span class="number">6.3</span>, <span class="number">2.9</span>, <span class="number">5.6</span>, <span class="number">1.8</span>, <span class="number">2</span>),</span><br><span class="line">(<span class="number">6.5</span>, <span class="number">3.0</span>, <span class="number">5.8</span>, <span class="number">2.2</span>, <span class="number">2</span>),(<span class="number">7.6</span>, <span class="number">3.0</span>, <span class="number">6.6</span>, <span class="number">2.1</span>, <span class="number">2</span>),(<span class="number">4.9</span>, <span class="number">2.5</span>, <span class="number">4.5</span>, <span class="number">1.7</span>, <span class="number">2</span>),(<span class="number">7.3</span>, <span class="number">2.9</span>, <span class="number">6.3</span>, <span class="number">1.8</span>, <span class="number">2</span>),</span><br><span class="line">(<span class="number">6.7</span>, <span class="number">2.5</span>, <span class="number">5.8</span>, <span class="number">1.8</span>, <span class="number">2</span>),(<span class="number">7.2</span>, <span class="number">3.6</span>, <span class="number">6.1</span>, <span class="number">2.5</span>, <span class="number">2</span>),(<span class="number">6.5</span>, <span class="number">3.2</span>, <span class="number">5.1</span>, <span class="number">2.0</span>, <span class="number">2</span>),(<span class="number">6.4</span>, <span class="number">2.7</span>, <span class="number">5.3</span>, <span class="number">1.9</span>, <span class="number">2</span>),</span><br><span class="line">(<span class="number">6.8</span>, <span class="number">3.0</span>, <span class="number">5.5</span>, <span class="number">2.1</span>, <span class="number">2</span>),(<span class="number">5.7</span>, <span class="number">2.5</span>, <span class="number">5.0</span>, <span class="number">2.0</span>, <span class="number">2</span>),(<span class="number">5.8</span>, <span class="number">2.8</span>, <span class="number">5.1</span>, <span class="number">2.4</span>, <span class="number">2</span>),(<span class="number">6.4</span>, <span class="number">3.2</span>, <span class="number">5.3</span>, <span class="number">2.3</span>, <span class="number">2</span>),</span><br><span class="line">(<span class="number">6.5</span>, <span class="number">3.0</span>, <span class="number">5.5</span>, <span class="number">1.8</span>, <span class="number">2</span>),(<span class="number">7.7</span>, <span class="number">3.8</span>, <span class="number">6.7</span>, <span class="number">2.2</span>, <span class="number">2</span>),(<span class="number">7.7</span>, <span class="number">2.6</span>, <span class="number">6.9</span>, <span class="number">2.3</span>, <span class="number">2</span>),(<span class="number">6.0</span>, <span class="number">2.2</span>, <span class="number">5.0</span>, <span class="number">1.5</span>, <span class="number">2</span>),</span><br><span class="line">(<span class="number">6.9</span>, <span class="number">3.2</span>, <span class="number">5.7</span>, <span class="number">2.3</span>, <span class="number">2</span>),(<span class="number">5.6</span>, <span class="number">2.8</span>, <span class="number">4.9</span>, <span class="number">2.0</span>, <span class="number">2</span>),(<span class="number">7.7</span>, <span class="number">2.8</span>, <span class="number">6.7</span>, <span class="number">2.0</span>, <span class="number">2</span>),(<span class="number">6.3</span>, <span class="number">2.7</span>, <span class="number">4.9</span>, <span class="number">1.8</span>, <span class="number">2</span>),</span><br><span class="line">(<span class="number">6.7</span>, <span class="number">3.3</span>, <span class="number">5.7</span>, <span class="number">2.1</span>, <span class="number">2</span>),(<span class="number">7.2</span>, <span class="number">3.2</span>, <span class="number">6.0</span>, <span class="number">1.8</span>, <span class="number">2</span>),(<span class="number">6.2</span>, <span class="number">2.8</span>, <span class="number">4.8</span>, <span class="number">1.8</span>, <span class="number">2</span>),(<span class="number">6.1</span>, <span class="number">3.0</span>, <span class="number">4.9</span>, <span class="number">1.8</span>, <span class="number">2</span>),</span><br><span class="line">(<span class="number">6.4</span>, <span class="number">2.8</span>, <span class="number">5.6</span>, <span class="number">2.1</span>, <span class="number">2</span>),(<span class="number">7.2</span>, <span class="number">3.0</span>, <span class="number">5.8</span>, <span class="number">1.6</span>, <span class="number">2</span>),(<span class="number">7.4</span>, <span class="number">2.8</span>, <span class="number">6.1</span>, <span class="number">1.9</span>, <span class="number">2</span>),(<span class="number">7.9</span>, <span class="number">3.8</span>, <span class="number">6.4</span>, <span class="number">2.0</span>, <span class="number">2</span>),</span><br><span class="line">(<span class="number">6.4</span>, <span class="number">2.8</span>, <span class="number">5.6</span>, <span class="number">2.2</span>, <span class="number">2</span>),(<span class="number">6.3</span>, <span class="number">2.8</span>, <span class="number">5.1</span>, <span class="number">1.5</span>, <span class="number">2</span>),(<span class="number">6.1</span>, <span class="number">2.6</span>, <span class="number">5.6</span>, <span class="number">1.4</span>, <span class="number">2</span>),(<span class="number">7.7</span>, <span class="number">3.0</span>, <span class="number">6.1</span>, <span class="number">2.3</span>, <span class="number">2</span>),</span><br><span class="line">(<span class="number">6.3</span>, <span class="number">3.4</span>, <span class="number">5.6</span>, <span class="number">2.4</span>, <span class="number">2</span>),(<span class="number">6.4</span>, <span class="number">3.1</span>, <span class="number">5.5</span>, <span class="number">1.8</span>, <span class="number">2</span>),(<span class="number">6.0</span>, <span class="number">3.0</span>, <span class="number">4.8</span>, <span class="number">1.8</span>, <span class="number">2</span>),(<span class="number">6.9</span>, <span class="number">3.1</span>, <span class="number">5.4</span>, <span class="number">2.1</span>, <span class="number">2</span>),</span><br><span class="line">(<span class="number">6.7</span>, <span class="number">3.1</span>, <span class="number">5.6</span>, <span class="number">2.4</span>, <span class="number">2</span>),(<span class="number">6.9</span>, <span class="number">3.1</span>, <span class="number">5.1</span>, <span class="number">2.3</span>, <span class="number">2</span>),(<span class="number">5.8</span>, <span class="number">2.7</span>, <span class="number">5.1</span>, <span class="number">1.9</span>, <span class="number">2</span>),(<span class="number">6.8</span>, <span class="number">3.2</span>, <span class="number">5.9</span>, <span class="number">2.3</span>, <span class="number">2</span>),</span><br><span class="line">(<span class="number">6.7</span>, <span class="number">3.3</span>, <span class="number">5.7</span>, <span class="number">2.5</span>, <span class="number">2</span>),(<span class="number">6.7</span>, <span class="number">3.0</span>, <span class="number">5.2</span>, <span class="number">2.3</span>, <span class="number">2</span>),(<span class="number">6.3</span>, <span class="number">2.5</span>, <span class="number">5.0</span>, <span class="number">1.9</span>, <span class="number">2</span>),(<span class="number">6.5</span>, <span class="number">3.0</span>, <span class="number">5.2</span>, <span class="number">2.0</span>, <span class="number">2</span>),</span><br><span class="line">(<span class="number">6.2</span>, <span class="number">3.4</span>, <span class="number">5.4</span>, <span class="number">2.3</span>, <span class="number">2</span>),(<span class="number">5.9</span>, <span class="number">3.0</span>, <span class="number">5.1</span>, <span class="number">1.8</span>, <span class="number">2</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><p>执行分类训练操作。<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  SET search_path=<span class="string">&quot;$user&quot;</span>,<span class="keyword">public</span>,madlib;</span><br><span class="line"><span class="type">SET</span> <span class="variable">behavior_compat_options</span> <span class="operator">=</span> <span class="string">&#x27;bind_procedure_searchpath&#x27;</span>;</span><br><span class="line">select madlib.xgboost_sk_Classifier(<span class="string">&#x27;public.iris&#x27;</span>, <span class="string">&#x27;public.iris_model_xgbc&#x27;</span>, <span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;label&#x27;</span>, <span class="string">&#x27;a,b,c,d&#x27;</span>, NULL, </span><br><span class="line">$$&#123;<span class="string">&#x27;booster&#x27;</span>: [<span class="string">&#x27;gbtree&#x27;</span>], <span class="string">&#x27;eta&#x27;</span>:   (<span class="number">0.1</span>, <span class="number">0.9</span>), <span class="string">&#x27;max_depth&#x27;</span>: (<span class="number">5</span>,<span class="number">1</span>), <span class="string">&#x27;objective&#x27;</span>: (<span class="string">&#x27;multi:softmax&#x27;</span>,)&#125;$$,   -- 训练参数组合，如果有多个参数，请用元组或者列表的方式传入</span><br><span class="line">TRUE);                                  -- 是否评估模型，多分类评价为精确度和kappa值；二分类评价指标为precision, recall, fscore和support；回归评价指标为mae, mse, R2squared和rmse</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>xgboost支持多组参数并行训练，比如用例中eta值为0.1和0.9，最大深度为5或者1。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select id, train_timestamp, source_table, y_type, metrics, features, params from iris_model_xgbc;</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>查看模型结果如下。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">   id |        train_timestamp        | source_table | y_type  |          metrics           | features  |                                     params</span><br><span class="line">----+-------------------------------+--------------+---------+----------------------------+-----------+---------------------------------------------------------------------------------</span><br><span class="line">  <span class="number">1</span> | <span class="number">2020</span>-<span class="number">12</span>-<span class="number">14</span> <span class="number">20</span>:<span class="number">15</span>:<span class="number">05.904184</span>+08 | <span class="keyword">public</span>.iris  | integer | &#123;<span class="string">&#x27;acc&#x27;</span>: <span class="number">1.0</span>, <span class="string">&#x27;kappa&#x27;</span>: <span class="number">1.0</span>&#125; | &#123;a,b,c,d&#125; | (<span class="string">&#x27;objective = multi:softmax&#x27;</span>, <span class="string">&#x27;eta = 0.1&#x27;</span>, <span class="string">&#x27;max_depth = 5&#x27;</span>, <span class="string">&#x27;booster = gbtree&#x27;</span>)</span><br><span class="line">  <span class="number">2</span> | <span class="number">2020</span>-<span class="number">12</span>-<span class="number">14</span> <span class="number">20</span>:<span class="number">15</span>:<span class="number">05.904184</span>+08 | <span class="keyword">public</span>.iris  | integer | &#123;<span class="string">&#x27;acc&#x27;</span>: <span class="number">1.0</span>, <span class="string">&#x27;kappa&#x27;</span>: <span class="number">1.0</span>&#125; | &#123;a,b,c,d&#125; | (<span class="string">&#x27;objective = multi:softmax&#x27;</span>, <span class="string">&#x27;eta = 0.1&#x27;</span>, <span class="string">&#x27;max_depth = 1&#x27;</span>, <span class="string">&#x27;booster = gbtree&#x27;</span>)</span><br><span class="line">  <span class="number">3</span> | <span class="number">2020</span>-<span class="number">12</span>-<span class="number">14</span> <span class="number">20</span>:<span class="number">15</span>:<span class="number">05.904184</span>+08 | <span class="keyword">public</span>.iris  | integer | &#123;<span class="string">&#x27;acc&#x27;</span>: <span class="number">1.0</span>, <span class="string">&#x27;kappa&#x27;</span>: <span class="number">1.0</span>&#125; | &#123;a,b,c,d&#125; | (<span class="string">&#x27;objective = multi:softmax&#x27;</span>, <span class="string">&#x27;eta = 0.9&#x27;</span>, <span class="string">&#x27;max_depth = 5&#x27;</span>, <span class="string">&#x27;booster = gbtree&#x27;</span>)</span><br><span class="line">  <span class="number">4</span> | <span class="number">2020</span>-<span class="number">12</span>-<span class="number">14</span> <span class="number">20</span>:<span class="number">15</span>:<span class="number">05.904184</span>+08 | <span class="keyword">public</span>.iris  | integer | &#123;<span class="string">&#x27;acc&#x27;</span>: <span class="number">1.0</span>, <span class="string">&#x27;kappa&#x27;</span>: <span class="number">1.0</span>&#125; | &#123;a,b,c,d&#125; | (<span class="string">&#x27;objective = multi:softmax&#x27;</span>, <span class="string">&#x27;eta = 0.9&#x27;</span>, <span class="string">&#x27;max_depth = 1&#x27;</span>, <span class="string">&#x27;booster = gbtree&#x27;</span>)</span><br><span class="line">(<span class="number">4</span> rows)</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>结果表中，记录着训练时间，特征，结果类型，所用参数等。 在本示例函数输入中，eta选择为2种，max_depth选择为2种，总共4种参数组合。所以在结果中，有4行结果；在metrics列中，记录4种参数组合的训练后的评价结果。用户可以输入多种参数组合，训练后，用户可以选择合适的模型留下。<br>预测结果。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  select madlib.xgboost_sk_predict(<span class="string">&#x27;public.iris&#x27;</span>, <span class="string">&#x27;public.iris_model_xgbc&#x27;</span>, <span class="string">&#x27;public.iris_xgbc_out&#x27;</span>, <span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">select t1.id, prediction, label from iris as t1, iris_xgbc_out as t2 where t1.id = t2.id and prediction &lt;&gt; label;</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>查看结果，预测和训练结果的对比，当前不匹配的行数为0，证明分类准确性较高。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">   id | prediction | label</span><br><span class="line">----+------------+-------</span><br><span class="line">(<span class="number">0</span> rows)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><h4 id="prophet算法"><a href="#prophet算法" class="headerlink" title="prophet算法"></a>prophet算法</h4><p>新增facebook的prophet时序预测算法。下面以时序数据为例，展示prophet算法使用。</p><p>准备数据。<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">  DROP TABLE IF EXISTS ts_data;</span><br><span class="line">CREATE TABLE <span class="title function_">ts_data</span><span class="params">(date date, value <span class="type">float</span>)</span>;</span><br><span class="line">    </span><br><span class="line">INSERT into <span class="title function_">ts_data</span> <span class="params">(date, value)</span> values </span><br><span class="line">(<span class="string">&#x27;2016-11-29 21:20:00&#x27;</span>, <span class="number">5.6</span>),(<span class="string">&#x27;2016-11-29 21:30:00&#x27;</span>, <span class="number">5.2</span>),(<span class="string">&#x27;2016-11-29 21:40:00&#x27;</span>, <span class="number">5.3</span>),(<span class="string">&#x27;2016-11-29 21:50:00&#x27;</span>, <span class="number">5.3</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-29 22:00:00&#x27;</span>, <span class="number">5.1</span>),(<span class="string">&#x27;2016-11-29 22:10:00&#x27;</span>, <span class="number">5.8</span>),(<span class="string">&#x27;2016-11-29 22:20:00&#x27;</span>, <span class="number">5.6</span>),(<span class="string">&#x27;2016-11-29 22:30:00&#x27;</span>, <span class="number">5.4</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-29 22:40:00&#x27;</span>, <span class="number">5.4</span>),(<span class="string">&#x27;2016-11-29 22:50:00&#x27;</span>, <span class="number">5.1</span>),(<span class="string">&#x27;2016-11-29 23:00:00&#x27;</span>, <span class="number">5.2</span>),(<span class="string">&#x27;2016-11-29 23:10:00&#x27;</span>, <span class="number">5.9</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-29 23:20:00&#x27;</span>, <span class="number">5.9</span>),(<span class="string">&#x27;2016-11-29 23:30:00&#x27;</span>, <span class="number">5.1</span>),(<span class="string">&#x27;2016-11-29 23:40:00&#x27;</span>, <span class="number">5.8</span>),(<span class="string">&#x27;2016-11-29 23:50:00&#x27;</span>, <span class="number">6.0</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-30 00:00:00&#x27;</span>, <span class="number">5.9</span>),(<span class="string">&#x27;2016-11-30 00:10:00&#x27;</span>, <span class="number">5.3</span>),(<span class="string">&#x27;2016-11-30 00:20:00&#x27;</span>, <span class="number">5.4</span>),(<span class="string">&#x27;2016-11-30 00:30:00&#x27;</span>, <span class="number">5.1</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-30 00:40:00&#x27;</span>, <span class="number">5.6</span>),(<span class="string">&#x27;2016-11-30 00:50:00&#x27;</span>, <span class="number">5.7</span>),(<span class="string">&#x27;2016-11-30 01:00:00&#x27;</span>, <span class="number">5.8</span>),(<span class="string">&#x27;2016-11-30 01:10:00&#x27;</span>, <span class="number">5.4</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-30 01:20:00&#x27;</span>, <span class="number">5.8</span>),(<span class="string">&#x27;2016-11-30 01:30:00&#x27;</span>, <span class="number">5.1</span>),(<span class="string">&#x27;2016-11-30 01:40:00&#x27;</span>, <span class="number">5.6</span>),(<span class="string">&#x27;2016-11-30 01:50:00&#x27;</span>, <span class="number">5.6</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-30 02:00:00&#x27;</span>, <span class="number">5.6</span>),(<span class="string">&#x27;2016-11-30 02:10:00&#x27;</span>, <span class="number">5.9</span>),(<span class="string">&#x27;2016-11-30 02:20:00&#x27;</span>, <span class="number">5.7</span>),(<span class="string">&#x27;2016-11-30 02:30:00&#x27;</span>, <span class="number">5.4</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-30 02:40:00&#x27;</span>, <span class="number">5.6</span>),(<span class="string">&#x27;2016-11-30 02:50:00&#x27;</span>, <span class="number">5.4</span>),(<span class="string">&#x27;2016-11-30 03:00:00&#x27;</span>, <span class="number">5.1</span>),(<span class="string">&#x27;2016-11-30 03:10:00&#x27;</span>, <span class="number">5.0</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-30 03:20:00&#x27;</span>, <span class="number">5.9</span>),(<span class="string">&#x27;2016-11-30 03:30:00&#x27;</span>, <span class="number">5.8</span>),(<span class="string">&#x27;2016-11-30 03:40:00&#x27;</span>, <span class="number">5.4</span>),(<span class="string">&#x27;2016-11-30 03:50:00&#x27;</span>, <span class="number">5.7</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-30 04:00:00&#x27;</span>, <span class="number">5.6</span>),(<span class="string">&#x27;2016-11-30 04:10:00&#x27;</span>, <span class="number">5.9</span>),(<span class="string">&#x27;2016-11-30 04:20:00&#x27;</span>, <span class="number">5.1</span>),(<span class="string">&#x27;2016-11-30 04:30:00&#x27;</span>, <span class="number">5.8</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-30 04:40:00&#x27;</span>, <span class="number">5.5</span>),(<span class="string">&#x27;2016-11-30 04:50:00&#x27;</span>, <span class="number">5.1</span>),(<span class="string">&#x27;2016-11-30 05:00:00&#x27;</span>, <span class="number">5.8</span>),(<span class="string">&#x27;2016-11-30 05:10:00&#x27;</span>, <span class="number">5.5</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-30 05:20:00&#x27;</span>, <span class="number">5.7</span>),(<span class="string">&#x27;2016-11-30 05:30:00&#x27;</span>, <span class="number">5.2</span>),(<span class="string">&#x27;2016-11-30 05:40:00&#x27;</span>, <span class="number">5.7</span>),(<span class="string">&#x27;2016-11-30 05:50:00&#x27;</span>, <span class="number">6.0</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-30 06:00:00&#x27;</span>, <span class="number">5.8</span>),(<span class="string">&#x27;2016-11-30 06:10:00&#x27;</span>, <span class="number">5.6</span>),(<span class="string">&#x27;2016-11-30 06:20:00&#x27;</span>, <span class="number">5.2</span>),(<span class="string">&#x27;2016-11-30 06:30:00&#x27;</span>, <span class="number">5.8</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-30 06:40:00&#x27;</span>, <span class="number">5.3</span>),(<span class="string">&#x27;2016-11-30 06:50:00&#x27;</span>, <span class="number">5.4</span>),(<span class="string">&#x27;2016-11-30 07:00:00&#x27;</span>, <span class="number">5.8</span>),(<span class="string">&#x27;2016-11-30 07:10:00&#x27;</span>, <span class="number">5.2</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-30 07:20:00&#x27;</span>, <span class="number">5.3</span>),(<span class="string">&#x27;2016-11-30 07:30:00&#x27;</span>, <span class="number">5.3</span>),(<span class="string">&#x27;2016-11-30 07:40:00&#x27;</span>, <span class="number">5.8</span>),(<span class="string">&#x27;2016-11-30 07:50:00&#x27;</span>, <span class="number">5.9</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-30 08:00:00&#x27;</span>, <span class="number">5.6</span>),(<span class="string">&#x27;2016-11-30 08:10:00&#x27;</span>, <span class="number">5.2</span>),(<span class="string">&#x27;2016-11-30 08:20:00&#x27;</span>, <span class="number">5.4</span>),(<span class="string">&#x27;2016-11-30 08:30:00&#x27;</span>, <span class="number">5.6</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-30 08:40:00&#x27;</span>, <span class="number">6.0</span>),(<span class="string">&#x27;2016-11-30 08:50:00&#x27;</span>, <span class="number">5.4</span>),(<span class="string">&#x27;2016-11-30 09:00:00&#x27;</span>, <span class="number">6.0</span>),(<span class="string">&#x27;2016-11-30 09:10:00&#x27;</span>, <span class="number">5.1</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-30 09:20:00&#x27;</span>, <span class="number">5.1</span>),(<span class="string">&#x27;2016-11-30 09:30:00&#x27;</span>, <span class="number">5.5</span>),(<span class="string">&#x27;2016-11-30 09:40:00&#x27;</span>, <span class="number">5.6</span>),(<span class="string">&#x27;2016-11-30 09:50:00&#x27;</span>, <span class="number">5.0</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-30 10:00:00&#x27;</span>, <span class="number">5.1</span>),(<span class="string">&#x27;2016-11-30 10:10:00&#x27;</span>, <span class="number">5.7</span>),(<span class="string">&#x27;2016-11-30 10:20:00&#x27;</span>, <span class="number">5.4</span>),(<span class="string">&#x27;2016-11-30 10:30:00&#x27;</span>, <span class="number">5.4</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-30 10:40:00&#x27;</span>, <span class="number">5.7</span>),(<span class="string">&#x27;2016-11-30 10:50:00&#x27;</span>, <span class="number">5.2</span>),(<span class="string">&#x27;2016-11-30 11:00:00&#x27;</span>, <span class="number">5.4</span>),(<span class="string">&#x27;2016-11-30 11:10:00&#x27;</span>, <span class="number">5.3</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-30 11:20:00&#x27;</span>, <span class="number">5.6</span>),(<span class="string">&#x27;2016-11-30 11:30:00&#x27;</span>, <span class="number">5.0</span>),(<span class="string">&#x27;2016-11-30 11:40:00&#x27;</span>, <span class="number">5.2</span>),(<span class="string">&#x27;2016-11-30 11:50:00&#x27;</span>, <span class="number">5.2</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-30 12:00:00&#x27;</span>, <span class="number">5.5</span>),(<span class="string">&#x27;2016-11-30 12:10:00&#x27;</span>, <span class="number">5.1</span>),(<span class="string">&#x27;2016-11-30 12:20:00&#x27;</span>, <span class="number">5.7</span>),(<span class="string">&#x27;2016-11-30 12:30:00&#x27;</span>, <span class="number">5.4</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-30 12:40:00&#x27;</span>, <span class="number">5.2</span>),(<span class="string">&#x27;2016-11-30 12:50:00&#x27;</span>, <span class="number">5.5</span>),(<span class="string">&#x27;2016-11-30 13:00:00&#x27;</span>, <span class="number">5.0</span>),(<span class="string">&#x27;2016-11-30 13:10:00&#x27;</span>, <span class="number">5.5</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-30 13:20:00&#x27;</span>, <span class="number">5.6</span>),(<span class="string">&#x27;2016-11-30 13:30:00&#x27;</span>, <span class="number">5.3</span>),(<span class="string">&#x27;2016-11-30 13:40:00&#x27;</span>, <span class="number">5.5</span>),(<span class="string">&#x27;2016-11-30 13:50:00&#x27;</span>, <span class="number">5.9</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-30 14:00:00&#x27;</span>, <span class="number">10.9</span>),(<span class="string">&#x27;2016-11-30 14:10:00&#x27;</span>, <span class="number">10.6</span>),(<span class="string">&#x27;2016-11-30 14:20:00&#x27;</span>, <span class="number">10.3</span>),(<span class="string">&#x27;2016-11-30 14:30:00&#x27;</span>, <span class="number">11.0</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-30 14:40:00&#x27;</span>, <span class="number">10.0</span>),(<span class="string">&#x27;2016-11-30 14:50:00&#x27;</span>, <span class="number">10.1</span>),(<span class="string">&#x27;2016-11-30 15:00:00&#x27;</span>, <span class="number">10.2</span>),(<span class="string">&#x27;2016-11-30 15:10:00&#x27;</span>, <span class="number">10.2</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-30 15:20:00&#x27;</span>, <span class="number">10.3</span>),(<span class="string">&#x27;2016-11-30 15:30:00&#x27;</span>, <span class="number">10.1</span>),(<span class="string">&#x27;2016-11-30 15:40:00&#x27;</span>, <span class="number">10.9</span>),(<span class="string">&#x27;2016-11-30 15:50:00&#x27;</span>, <span class="number">10.1</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-30 16:00:00&#x27;</span>, <span class="number">11.0</span>),(<span class="string">&#x27;2016-11-30 16:10:00&#x27;</span>, <span class="number">10.2</span>),(<span class="string">&#x27;2016-11-30 16:20:00&#x27;</span>, <span class="number">10.7</span>),(<span class="string">&#x27;2016-11-30 16:30:00&#x27;</span>, <span class="number">10.2</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-30 16:40:00&#x27;</span>, <span class="number">10.2</span>),(<span class="string">&#x27;2016-11-30 16:50:00&#x27;</span>, <span class="number">10.2</span>),(<span class="string">&#x27;2016-11-30 17:00:00&#x27;</span>, <span class="number">10.8</span>),(<span class="string">&#x27;2016-11-30 17:10:00&#x27;</span>, <span class="number">10.6</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-30 17:20:00&#x27;</span>, <span class="number">10.5</span>),(<span class="string">&#x27;2016-11-30 17:30:00&#x27;</span>, <span class="number">10.7</span>),(<span class="string">&#x27;2016-11-30 17:40:00&#x27;</span>, <span class="number">10.9</span>),(<span class="string">&#x27;2016-11-30 17:50:00&#x27;</span>, <span class="number">10.9</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-30 18:00:00&#x27;</span>, <span class="number">10.1</span>),(<span class="string">&#x27;2016-11-30 18:10:00&#x27;</span>, <span class="number">10.3</span>),(<span class="string">&#x27;2016-11-30 18:20:00&#x27;</span>, <span class="number">10.1</span>),(<span class="string">&#x27;2016-11-30 18:30:00&#x27;</span>, <span class="number">10.6</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-30 18:40:00&#x27;</span>, <span class="number">10.3</span>),(<span class="string">&#x27;2016-11-30 18:50:00&#x27;</span>, <span class="number">10.8</span>),(<span class="string">&#x27;2016-11-30 19:00:00&#x27;</span>, <span class="number">10.9</span>),(<span class="string">&#x27;2016-11-30 19:10:00&#x27;</span>, <span class="number">10.8</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-30 19:20:00&#x27;</span>, <span class="number">10.6</span>),(<span class="string">&#x27;2016-11-30 19:30:00&#x27;</span>, <span class="number">11.0</span>),(<span class="string">&#x27;2016-11-30 19:40:00&#x27;</span>, <span class="number">10.3</span>),(<span class="string">&#x27;2016-11-30 19:50:00&#x27;</span>, <span class="number">10.9</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-30 20:00:00&#x27;</span>, <span class="number">10.6</span>),(<span class="string">&#x27;2016-11-30 20:10:00&#x27;</span>, <span class="number">10.6</span>),(<span class="string">&#x27;2016-11-30 20:20:00&#x27;</span>, <span class="number">10.5</span>),(<span class="string">&#x27;2016-11-30 20:30:00&#x27;</span>, <span class="number">10.4</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-30 20:40:00&#x27;</span>, <span class="number">10.9</span>),(<span class="string">&#x27;2016-11-30 20:50:00&#x27;</span>, <span class="number">10.9</span>),(<span class="string">&#x27;2016-11-30 21:00:00&#x27;</span>, <span class="number">10.7</span>),(<span class="string">&#x27;2016-11-30 21:10:00&#x27;</span>, <span class="number">10.6</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-30 21:20:00&#x27;</span>, <span class="number">10.5</span>),(<span class="string">&#x27;2016-11-30 21:30:00&#x27;</span>, <span class="number">10.8</span>),(<span class="string">&#x27;2016-11-30 21:40:00&#x27;</span>, <span class="number">10.4</span>),(<span class="string">&#x27;2016-11-30 21:50:00&#x27;</span>, <span class="number">10.0</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-30 22:00:00&#x27;</span>, <span class="number">10.6</span>),(<span class="string">&#x27;2016-11-30 22:10:00&#x27;</span>, <span class="number">10.6</span>),(<span class="string">&#x27;2016-11-30 22:20:00&#x27;</span>, <span class="number">10.6</span>),(<span class="string">&#x27;2016-11-30 22:30:00&#x27;</span>, <span class="number">10.1</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-30 22:40:00&#x27;</span>, <span class="number">10.4</span>),(<span class="string">&#x27;2016-11-30 22:50:00&#x27;</span>, <span class="number">10.8</span>),(<span class="string">&#x27;2016-11-30 23:00:00&#x27;</span>, <span class="number">10.4</span>),(<span class="string">&#x27;2016-11-30 23:10:00&#x27;</span>, <span class="number">10.6</span>),</span><br><span class="line">(<span class="string">&#x27;2016-11-30 23:20:00&#x27;</span>, <span class="number">10.1</span>),(<span class="string">&#x27;2016-11-30 23:30:00&#x27;</span>, <span class="number">10.2</span>),(<span class="string">&#x27;2016-11-30 23:40:00&#x27;</span>, <span class="number">10.6</span>),(<span class="string">&#x27;2016-11-30 23:50:00&#x27;</span>, <span class="number">10.8</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-01 00:00:00&#x27;</span>, <span class="number">10.6</span>),(<span class="string">&#x27;2016-12-01 00:10:00&#x27;</span>, <span class="number">10.2</span>),(<span class="string">&#x27;2016-12-01 00:20:00&#x27;</span>, <span class="number">10.9</span>),(<span class="string">&#x27;2016-12-01 00:30:00&#x27;</span>, <span class="number">10.3</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-01 00:40:00&#x27;</span>, <span class="number">10.3</span>),(<span class="string">&#x27;2016-12-01 00:50:00&#x27;</span>, <span class="number">10.1</span>),(<span class="string">&#x27;2016-12-01 01:00:00&#x27;</span>, <span class="number">10.7</span>),(<span class="string">&#x27;2016-12-01 01:10:00&#x27;</span>, <span class="number">10.5</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-01 01:20:00&#x27;</span>, <span class="number">10.4</span>),(<span class="string">&#x27;2016-12-01 01:30:00&#x27;</span>, <span class="number">10.7</span>),(<span class="string">&#x27;2016-12-01 01:40:00&#x27;</span>, <span class="number">10.5</span>),(<span class="string">&#x27;2016-12-01 01:50:00&#x27;</span>, <span class="number">10.7</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-01 02:00:00&#x27;</span>, <span class="number">10.8</span>),(<span class="string">&#x27;2016-12-01 02:10:00&#x27;</span>, <span class="number">10.9</span>),(<span class="string">&#x27;2016-12-01 02:20:00&#x27;</span>, <span class="number">10.9</span>),(<span class="string">&#x27;2016-12-01 02:30:00&#x27;</span>, <span class="number">10.1</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-01 02:40:00&#x27;</span>, <span class="number">10.4</span>),(<span class="string">&#x27;2016-12-01 02:50:00&#x27;</span>, <span class="number">10.7</span>),(<span class="string">&#x27;2016-12-01 03:00:00&#x27;</span>, <span class="number">10.7</span>),(<span class="string">&#x27;2016-12-01 03:10:00&#x27;</span>, <span class="number">10.5</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-01 03:20:00&#x27;</span>, <span class="number">10.2</span>),(<span class="string">&#x27;2016-12-01 03:30:00&#x27;</span>, <span class="number">10.2</span>),(<span class="string">&#x27;2016-12-01 03:40:00&#x27;</span>, <span class="number">10.8</span>),(<span class="string">&#x27;2016-12-01 03:50:00&#x27;</span>, <span class="number">10.2</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-01 04:00:00&#x27;</span>, <span class="number">10.9</span>),(<span class="string">&#x27;2016-12-01 04:10:00&#x27;</span>, <span class="number">10.4</span>),(<span class="string">&#x27;2016-12-01 04:20:00&#x27;</span>, <span class="number">10.6</span>),(<span class="string">&#x27;2016-12-01 04:30:00&#x27;</span>, <span class="number">11.0</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-01 04:40:00&#x27;</span>, <span class="number">10.4</span>),(<span class="string">&#x27;2016-12-01 04:50:00&#x27;</span>, <span class="number">10.3</span>),(<span class="string">&#x27;2016-12-01 05:00:00&#x27;</span>, <span class="number">10.7</span>),(<span class="string">&#x27;2016-12-01 05:10:00&#x27;</span>, <span class="number">10.6</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-01 05:20:00&#x27;</span>, <span class="number">10.9</span>),(<span class="string">&#x27;2016-12-01 05:30:00&#x27;</span>, <span class="number">11.0</span>),(<span class="string">&#x27;2016-12-01 05:40:00&#x27;</span>, <span class="number">10.9</span>),(<span class="string">&#x27;2016-12-01 05:50:00&#x27;</span>, <span class="number">10.0</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-01 06:00:00&#x27;</span>, <span class="number">10.8</span>),(<span class="string">&#x27;2016-12-01 06:10:00&#x27;</span>, <span class="number">10.0</span>),(<span class="string">&#x27;2016-12-01 06:20:00&#x27;</span>, <span class="number">10.1</span>),(<span class="string">&#x27;2016-12-01 06:30:00&#x27;</span>, <span class="number">10.5</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-01 06:40:00&#x27;</span>, <span class="number">15.5</span>),(<span class="string">&#x27;2016-12-01 06:50:00&#x27;</span>, <span class="number">15.7</span>),(<span class="string">&#x27;2016-12-01 07:00:00&#x27;</span>, <span class="number">15.1</span>),(<span class="string">&#x27;2016-12-01 07:10:00&#x27;</span>, <span class="number">15.6</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-01 07:20:00&#x27;</span>, <span class="number">15.5</span>),(<span class="string">&#x27;2016-12-01 07:30:00&#x27;</span>, <span class="number">15.4</span>),(<span class="string">&#x27;2016-12-01 07:40:00&#x27;</span>, <span class="number">15.7</span>),(<span class="string">&#x27;2016-12-01 07:50:00&#x27;</span>, <span class="number">15.6</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-01 08:00:00&#x27;</span>, <span class="number">15.3</span>),(<span class="string">&#x27;2016-12-01 08:10:00&#x27;</span>, <span class="number">15.6</span>),(<span class="string">&#x27;2016-12-01 08:20:00&#x27;</span>, <span class="number">15.1</span>),(<span class="string">&#x27;2016-12-01 08:30:00&#x27;</span>, <span class="number">15.6</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-01 08:40:00&#x27;</span>, <span class="number">15.9</span>),(<span class="string">&#x27;2016-12-01 08:50:00&#x27;</span>, <span class="number">16.0</span>),(<span class="string">&#x27;2016-12-01 09:00:00&#x27;</span>, <span class="number">15.4</span>),(<span class="string">&#x27;2016-12-01 09:10:00&#x27;</span>, <span class="number">15.0</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-01 09:20:00&#x27;</span>, <span class="number">15.0</span>),(<span class="string">&#x27;2016-12-01 09:30:00&#x27;</span>, <span class="number">15.4</span>),(<span class="string">&#x27;2016-12-01 09:40:00&#x27;</span>, <span class="number">15.9</span>),(<span class="string">&#x27;2016-12-01 09:50:00&#x27;</span>, <span class="number">15.6</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-01 10:00:00&#x27;</span>, <span class="number">15.7</span>),(<span class="string">&#x27;2016-12-01 10:10:00&#x27;</span>, <span class="number">15.4</span>),(<span class="string">&#x27;2016-12-01 10:20:00&#x27;</span>, <span class="number">15.2</span>),(<span class="string">&#x27;2016-12-01 10:30:00&#x27;</span>, <span class="number">15.2</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-01 10:40:00&#x27;</span>, <span class="number">15.8</span>),(<span class="string">&#x27;2016-12-01 10:50:00&#x27;</span>, <span class="number">15.4</span>),(<span class="string">&#x27;2016-12-01 11:00:00&#x27;</span>, <span class="number">16.0</span>),(<span class="string">&#x27;2016-12-01 11:10:00&#x27;</span>, <span class="number">15.9</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-01 11:20:00&#x27;</span>, <span class="number">15.1</span>),(<span class="string">&#x27;2016-12-01 11:30:00&#x27;</span>, <span class="number">15.0</span>),(<span class="string">&#x27;2016-12-01 11:40:00&#x27;</span>, <span class="number">15.0</span>),(<span class="string">&#x27;2016-12-01 11:50:00&#x27;</span>, <span class="number">15.4</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-01 12:00:00&#x27;</span>, <span class="number">15.5</span>),(<span class="string">&#x27;2016-12-01 12:10:00&#x27;</span>, <span class="number">15.3</span>),(<span class="string">&#x27;2016-12-01 12:20:00&#x27;</span>, <span class="number">16.0</span>),(<span class="string">&#x27;2016-12-01 12:30:00&#x27;</span>, <span class="number">15.1</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-01 12:40:00&#x27;</span>, <span class="number">15.5</span>),(<span class="string">&#x27;2016-12-01 12:50:00&#x27;</span>, <span class="number">16.0</span>),(<span class="string">&#x27;2016-12-01 13:00:00&#x27;</span>, <span class="number">15.7</span>),(<span class="string">&#x27;2016-12-01 13:10:00&#x27;</span>, <span class="number">15.9</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-01 13:20:00&#x27;</span>, <span class="number">15.4</span>),(<span class="string">&#x27;2016-12-01 13:30:00&#x27;</span>, <span class="number">15.3</span>),(<span class="string">&#x27;2016-12-01 13:40:00&#x27;</span>, <span class="number">15.9</span>),(<span class="string">&#x27;2016-12-01 13:50:00&#x27;</span>, <span class="number">15.8</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-01 14:00:00&#x27;</span>, <span class="number">15.4</span>),(<span class="string">&#x27;2016-12-01 14:10:00&#x27;</span>, <span class="number">15.9</span>),(<span class="string">&#x27;2016-12-01 14:20:00&#x27;</span>, <span class="number">15.3</span>),(<span class="string">&#x27;2016-12-01 14:30:00&#x27;</span>, <span class="number">16.0</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-01 14:40:00&#x27;</span>, <span class="number">15.5</span>),(<span class="string">&#x27;2016-12-01 14:50:00&#x27;</span>, <span class="number">15.0</span>),(<span class="string">&#x27;2016-12-01 15:00:00&#x27;</span>, <span class="number">15.1</span>),(<span class="string">&#x27;2016-12-01 15:10:00&#x27;</span>, <span class="number">16.0</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-01 15:20:00&#x27;</span>, <span class="number">15.8</span>),(<span class="string">&#x27;2016-12-01 15:30:00&#x27;</span>, <span class="number">15.9</span>),(<span class="string">&#x27;2016-12-01 15:40:00&#x27;</span>, <span class="number">15.4</span>),(<span class="string">&#x27;2016-12-01 15:50:00&#x27;</span>, <span class="number">15.1</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-01 16:00:00&#x27;</span>, <span class="number">15.8</span>),(<span class="string">&#x27;2016-12-01 16:10:00&#x27;</span>, <span class="number">15.2</span>),(<span class="string">&#x27;2016-12-01 16:20:00&#x27;</span>, <span class="number">15.4</span>),(<span class="string">&#x27;2016-12-01 16:30:00&#x27;</span>, <span class="number">15.8</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-01 16:40:00&#x27;</span>, <span class="number">15.8</span>),(<span class="string">&#x27;2016-12-01 16:50:00&#x27;</span>, <span class="number">15.1</span>),(<span class="string">&#x27;2016-12-01 17:00:00&#x27;</span>, <span class="number">15.3</span>),(<span class="string">&#x27;2016-12-01 17:10:00&#x27;</span>, <span class="number">15.6</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-01 17:20:00&#x27;</span>, <span class="number">15.3</span>),(<span class="string">&#x27;2016-12-01 17:30:00&#x27;</span>, <span class="number">15.8</span>),(<span class="string">&#x27;2016-12-01 17:40:00&#x27;</span>, <span class="number">15.0</span>),(<span class="string">&#x27;2016-12-01 17:50:00&#x27;</span>, <span class="number">15.3</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-01 18:00:00&#x27;</span>, <span class="number">15.5</span>),(<span class="string">&#x27;2016-12-01 18:10:00&#x27;</span>, <span class="number">15.4</span>),(<span class="string">&#x27;2016-12-01 18:20:00&#x27;</span>, <span class="number">15.3</span>),(<span class="string">&#x27;2016-12-01 18:30:00&#x27;</span>, <span class="number">15.8</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-01 18:40:00&#x27;</span>, <span class="number">15.2</span>),(<span class="string">&#x27;2016-12-01 18:50:00&#x27;</span>, <span class="number">15.9</span>),(<span class="string">&#x27;2016-12-01 19:00:00&#x27;</span>, <span class="number">15.4</span>),(<span class="string">&#x27;2016-12-01 19:10:00&#x27;</span>, <span class="number">15.3</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-01 19:20:00&#x27;</span>, <span class="number">15.1</span>),(<span class="string">&#x27;2016-12-01 19:30:00&#x27;</span>, <span class="number">15.3</span>),(<span class="string">&#x27;2016-12-01 19:40:00&#x27;</span>, <span class="number">15.9</span>),(<span class="string">&#x27;2016-12-01 19:50:00&#x27;</span>, <span class="number">15.3</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-01 20:00:00&#x27;</span>, <span class="number">15.3</span>),(<span class="string">&#x27;2016-12-01 20:10:00&#x27;</span>, <span class="number">15.2</span>),(<span class="string">&#x27;2016-12-01 20:20:00&#x27;</span>, <span class="number">15.0</span>),(<span class="string">&#x27;2016-12-01 20:30:00&#x27;</span>, <span class="number">15.3</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-01 20:40:00&#x27;</span>, <span class="number">15.1</span>),(<span class="string">&#x27;2016-12-01 20:50:00&#x27;</span>, <span class="number">15.1</span>),(<span class="string">&#x27;2016-12-01 21:00:00&#x27;</span>, <span class="number">15.6</span>),(<span class="string">&#x27;2016-12-01 21:10:00&#x27;</span>, <span class="number">15.8</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-01 21:20:00&#x27;</span>, <span class="number">15.4</span>),(<span class="string">&#x27;2016-12-01 21:30:00&#x27;</span>, <span class="number">15.2</span>),(<span class="string">&#x27;2016-12-01 21:40:00&#x27;</span>, <span class="number">16.0</span>),(<span class="string">&#x27;2016-12-01 21:50:00&#x27;</span>, <span class="number">15.5</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-01 22:00:00&#x27;</span>, <span class="number">15.4</span>),(<span class="string">&#x27;2016-12-01 22:10:00&#x27;</span>, <span class="number">15.7</span>),(<span class="string">&#x27;2016-12-01 22:20:00&#x27;</span>, <span class="number">15.3</span>),(<span class="string">&#x27;2016-12-01 22:30:00&#x27;</span>, <span class="number">15.9</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-01 22:40:00&#x27;</span>, <span class="number">15.9</span>),(<span class="string">&#x27;2016-12-01 22:50:00&#x27;</span>, <span class="number">15.2</span>),(<span class="string">&#x27;2016-12-01 23:00:00&#x27;</span>, <span class="number">15.8</span>),(<span class="string">&#x27;2016-12-01 23:10:00&#x27;</span>, <span class="number">15.9</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-01 23:20:00&#x27;</span>, <span class="number">20.9</span>),(<span class="string">&#x27;2016-12-01 23:30:00&#x27;</span>, <span class="number">20.4</span>),(<span class="string">&#x27;2016-12-01 23:40:00&#x27;</span>, <span class="number">20.3</span>),(<span class="string">&#x27;2016-12-01 23:50:00&#x27;</span>, <span class="number">20.1</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-02 00:00:00&#x27;</span>, <span class="number">20.7</span>),(<span class="string">&#x27;2016-12-02 00:10:00&#x27;</span>, <span class="number">20.7</span>),(<span class="string">&#x27;2016-12-02 00:20:00&#x27;</span>, <span class="number">20.5</span>),(<span class="string">&#x27;2016-12-02 00:30:00&#x27;</span>, <span class="number">20.4</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-02 00:40:00&#x27;</span>, <span class="number">20.4</span>),(<span class="string">&#x27;2016-12-02 00:50:00&#x27;</span>, <span class="number">20.1</span>),(<span class="string">&#x27;2016-12-02 01:00:00&#x27;</span>, <span class="number">20.2</span>),(<span class="string">&#x27;2016-12-02 01:10:00&#x27;</span>, <span class="number">20.9</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-02 01:20:00&#x27;</span>, <span class="number">20.6</span>),(<span class="string">&#x27;2016-12-02 01:30:00&#x27;</span>, <span class="number">20.0</span>),(<span class="string">&#x27;2016-12-02 01:40:00&#x27;</span>, <span class="number">20.4</span>),(<span class="string">&#x27;2016-12-02 01:50:00&#x27;</span>, <span class="number">20.2</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-02 02:00:00&#x27;</span>, <span class="number">20.6</span>),(<span class="string">&#x27;2016-12-02 02:10:00&#x27;</span>, <span class="number">20.4</span>),(<span class="string">&#x27;2016-12-02 02:20:00&#x27;</span>, <span class="number">20.5</span>),(<span class="string">&#x27;2016-12-02 02:30:00&#x27;</span>, <span class="number">20.4</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-02 02:40:00&#x27;</span>, <span class="number">20.5</span>),(<span class="string">&#x27;2016-12-02 02:50:00&#x27;</span>, <span class="number">20.7</span>),(<span class="string">&#x27;2016-12-02 03:00:00&#x27;</span>, <span class="number">20.2</span>),(<span class="string">&#x27;2016-12-02 03:10:00&#x27;</span>, <span class="number">20.2</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-02 03:20:00&#x27;</span>, <span class="number">20.1</span>),(<span class="string">&#x27;2016-12-02 03:30:00&#x27;</span>, <span class="number">20.5</span>),(<span class="string">&#x27;2016-12-02 03:40:00&#x27;</span>, <span class="number">20.5</span>),(<span class="string">&#x27;2016-12-02 03:50:00&#x27;</span>, <span class="number">20.0</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-02 04:00:00&#x27;</span>, <span class="number">20.7</span>),(<span class="string">&#x27;2016-12-02 04:10:00&#x27;</span>, <span class="number">20.8</span>),(<span class="string">&#x27;2016-12-02 04:20:00&#x27;</span>, <span class="number">20.6</span>),(<span class="string">&#x27;2016-12-02 04:30:00&#x27;</span>, <span class="number">20.4</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-02 04:40:00&#x27;</span>, <span class="number">20.5</span>),(<span class="string">&#x27;2016-12-02 04:50:00&#x27;</span>, <span class="number">20.8</span>),(<span class="string">&#x27;2016-12-02 05:00:00&#x27;</span>, <span class="number">20.1</span>),(<span class="string">&#x27;2016-12-02 05:10:00&#x27;</span>, <span class="number">20.9</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-02 05:20:00&#x27;</span>, <span class="number">20.5</span>),(<span class="string">&#x27;2016-12-02 05:30:00&#x27;</span>, <span class="number">20.4</span>),(<span class="string">&#x27;2016-12-02 05:40:00&#x27;</span>, <span class="number">20.2</span>),(<span class="string">&#x27;2016-12-02 05:50:00&#x27;</span>, <span class="number">20.4</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-02 06:00:00&#x27;</span>, <span class="number">20.8</span>),(<span class="string">&#x27;2016-12-02 06:10:00&#x27;</span>, <span class="number">20.7</span>),(<span class="string">&#x27;2016-12-02 06:20:00&#x27;</span>, <span class="number">20.9</span>),(<span class="string">&#x27;2016-12-02 06:30:00&#x27;</span>, <span class="number">20.1</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-02 06:40:00&#x27;</span>, <span class="number">20.3</span>),(<span class="string">&#x27;2016-12-02 06:50:00&#x27;</span>, <span class="number">20.2</span>),(<span class="string">&#x27;2016-12-02 07:00:00&#x27;</span>, <span class="number">20.4</span>),(<span class="string">&#x27;2016-12-02 07:10:00&#x27;</span>, <span class="number">20.7</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-02 07:20:00&#x27;</span>, <span class="number">20.4</span>),(<span class="string">&#x27;2016-12-02 07:30:00&#x27;</span>, <span class="number">20.8</span>),(<span class="string">&#x27;2016-12-02 07:40:00&#x27;</span>, <span class="number">20.8</span>),(<span class="string">&#x27;2016-12-02 07:50:00&#x27;</span>, <span class="number">20.1</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-02 08:00:00&#x27;</span>, <span class="number">20.3</span>),(<span class="string">&#x27;2016-12-02 08:10:00&#x27;</span>, <span class="number">20.7</span>),(<span class="string">&#x27;2016-12-02 08:20:00&#x27;</span>, <span class="number">20.9</span>),(<span class="string">&#x27;2016-12-02 08:30:00&#x27;</span>, <span class="number">21.0</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-02 08:40:00&#x27;</span>, <span class="number">20.2</span>),(<span class="string">&#x27;2016-12-02 08:50:00&#x27;</span>, <span class="number">20.5</span>),(<span class="string">&#x27;2016-12-02 09:00:00&#x27;</span>, <span class="number">20.2</span>),(<span class="string">&#x27;2016-12-02 09:10:00&#x27;</span>, <span class="number">20.8</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-02 09:20:00&#x27;</span>, <span class="number">20.9</span>),(<span class="string">&#x27;2016-12-02 09:30:00&#x27;</span>, <span class="number">20.5</span>),(<span class="string">&#x27;2016-12-02 09:40:00&#x27;</span>, <span class="number">20.9</span>),(<span class="string">&#x27;2016-12-02 09:50:00&#x27;</span>, <span class="number">20.7</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-02 10:00:00&#x27;</span>, <span class="number">20.3</span>),(<span class="string">&#x27;2016-12-02 10:10:00&#x27;</span>, <span class="number">21.0</span>),(<span class="string">&#x27;2016-12-02 10:20:00&#x27;</span>, <span class="number">20.5</span>),(<span class="string">&#x27;2016-12-02 10:30:00&#x27;</span>, <span class="number">20.3</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-02 10:40:00&#x27;</span>, <span class="number">20.2</span>),(<span class="string">&#x27;2016-12-02 10:50:00&#x27;</span>, <span class="number">20.3</span>),(<span class="string">&#x27;2016-12-02 11:00:00&#x27;</span>, <span class="number">20.4</span>),(<span class="string">&#x27;2016-12-02 11:10:00&#x27;</span>, <span class="number">20.4</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-02 11:20:00&#x27;</span>, <span class="number">21.0</span>),(<span class="string">&#x27;2016-12-02 11:30:00&#x27;</span>, <span class="number">20.3</span>),(<span class="string">&#x27;2016-12-02 11:40:00&#x27;</span>, <span class="number">20.3</span>),(<span class="string">&#x27;2016-12-02 11:50:00&#x27;</span>, <span class="number">20.9</span>),</span><br><span class="line">(<span class="string">&#x27;2016-12-02 12:00:00&#x27;</span>, <span class="number">20.8</span>),(<span class="string">&#x27;2016-12-02 12:10:00&#x27;</span>, <span class="number">20.9</span>),(<span class="string">&#x27;2016-12-02 12:20:00&#x27;</span>, <span class="number">20.7</span>),(<span class="string">&#x27;2016-12-02 12:30:00&#x27;</span>, <span class="number">20.7</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><p>执行训练操作：<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  SET search_path=<span class="string">&quot;$user&quot;</span>,<span class="keyword">public</span>,madlib;</span><br><span class="line"><span class="type">SET</span> <span class="variable">behavior_compat_options</span> <span class="operator">=</span> <span class="string">&#x27;bind_procedure_searchpath&#x27;</span>;</span><br><span class="line">select madlib.prophet_fit(<span class="string">&#x27;public.ts_data&#x27;</span>, <span class="string">&#x27;public.prophet_model&#x27;</span>, </span><br><span class="line">$$&#123;<span class="string">&#x27;ds&#x27;</span>: <span class="string">&#x27;date&#x27;</span>, <span class="string">&#x27;y&#x27;</span>: <span class="string">&#x27;value&#x27;</span>&#125;$$, -- 列名映射， prophet要求时间列名必须为<span class="string">&#x27;ds&#x27;</span>， 时序值列名<span class="string">&#x27;y&#x27;</span></span><br><span class="line">$$&#123;<span class="string">&#x27;growth&#x27;</span>: <span class="string">&#x27;linear&#x27;</span>, <span class="string">&#x27;changepoints&#x27;</span>: [<span class="string">&#x27;2016-11-30 05:40:00&#x27;</span>]&#125;$$ -- 训练参数组合，如果有多个参数，请用元组方式传入</span><br><span class="line">);</span><br></pre></td></tr></table></figure><br>查询模型表：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">   select id, y_type, params from <span class="keyword">public</span>.prophet_model;</span><br><span class="line">    </span><br><span class="line"> id |      y_type      |                            params</span><br><span class="line">----+------------------+---------------------------------------------------------------</span><br><span class="line">  <span class="number">1</span> | <span class="type">double</span> precision | &#123;<span class="string">&#x27;changepoints&#x27;</span>: [<span class="string">&#x27;2016-11-30 05:40:00&#x27;</span>], <span class="string">&#x27;growth&#x27;</span>: <span class="string">&#x27;linear&#x27;</span>&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>在模型表中，记录着训练时间，结果类型，所用参数等。<br>执行预测操作<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select madlib.prophet_predict(<span class="string">&#x27;public.prophet_model&#x27;</span>,<span class="string">&#x27;public.prophet_output&#x27;</span>, <span class="number">10</span>, <span class="string">&#x27;10T&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>查看预测结果：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">  select ds, yhat, yhat_lower, yhat_upper from <span class="keyword">public</span>.prophet_output;</span><br><span class="line">    </span><br><span class="line">     ds     |     yhat      |  yhat_lower   |  yhat_upper</span><br><span class="line">------------+---------------+---------------+---------------</span><br><span class="line"> <span class="number">2016</span>-<span class="number">12</span>-<span class="number">02</span> | <span class="number">20.6943848045</span> | <span class="number">17.7671496048</span> | <span class="number">23.4160694837</span></span><br><span class="line"> <span class="number">2016</span>-<span class="number">12</span>-<span class="number">02</span> | <span class="number">20.7408355633</span> | <span class="number">17.9264413164</span> | <span class="number">23.6426403933</span></span><br><span class="line"> <span class="number">2016</span>-<span class="number">12</span>-<span class="number">02</span> | <span class="number">20.7872863221</span> | <span class="number">17.9298207895</span> | <span class="number">23.4548814727</span></span><br><span class="line"> <span class="number">2016</span>-<span class="number">12</span>-<span class="number">02</span> |  <span class="number">20.833737081</span> |  <span class="number">18.234443228</span> | <span class="number">23.5317342873</span></span><br><span class="line"> <span class="number">2016</span>-<span class="number">12</span>-<span class="number">02</span> | <span class="number">20.8801878398</span> | <span class="number">18.2471709649</span> | <span class="number">23.8345735574</span></span><br><span class="line"> <span class="number">2016</span>-<span class="number">12</span>-<span class="number">02</span> | <span class="number">20.9266385986</span> | <span class="number">18.1780101465</span> |  <span class="number">23.696087927</span></span><br><span class="line"> <span class="number">2016</span>-<span class="number">12</span>-<span class="number">02</span> | <span class="number">20.9730893575</span> | <span class="number">18.4292088648</span> | <span class="number">23.7209823631</span></span><br><span class="line"> <span class="number">2016</span>-<span class="number">12</span>-<span class="number">02</span> | <span class="number">21.0195401163</span> | <span class="number">18.2623494126</span> | <span class="number">23.7341427068</span></span><br><span class="line"> <span class="number">2016</span>-<span class="number">12</span>-<span class="number">02</span> | <span class="number">21.0659908751</span> | <span class="number">18.1173966769</span> | <span class="number">23.7919478206</span></span><br><span class="line"> <span class="number">2016</span>-<span class="number">12</span>-<span class="number">02</span> |  <span class="number">21.112441634</span> | <span class="number">18.5018042056</span> | <span class="number">23.9508963879</span></span><br><span class="line">(<span class="number">10</span> rows)</span><br></pre></td></tr></table></figure> <p></p><h3 id="五、常见问题处理"><a href="#五、常见问题处理" class="headerlink" title="五、常见问题处理"></a>五、常见问题处理</h3><p>问题描述：编译数据库时，提示python模块，“can not be used when making a shared object；recompile with -fPIC”或者 “libpython22.7.a: could not read symbols: Bad value”。 处理方式：</p><p>请检查python版本和环境变量。<br>查看是否安装python-devel，或者编译python时，是否启用了–enable-shared。</p><p>问题描述：执行gdb或者gstack命令，报错 “gdb: symbol lookup error: gdb: undefined symbol: PyUnicodeUCS4_FromEncodedObject”。 处理方式：这个问题一般发生在自行编译python2的环境上，Python2在编译安装时可以通过参数 –enable-unicode&#x3D;ucs2 或 –enable-unicode&#x3D;ucs4分别指定使用2个字节或者4个字节表示一个unicode字符，python2缺省使用–enable-unicode&#x3D;ucs2。Python3默认使用4个字节表示一个unicode字符。 可以在系统中自带的python2下执行：“import sys；print sys.maxunicode”并查看结果，如果结果是65535，说明系统默认的是ucs2；如果结果是1114111，说明用的ucs4编码。 自行编译python2时，如果系统中内置的python2使用的ucs4，系统中的gdb也会依赖ucs4。因此自行编译的python2在configure时，需要添加–enable-unicode&#x3D;ucs4。<br>问题描述：在kmeans等算法里，报错“Data table does not exist”。 处理方式：算法所在的schema和输入表不在一个schema下，可以设置SET behavior_compat_options &#x3D; ‘bind_procedure_searchpath’;解决这个问题。<br>问题描述：python启动报错，或者import报错。 处理方式：</p><p>检查环境变量比如PYTHONHOME，PYTHONPATH。<br>安装必备依赖包。</p><p>问题描述：Regression等算法报错“ERROR: spiexceptions.UndefinedFunction: operator does not exist: json -&gt;&gt; unknown.”。 处理方式：数据库不支持json导出功能，不支持此功能。<br>问题描述：MADlib中进行编译时，如果使用make -sj，会遇到boost相关的报错。例如，“fatal error: boost&#x2F;mpl&#x2F;if.hpp: No such file or directory”。 处理方式：非问题，MADlib编译时，会先解压这几个安装包。如果是并行编译，会出现一边编译，一边解压的情况。如果编译用到这个文件，另一边还没有解压完成，会出现这类报错。再次执行make -sj即可解决。<br>问题描述：执行.&#x2F;madpack 安装时，遇到报错：“ERROR : Failed to connect to database”。 处理方式：需要排查数据库是否启动，目标库是否存在，数据库端口是否被占用，安装用户是否具有管理员权限。另外执行madpack安装时，IP请使用127.0.0.1，不要使用localhost，否则也会出现连接失败的情况。</p><p>今天的分享就到这里了，感谢小伙伴的阅读，让我们一起探索数据库前沿知识。</p><div class="post-copyright"><div class="content"><p>本文标题： 推荐系列-前沿科技探究DeepSQL-库内AI算法</p><p>本文作者： OSChina</p><p>发布时间： 2022年02月19日 11:56</p><p>最后更新： 2022年05月11日 16:58</p><p>原始链接： <a class="post-url" href="/cc7a5449/" title="推荐系列-前沿科技探究DeepSQL-库内AI算法">https://www.hosiang.cn/cc7a5449/</a></p><p>版权声明： 本文著作权归作者所有，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener noreferrer" target="_blank">CC BY-NC-SA 4.0</a>许可协议，转载请注明出处！</p><footer><a href="https://www.hosiang.cn"><img src="/../images/logo.png" alt="Howe Hsiang"> Howe Hsiang</a></footer></div></div><div class="page-reward"><a id="rewardBtn" href="javascript:;">赏</a></div><div id="reward" class="post-modal reward-lay"><a class="close" href="javascript:;" id="reward-close">×</a> <span class="reward-title"><i class="icon icon-quote-left"></i> 喜欢就赞赏一下呗！ <i class="icon icon-quote-right"></i></span><div class="reward-content"><div class="reward-code"><img id="rewardCode" src="/images/threepay_code.jpg" alt="打赏二维码"></div><div class="reward-select"></div></div></div></div><footer class="article-footer"><div class="post-share"><a href="javascript:" id="share-sub" class="post-share-fab"><i class="fa fa-share-alt" style="padding-top:11px!important"></i></a><div class="post-share-list" id="share-list"><ul class="share-icons"><li><a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://www.hosiang.cn/cc7a5449/" data-title="Facebook" rel="external nofollow noopener noreferrer"><i class="fa fa-facebook" style="padding-top:9px!important"></i></a></li><li><a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《推荐系列-前沿科技探究DeepSQL-库内AI算法》 — 狂欢马克思&url=https://www.hosiang.cn/cc7a5449/&via=https://www.hosiang.cn" data-title="Twitter" rel="external nofollow noopener noreferrer"><i class="fa fa-twitter" style="padding-top:9px!important"></i></a></li><li><a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://www.hosiang.cn/cc7a5449/" data-title="Google+" rel="external nofollow noopener noreferrer"><i class="fa fa-google-plus" style="padding-top:9px!important"></i></a></li><li><a class="qq share-sns" target="_blank" href="https://connect.qq.com/widget/shareqq/index.html?url=https://www.hosiang.cn/cc7a5449/&title=《推荐系列-前沿科技探究DeepSQL-库内AI算法》 — 狂欢马克思&source=&amp;emsp;&amp;emsp;库DeepSQL特性实现DB4AI功能，即在数据库内实现AI算法，以更好的支撑大数据的快速分析和计算。这里提供了一..." data-title="QQ" rel="external nofollow noopener noreferrer"><i class="fa fa-qq" style="padding-top:9px!important"></i></a></li><li><a class="weixin share-sns" id="wxFab" href="javascript:" data-title="微信"><i class="fa fa-weixin" style="padding-top:9px!important"></i></a></li><li><a class="weibo share-sns" target="_blank" href="https://service.weibo.com/share/share.php?url=https://www.hosiang.cn/cc7a5449/&title=《推荐系列-前沿科技探究DeepSQL-库内AI算法》 — 狂欢马克思&pic=https://static.oschina.net/uploads/img/202203/25112058_QNRj.gif" data-title="微博" rel="external nofollow noopener noreferrer"><i class="fa fa-weibo" style="padding-top:9px!important"></i></a></li></ul></div></div><div class="post-modal wx-share" id="wxShare"><a class="close" href="javascript:" id="wxShare-close">×</a><p>扫一扫，分享到微信</p><img src="//api.qrserver.com/v1/create-qr-code/?data=https://www.hosiang.cn/cc7a5449/" alt="微信分享二维码"></div><div class="mask"></div><ul class="article-footer-menu"><li class="article-footer-tags"><i class="fa fa-tags"></i> <a href="/tags/Popular/" class="color3">Popular</a></li></ul></footer></div></article><aside class="post-toc-pos post-toc-top" id="post-toc"><nav class="post-toc-wrap"><ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E4%B8%80%E3%80%81%E6%A6%82%E8%BF%B0"><span class="post-toc-text">一、概述</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E4%BA%8C%E3%80%81%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2"><span class="post-toc-text">二、环境部署</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6"><span class="post-toc-text">前提条件</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4"><span class="post-toc-text">操作步骤</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E4%B8%89%E3%80%81%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC"><span class="post-toc-text">三、使用指导</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#PL-x2F-Python%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="post-toc-text">PL&#x2F;Python存储过程</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93Null-None%E5%92%8C%E7%A9%BA%E4%B8%B2%E5%A4%84%E7%90%86"><span class="post-toc-text">数据库Null, None和空串处理</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="post-toc-text">触发器</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%8C%BF%E5%90%8D%E4%BB%A3%E7%A0%81%E5%9D%97"><span class="post-toc-text">匿名代码块</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%85%B1%E4%BA%AB%E6%95%B0%E6%8D%AE"><span class="post-toc-text">共享数据</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BF%E9%97%AE"><span class="post-toc-text">数据库访问</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%85%B3%E4%BA%8E%E5%AE%A1%E8%AE%A1"><span class="post-toc-text">关于审计</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%85%B3%E4%BA%8E%E5%B9%B6%E5%8F%91%E6%89%A7%E8%A1%8C"><span class="post-toc-text">关于并发执行</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%BA%93%E5%86%85%E7%AE%97%E6%B3%95"><span class="post-toc-text">库内算法</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%85%B6%E4%BB%96%E7%AE%97%E6%B3%95%E6%94%AF%E6%8C%81"><span class="post-toc-text">其他算法支持</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%9B%9B%E3%80%81%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="post-toc-text">四、最佳实践</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%88%86%E7%B1%BB%E7%AE%97%E6%B3%95"><span class="post-toc-text">分类算法</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%9B%9E%E5%BD%92%E7%AE%97%E6%B3%95"><span class="post-toc-text">回归算法</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E8%81%9A%E7%B1%BB%E7%AE%97%E6%B3%95"><span class="post-toc-text">聚类算法</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#gbdt%E7%AE%97%E6%B3%95"><span class="post-toc-text">gbdt算法</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%9B%9E%E5%BD%92%E4%BB%BB%E5%8A%A1"><span class="post-toc-text">回归任务</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#xgboost%E7%AE%97%E6%B3%95"><span class="post-toc-text">xgboost算法</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#prophet%E7%AE%97%E6%B3%95"><span class="post-toc-text">prophet算法</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E4%BA%94%E3%80%81%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86"><span class="post-toc-text">五、常见问题处理</span></a></li></ol></nav></aside><nav id="article-nav"><a href="/4eb6d23c/" id="article-nav-newer" class="article-nav-link-wrap"><span class="article-nav-title"><i class="fa fa-hand-o-left" aria-hidden="true"></i> 推荐系列-干货｜云原生时代热门监控利器解析与应用（文末福利） </span></a><a href="/8b616959/" id="article-nav-older" class="article-nav-link-wrap"><span class="article-nav-title">推荐系列-推荐六款实用 Mock 神器</span> <i class="fa fa-hand-o-right" aria-hidden="true"></i></a></nav><div id="gitalk"></div><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script>var gitalk=new Gitalk({repo:"bolg-comment",owner:"Hosiang1026",admin:"Hosiang1026",clientID:"37a2dd4473e8970cecc2",clientSecret:"e30efa17d86d9de4f4ab810872dc62a7b2e7e634",pagerDirection:"last",distractionFreeMode:!0,createIssueManually:!1});gitalk.render("gitalk")</script></section></div><footer id="footer"><div class="outer"><div id="footer-info" class="inner"><script id="_wau78w">var _wau=_wau||[];_wau.push(["small","5dnguv4c2n","78w"])</script><script async src="//waust.at/s.js"></script><p><span id="busuanzi_container_site_uv" style="display:none"><span class="post-count">总字数：<span>1531.2k</span> </span>总访客数：<span id="busuanzi_value_site_uv"></span> </span><span id="busuanzi_container_site_pv" style="display:none">总访问量：<span id="busuanzi_value_site_pv"></span></span><br><span id="TimeShow">本站</span><span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span><br>Copyright&copy; 2018 - 2022 狂欢马克思 <a href="https://beian.miit.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">京ICP备17060439号</a></p></div></div><script>var now=new Date;function createtime(){var n=new Date("2017/09/18");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="安全运行 "+dnum+" 天 ",document.getElementById("times").innerHTML=hnum+" 小时 "+mnum+" 分 "+snum+" 秒"}setInterval("createtime()",800)</script></footer><script>var mihoConfig={root:"https://www.hosiang.cn",animate:"true",isHome:"false",share:"true",reward:" 1"}</script><div class="sidebar"><div id="sidebar-search" title="Search"><i class="fa fa-search"></i></div><div id="sidebar-category" title="Categories"><i class="fa fa-book"></i></div><div id="sidebar-tag" title="Tags"><i class="fa fa-tags"></i></div><div id="sidebar-top"><span class="sidebar-top-icon"><i class="fa fa-angle-up"></i></span></div></div><div class="sidebar-menu-box" id="sidebar-menu-box"><div class="sidebar-menu-box-container"><div id="sidebar-menu-box-categories"><a class="category-link" href="/categories/%E5%85%B4%E8%B6%A3%E7%88%B1%E5%A5%BD/">兴趣爱好</a><a class="category-link" href="/categories/%E5%85%B6%E4%BB%96%E5%BC%80%E5%8F%91/">其他开发</a><a class="category-link" href="/categories/%E5%89%8D%E6%B2%BF%E5%BC%80%E5%8F%91/">前沿开发</a><a class="category-link" href="/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">前端开发</a><a class="category-link" href="/categories/%E5%8D%87%E7%BA%A7%E7%89%88%E6%9C%AC/">升级版本</a><a class="category-link" href="/categories/%E5%8D%9A%E5%AE%A2%E6%95%99%E7%A8%8B/">博客教程</a><a class="category-link" href="/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/">后端开发</a><a class="category-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a><a class="category-link" href="/categories/%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/">日常记录</a><a class="category-link" href="/categories/%E7%83%AD%E9%97%A8%E6%96%87%E7%AB%A0/">热门文章</a></div><div id="sidebar-menu-box-tags"><a href="/tags/Ajax/" style="font-size:10px">Ajax</a> <a href="/tags/AliGenie/" style="font-size:10px">AliGenie</a> <a href="/tags/Alipay/" style="font-size:10px">Alipay</a> <a href="/tags/Android/" style="font-size:10px">Android</a> <a href="/tags/Blockchain/" style="font-size:17.5px">Blockchain</a> <a href="/tags/CQRS/" style="font-size:10px">CQRS</a> <a href="/tags/Database/" style="font-size:15px">Database</a> <a href="/tags/Docker/" style="font-size:10px">Docker</a> <a href="/tags/EasyUI/" style="font-size:10px">EasyUI</a> <a href="/tags/Guitar/" style="font-size:10px">Guitar</a> <a href="/tags/Hackintosh/" style="font-size:12.5px">Hackintosh</a> <a href="/tags/Hexo/" style="font-size:15px">Hexo</a> <a href="/tags/IntelliJ-IDEA/" style="font-size:10px">IntelliJ IDEA</a> <a href="/tags/Java/" style="font-size:12.5px">Java</a> <a href="/tags/Kali-Linux/" style="font-size:10px">Kali Linux</a> <a href="/tags/Life/" style="font-size:17.5px">Life</a> <a href="/tags/Mac-OS/" style="font-size:12.5px">Mac OS</a> <a href="/tags/MultiThread/" style="font-size:10px">MultiThread</a> <a href="/tags/NodeJS/" style="font-size:10px">NodeJS</a> <a href="/tags/Popular/" style="font-size:20px">Popular</a> <a href="/tags/Python/" style="font-size:10px">Python</a> <a href="/tags/SaaS/" style="font-size:10px">SaaS</a> <a href="/tags/Servlet/" style="font-size:10px">Servlet</a> <a href="/tags/Spring/" style="font-size:17.5px">Spring</a> <a href="/tags/Upgrade/" style="font-size:10px">Upgrade</a> <a href="/tags/Web/" style="font-size:10px">Web</a> <a href="/tags/Windows/" style="font-size:10px">Windows</a> <a href="/tags/Work/" style="font-size:10px">Work</a> <a href="/tags/iOS/" style="font-size:10px">iOS</a></div></div><a href="javascript:" class="sidebar-menu-box-close">&times;</a></div><div class="mobile-header-menu-nav" id="mobile-header-menu-nav"><div class="mobile-header-menu-container"><span class="title">导航</span><ul class="mobile-header-menu-navbar"><li><a href="/"><i class="fa fa-home"></i><span>主页</span></a></li><li><a href="/archives"><i class="fa fa-archive"></i><span>归档</span></a></li><li><a href="/gitbook"><i class="fa fa-columns"></i><span>笔记</span></a></li><li><a href="/music"><i class="fa fa-music"></i><span>音乐</span></a></li><li><a href="/photo"><i class="fa fa-picture-o"></i><span>相册</span></a></li><li><a href="/collection"><i class="fa fa-envira"></i><span>收藏</span></a></li><li><a href="/about"><i class="fa fa-user"></i><span>关于</span></a></li></ul></div><div class="mobile-header-tag-container"><span class="title">标签</span><div id="mobile-header-container-tags"><a href="/tags/Ajax/" style="font-size:10px">Ajax</a> <a href="/tags/AliGenie/" style="font-size:10px">AliGenie</a> <a href="/tags/Alipay/" style="font-size:10px">Alipay</a> <a href="/tags/Android/" style="font-size:10px">Android</a> <a href="/tags/Blockchain/" style="font-size:17.5px">Blockchain</a> <a href="/tags/CQRS/" style="font-size:10px">CQRS</a> <a href="/tags/Database/" style="font-size:15px">Database</a> <a href="/tags/Docker/" style="font-size:10px">Docker</a> <a href="/tags/EasyUI/" style="font-size:10px">EasyUI</a> <a href="/tags/Guitar/" style="font-size:10px">Guitar</a> <a href="/tags/Hackintosh/" style="font-size:12.5px">Hackintosh</a> <a href="/tags/Hexo/" style="font-size:15px">Hexo</a> <a href="/tags/IntelliJ-IDEA/" style="font-size:10px">IntelliJ IDEA</a> <a href="/tags/Java/" style="font-size:12.5px">Java</a> <a href="/tags/Kali-Linux/" style="font-size:10px">Kali Linux</a> <a href="/tags/Life/" style="font-size:17.5px">Life</a> <a href="/tags/Mac-OS/" style="font-size:12.5px">Mac OS</a> <a href="/tags/MultiThread/" style="font-size:10px">MultiThread</a> <a href="/tags/NodeJS/" style="font-size:10px">NodeJS</a> <a href="/tags/Popular/" style="font-size:20px">Popular</a> <a href="/tags/Python/" style="font-size:10px">Python</a> <a href="/tags/SaaS/" style="font-size:10px">SaaS</a> <a href="/tags/Servlet/" style="font-size:10px">Servlet</a> <a href="/tags/Spring/" style="font-size:17.5px">Spring</a> <a href="/tags/Upgrade/" style="font-size:10px">Upgrade</a> <a href="/tags/Web/" style="font-size:10px">Web</a> <a href="/tags/Windows/" style="font-size:10px">Windows</a> <a href="/tags/Work/" style="font-size:10px">Work</a> <a href="/tags/iOS/" style="font-size:10px">iOS</a></div></div></div><div class="search-wrap"><span class="search-close">&times;</span> <a href="javascript:" class="header-icon waves-effect waves-circle waves-light" id="back"><i class="icon icon-lg icon-chevron-left"></i> </a><input class="search-field" placeholder="Search..." id="keywords"> <a id="search-submit" href="javascript:"><i class="fa fa-search"></i></a><div class="search-container" id="search-container"><ul class="search-result" id="search-result"></ul></div></div><div id="search-tpl"><li class="search-result-item"><a href="{url}" class="search-item-li"><span class="search-item-li-title" title="{title}">{title}</span></a></li></div><script src="/js/search.js"></script><script src="/js/main.js"></script><script src="//cdn.bootcss.com/particles.js/2.0.0/particles.min.js"></script><div id="particles"></div><script src="/js/particles.js"></script><link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css"><script src="//cdn.bootcss.com/scrollReveal.js/3.0.5/scrollreveal.js"></script><script src="/js/animate.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/hijiki.model.json"},display:{position:"right",width:150,height:300},mobile:{show:!0,scale:.5},log:!1})</script></body></html>